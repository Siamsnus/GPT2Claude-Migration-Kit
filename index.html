<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPT to Claude Migration Kit - Export everything from ChatGPT</title>
<meta name="description" content="Export your ChatGPT memories, conversations, and instructions. No install needed.">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #08080a; --surface: #111114; --surface2: #18181c; --border: #252530;
    --text: #e4e4ea; --text-dim: #7a7a88; --accent: #d4a574;
    --accent-glow: rgba(212, 165, 116, 0.15); --gpt: #9898d4;
    --green: #7eb8a0; --red: #d47474;
    --mono: 'Space Mono', monospace; --sans: 'DM Sans', system-ui, sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }
  body { background: var(--bg); color: var(--text); font-family: var(--sans); line-height: 1.7; min-height: 100vh; overflow-x: hidden; }
  body::before { content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events: none; z-index: 1; }
  .container { max-width: 720px; margin: 0 auto; padding: 0 2rem; position: relative; z-index: 2; }
  .hero { padding: 6rem 0 4rem; text-align: center; }
  .hero-badge { display: inline-block; padding: 4px 14px; border: 1px solid var(--border); border-radius: 100px; font-family: var(--mono); font-size: 0.72rem; color: var(--text-dim); margin-bottom: 2rem; letter-spacing: 0.05em; }
  .hero h1 { font-size: clamp(2.2rem, 5vw, 3.2rem); font-weight: 700; letter-spacing: -0.03em; line-height: 1.15; margin-bottom: 1.5rem; }
  .hero h1 .gpt { color: var(--gpt); } .hero h1 .arrow { color: var(--text-dim); opacity: 0.4; } .hero h1 .claude { color: var(--accent); }
  .hero p { font-size: 1.1rem; color: var(--text-dim); max-width: 520px; margin: 0 auto 3rem; }

  .install-section { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 3rem 2.5rem; text-align: center; position: relative; overflow: hidden; }
  .install-section::before { content: ""; position: absolute; top: -1px; left: -1px; right: -1px; height: 3px; background: linear-gradient(90deg, var(--gpt), var(--accent)); border-radius: 20px 20px 0 0; }
  .install-section h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; }
  .install-section .subtitle { color: var(--text-dim); font-size: 0.92rem; margin-bottom: 2rem; }

  /* Tab system */
  .tab-bar { display: flex; justify-content: center; gap: 0; margin-bottom: 2rem; background: var(--bg); border-radius: 10px; padding: 4px; border: 1px solid var(--border); }
  .tab-btn { padding: 8px 20px; border: none; background: transparent; color: var(--text-dim); font-family: var(--sans); font-size: 0.85rem; font-weight: 600; cursor: pointer; border-radius: 8px; transition: all 0.2s; }
  .tab-btn:hover { color: var(--text); }
  .tab-btn.active { background: var(--accent); color: var(--bg); }
  .tab-content { display: none; text-align: left; }
  .tab-content.active { display: block; }

  .bookmarklet-link { display: inline-flex; align-items: center; gap: 10px; padding: 16px 32px; background: linear-gradient(135deg, #d4a574, #c49060); color: #0a0a0b; font-family: var(--sans); font-size: 1rem; font-weight: 700; text-decoration: none; border-radius: 12px; cursor: grab; transition: all 0.2s ease; box-shadow: 0 4px 20px var(--accent-glow); user-select: none; }
  .bookmarklet-link:hover { transform: translateY(-2px); box-shadow: 0 8px 30px var(--accent-glow); }
  .drag-hint { margin-top: 1rem; font-size: 0.82rem; color: var(--text-dim); text-align: center; }
  .drag-hint strong { color: var(--text); }

  .install-steps { text-align: left; }
  .install-step { display: flex; gap: 1rem; align-items: flex-start; margin-bottom: 1.25rem; }
  .install-step-num { flex-shrink: 0; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 8px; background: var(--accent-glow); color: var(--accent); font-family: var(--mono); font-size: 0.8rem; font-weight: 700; }
  .install-step p { font-size: 0.9rem; color: var(--text-dim); }
  .install-step p strong { color: var(--text); }

  .url-box { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; font-family: var(--mono); font-size: 0.7rem; color: var(--accent); word-break: break-all; max-height: 80px; overflow-y: auto; margin: 0.75rem 0; line-height: 1.4; cursor: pointer; transition: border-color 0.2s; }
  .url-box:hover { border-color: var(--accent); }

  .action-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: var(--accent); color: var(--bg); border: none; border-radius: 10px; font-family: var(--sans); font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .action-btn:hover { opacity: 0.9; transform: translateY(-1px); }
  .action-btn.secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .action-btn.secondary:hover { border-color: var(--accent); }

  .copy-confirm { font-size: 0.82rem; color: var(--green); margin-top: 0.5rem; display: none; }

  .browser-detect { font-size: 0.82rem; color: var(--green); margin-bottom: 1rem; font-family: var(--mono); }

  .steps { padding: 4rem 0; }
  .steps h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 2rem; text-align: center; }
  .step-list { display: flex; flex-direction: column; gap: 1rem; }
  .step-item { display: flex; gap: 1.25rem; align-items: flex-start; padding: 1.5rem; background: var(--surface); border: 1px solid var(--border); border-radius: 14px; }
  .step-item:hover { border-color: #353540; }
  .step-num { flex-shrink: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-family: var(--mono); font-size: 0.85rem; font-weight: 700; }
  .step-num.s1 { background: rgba(152,152,212,0.12); color: var(--gpt); }
  .step-num.s2 { background: var(--accent-glow); color: var(--accent); }
  .step-num.s3 { background: rgba(126,184,160,0.12); color: var(--green); }
  .step-text h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.25rem; }
  .step-text p { font-size: 0.88rem; color: var(--text-dim); }

  .exports-section { padding: 0 0 4rem; }
  .exports-section h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 2rem; text-align: center; }
  .export-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
  .export-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 1.5rem; text-align: center; }
  .export-card .icon { font-size: 2rem; margin-bottom: 0.75rem; }
  .export-card h3 { font-size: 0.9rem; font-weight: 600; margin-bottom: 0.25rem; }
  .export-card p { font-size: 0.8rem; color: var(--text-dim); }
  .export-card .filename { display: inline-block; margin-top: 0.75rem; font-family: var(--mono); font-size: 0.7rem; padding: 3px 10px; background: var(--surface2); border-radius: 4px; color: var(--accent); }

  .fallback-box { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 2rem; margin-bottom: 1rem; }
  .fallback-box h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
  .fallback-box p { font-size: 0.88rem; color: var(--text-dim); margin-bottom: 0.5rem; }

  .faq { padding: 0 0 4rem; }
  .faq h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 2rem; text-align: center; }
  .faq-item { padding: 1.25rem 0; border-bottom: 1px solid var(--border); }
  .faq-item:first-child { border-top: 1px solid var(--border); }
  .faq-item h3 { font-size: 0.92rem; font-weight: 600; margin-bottom: 0.4rem; }
  .faq-item p { font-size: 0.88rem; color: var(--text-dim); }

  .footer { padding: 3rem 0; border-top: 1px solid var(--border); text-align: center; font-size: 0.8rem; color: var(--text-dim); }
  .footer a { color: var(--accent); text-decoration: none; }
  .footer a:hover { text-decoration: underline; }
  .footer p { margin-bottom: 0.4rem; }

  @media (max-width: 640px) { .hero { padding: 4rem 0 3rem; } .install-section { padding: 2rem 1.5rem; } .export-grid { grid-template-columns: 1fr; } .container { padding: 0 1.25rem; } .tab-btn { padding: 6px 12px; font-size: 0.78rem; } }
</style>
</head>
<body>
<div class="container">

  <div class="hero">
    <div class="hero-badge">v2.4 — OPEN SOURCE — MIT LICENSE</div>
    <h1>Move from <span class="gpt">ChatGPT</span> <span class="arrow">→</span> <span class="claude">Claude</span></h1>
    <p>Export your memories, every conversation, and all custom instructions. No extensions to install. No data leaves your browser.</p>
  </div>

  <!-- ========== INSTALL SECTION ========== -->
  <div class="install-section" id="install">
    <h2>Add the export tool</h2>
    <p class="subtitle">Choose your browser, follow the steps. Takes 30 seconds.</p>

    <div id="browser-detect" class="browser-detect"></div>

    <div class="tab-bar">
      <button class="tab-btn active" onclick="showTab('chrome')">Chrome / Edge / Brave</button>
      <button class="tab-btn" onclick="showTab('firefox')">Firefox</button>
      <button class="tab-btn" onclick="showTab('paste')">Any browser</button>
    </div>

    <!-- CHROME TAB -->
    <div class="tab-content active" id="tab-chrome">
      <div style="text-align:center; margin-bottom:1.5rem;">
        <a class="bookmarklet-link" id="bookmarklet-btn" href="javascript:(function()%20%7B%0A%2F%2F%20Prevent%20double-loading%0Aif%20(document.getElementById(%22gpt2claude-panel%22))%20%7B%0Avar%20existing%20%3D%20document.getElementById(%22gpt2claude-panel%22)%3B%0Aexisting.style.animation%20%3D%20%22g2c-shake%200.3s%20ease-in-out%22%3B%0AsetTimeout(function()%20%7B%20existing.style.animation%20%3D%20%22%22%3B%20%7D%2C%20300)%3B%0Areturn%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20STYLES%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20style%20%3D%20document.createElement(%22style%22)%3B%0Astyle.textContent%20%3D%20%22%5C%0A%40keyframes%20g2c-fadein%20%7B%20from%20%7B%20opacity%3A%200%3B%20transform%3A%20translateY(20px)%20scale(0.95)%3B%20%7D%20to%20%7B%20opacity%3A%201%3B%20transform%3A%20translateY(0)%20scale(1)%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-shake%20%7B%200%25%2C100%25%20%7B%20transform%3A%20translateX(0)%3B%20%7D%2025%25%20%7B%20transform%3A%20translateX(-5px)%3B%20%7D%2075%25%20%7B%20transform%3A%20translateX(5px)%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-spin%20%7B%20to%20%7B%20transform%3A%20rotate(360deg)%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-pulse%20%7B%200%25%2C100%25%20%7B%20opacity%3A%201%3B%20%7D%2050%25%20%7B%20opacity%3A%200.5%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-indeterminate%20%7B%200%25%20%7B%20left%3A%20-30%25%3B%20width%3A%2030%25%3B%20%7D%2050%25%20%7B%20left%3A%2050%25%3B%20width%3A%2030%25%3B%20%7D%20100%25%20%7B%20left%3A%20100%25%3B%20width%3A%2030%25%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-pulse-count%20%7B%200%25%2C100%25%20%7B%20opacity%3A%201%3B%20%7D%2050%25%20%7B%20opacity%3A%200.7%3B%20%7D%20%7D%5C%0A%40keyframes%20g2c-dot-bounce%20%7B%200%25%2C80%25%2C100%25%20%7B%20transform%3A%20translateY(0)%3B%20%7D%2040%25%20%7B%20transform%3A%20translateY(-4px)%3B%20%7D%20%7D%5C%0A.g2c-progress-fill.indeterminate%20%7B%20position%3A%20relative%3B%20width%3A%20100%25%20!important%3B%20background%3A%20none%20!important%3B%20overflow%3A%20hidden%3B%20%7D%5C%0A.g2c-progress-fill.indeterminate%3A%3Aafter%20%7B%20content%3A%20''%3B%20position%3A%20absolute%3B%20top%3A%200%3B%20left%3A%20-30%25%3B%20width%3A%2030%25%3B%20height%3A%20100%25%3B%20background%3A%20linear-gradient(90deg%2C%20transparent%2C%20%23d4a574%2C%20transparent)%3B%20border-radius%3A%203px%3B%20animation%3A%20g2c-indeterminate%201.5s%20ease-in-out%20infinite%3B%20%7D%5C%0A.g2c-scan-hero%20%7B%20text-align%3A%20center%3B%20padding%3A%2020px%200%2010px%3B%20%7D%5C%0A.g2c-scan-hero%20.g2c-scan-count%20%7B%20font-size%3A%2042px%3B%20font-weight%3A%20800%3B%20color%3A%20%23d4a574%3B%20font-variant-numeric%3A%20tabular-nums%3B%20animation%3A%20g2c-pulse-count%202s%20ease-in-out%20infinite%3B%20line-height%3A%201%3B%20%7D%5C%0A.g2c-scan-hero%20.g2c-scan-label%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23888%3B%20margin-top%3A%204px%3B%20%7D%5C%0A.g2c-scan-hero%20.g2c-scan-status%20%7B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20gap%3A%206px%3B%20margin-top%3A%2012px%3B%20font-size%3A%2012px%3B%20color%3A%20%23999%3B%20%7D%5C%0A.g2c-scan-dots%20%7B%20display%3A%20flex%3B%20gap%3A%203px%3B%20%7D%5C%0A.g2c-scan-dots%20span%20%7B%20width%3A%204px%3B%20height%3A%204px%3B%20background%3A%20%23d4a574%3B%20border-radius%3A%2050%25%3B%20animation%3A%20g2c-dot-bounce%201.2s%20ease-in-out%20infinite%3B%20%7D%5C%0A.g2c-scan-dots%20span%3Anth-child(2)%20%7B%20animation-delay%3A%200.15s%3B%20%7D%5C%0A.g2c-scan-dots%20span%3Anth-child(3)%20%7B%20animation-delay%3A%200.3s%3B%20%7D%5C%0A.g2c-scan-models%20%7B%20display%3A%20flex%3B%20flex-wrap%3A%20wrap%3B%20gap%3A%204px%3B%20justify-content%3A%20center%3B%20margin-top%3A%2014px%3B%20padding-top%3A%2014px%3B%20border-top%3A%201px%20solid%20%232a2a35%3B%20%7D%5C%0A.g2c-scan-tag%20%7B%20font-size%3A%2010px%3B%20padding%3A%203px%2010px%3B%20background%3A%20%231e1e26%3B%20border%3A%201px%20solid%20%232a2a35%3B%20border-radius%3A%2020px%3B%20color%3A%20%23a0a0e0%3B%20font-family%3A%20'SF%20Mono'%2C%20Consolas%2C%20monospace%3B%20%7D%5C%0A.g2c-scan-reassure%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23555%3B%20text-align%3A%20center%3B%20margin-top%3A%2012px%3B%20%7D%5C%0A.g2c-dl-hero%20%7B%20text-align%3A%20center%3B%20padding%3A%2016px%200%208px%3B%20%7D%5C%0A.g2c-dl-hero%20.g2c-dl-count%20%7B%20font-size%3A%2028px%3B%20font-weight%3A%20700%3B%20color%3A%20%237eb8a0%3B%20%7D%5C%0A.g2c-dl-hero%20.g2c-dl-of%20%7B%20font-size%3A%2014px%3B%20color%3A%20%23555%3B%20%7D%5C%0A.g2c-dl-hero%20.g2c-dl-title%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23888%3B%20margin-top%3A%206px%3B%20white-space%3A%20nowrap%3B%20overflow%3A%20hidden%3B%20text-overflow%3A%20ellipsis%3B%20padding%3A%200%2010px%3B%20%7D%5C%0A.g2c-dl-pct%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23d4a574%3B%20font-family%3A%20'SF%20Mono'%2C%20Consolas%2C%20monospace%3B%20text-align%3A%20right%3B%20margin-top%3A%206px%3B%20%7D%5C%0A.g2c-dl-remaining%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23666%3B%20text-align%3A%20center%3B%20margin-top%3A%208px%3B%20%7D%5C%0A.g2c-complete%20%7B%20text-align%3A%20center%3B%20padding%3A%2020px%200%2010px%3B%20%7D%5C%0A.g2c-complete-icon%20%7B%20font-size%3A%2036px%3B%20margin-bottom%3A%206px%3B%20%7D%5C%0A.g2c-complete-title%20%7B%20font-size%3A%2018px%3B%20font-weight%3A%20700%3B%20color%3A%20%237eb8a0%3B%20%7D%5C%0A.g2c-complete-sub%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23888%3B%20margin-top%3A%206px%3B%20%7D%5C%0A.g2c-complete-models%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23d4a574%3B%20margin-top%3A%206px%3B%20font-family%3A%20'SF%20Mono'%2C%20Consolas%2C%20monospace%3B%20%7D%5C%0A.g2c-complete-models-wrap%20%7B%20display%3A%20flex%3B%20flex-wrap%3A%20wrap%3B%20gap%3A%204px%3B%20justify-content%3A%20center%3B%20margin-top%3A%2012px%3B%20%7D%5C%0A.g2c-models-extra%20%7B%20display%3A%20flex%3B%20flex-wrap%3A%20wrap%3B%20gap%3A%204px%3B%20justify-content%3A%20center%3B%20width%3A%20100%25%3B%20margin-top%3A%204px%3B%20%7D%5C%0A.g2c-models-toggle%20%7B%20font-size%3A%2010px%3B%20padding%3A%203px%2010px%3B%20background%3A%20none%3B%20border%3A%201px%20dashed%20%23333340%3B%20border-radius%3A%2020px%3B%20color%3A%20%23888%3B%20cursor%3A%20pointer%3B%20font-family%3A%20'SF%20Mono'%2C%20Consolas%2C%20monospace%3B%20%7D%5C%0A.g2c-models-toggle%3Ahover%20%7B%20border-color%3A%20%23d4a574%3B%20color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-whatsnext%20%7B%20margin%3A%2016px%200%3B%20padding%3A%2014px%3B%20background%3A%20%23141418%3B%20border%3A%201px%20solid%20%23252530%3B%20border-radius%3A%2010px%3B%20%7D%5C%0A.g2c-whatsnext-title%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23888%3B%20margin-bottom%3A%2010px%3B%20font-weight%3A%20600%3B%20%7D%5C%0A.g2c-whatsnext-item%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23ccc%3B%20line-height%3A%201.8%3B%20margin-bottom%3A%2010px%3B%20%7D%5C%0A.g2c-whatsnext-item%3Alast-child%20%7B%20margin-bottom%3A%200%3B%20%7D%5C%0A.g2c-whatsnext-item%20a%20%7B%20color%3A%20%23d4a574%3B%20text-decoration%3A%20none%3B%20%7D%5C%0A.g2c-whatsnext-item%20a%3Ahover%20%7B%20text-decoration%3A%20underline%3B%20%7D%5C%0A.g2c-whatsnext-badge%20%7B%20font-size%3A%2010px%3B%20color%3A%20%237eb8a0%3B%20background%3A%20rgba(126%2C184%2C160%2C0.12)%3B%20padding%3A%201px%206px%3B%20border-radius%3A%204px%3B%20%7D%5C%0A.g2c-copy-log%20%7B%20background%3A%20none%3B%20border%3A%20none%3B%20color%3A%20%23666%3B%20font-size%3A%2011px%3B%20cursor%3A%20pointer%3B%20padding%3A%206px%200%3B%20margin-top%3A%2010px%3B%20margin-left%3A%2012px%3B%20%7D%5C%0A.g2c-copy-log%3Ahover%20%7B%20color%3A%20%23aaa%3B%20%7D%5C%0A%23gpt2claude-panel%20%7B%20position%3A%20fixed%3B%20top%3A%2050%25%3B%20right%3A%2024px%3B%20transform%3A%20translateY(-50%25)%3B%20width%3A%20360px%3B%20background%3A%20%231a1a1f%3B%20border%3A%201px%20solid%20%23333340%3B%20border-radius%3A%2016px%3B%20box-shadow%3A%200%2025px%2060px%20rgba(0%2C0%2C0%2C0.5)%2C%200%200%200%201px%20rgba(255%2C255%2C255%2C0.06)%3B%20z-index%3A%20999999%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20'Segoe%20UI'%2C%20sans-serif%3B%20color%3A%20%23e8e8ec%3B%20animation%3A%20g2c-fadein%200.3s%20ease-out%3B%20%7D%5C%0A%23gpt2claude-panel%20*%20%7B%20box-sizing%3A%20border-box%3B%20margin%3A%200%3B%20padding%3A%200%3B%20%7D%5C%0A.g2c-header%20%7B%20display%3A%20flex%3B%20justify-content%3A%20space-between%3B%20align-items%3A%20center%3B%20padding%3A%2018px%2022px%2014px%3B%20border-bottom%3A%201px%20solid%20%232a2a35%3B%20background%3A%20%231e1e24%3B%20border-radius%3A%2016px%2016px%200%200%3B%20%7D%5C%0A.g2c-title%20%7B%20font-size%3A%2015px%3B%20font-weight%3A%20700%3B%20letter-spacing%3A%20-0.01em%3B%20%7D%5C%0A.g2c-title%20span.gpt%20%7B%20color%3A%20%23a0a0e0%3B%20%7D%5C%0A.g2c-title%20span.arrow%20%7B%20color%3A%20%23555%3B%20margin%3A%200%204px%3B%20%7D%5C%0A.g2c-title%20span.claude%20%7B%20color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-version%20%7B%20font-size%3A%2010px%3B%20color%3A%20%23666%3B%20font-weight%3A%20600%3B%20margin-top%3A%202px%3B%20%7D%5C%0A.g2c-close%20%7B%20background%3A%20none%3B%20border%3A%20none%3B%20color%3A%20%23777%3B%20font-size%3A%2020px%3B%20cursor%3A%20pointer%3B%20padding%3A%204px%208px%3B%20border-radius%3A%206px%3B%20line-height%3A%201%3B%20%7D%5C%0A.g2c-close%3Ahover%20%7B%20background%3A%20%23252530%3B%20color%3A%20%23e8e8ec%3B%20%7D%5C%0A.g2c-body%20%7B%20padding%3A%2018px%2022px%2014px%3B%20%7D%5C%0A.g2c-btn%20%7B%20width%3A%20100%25%3B%20padding%3A%2014px%2016px%3B%20border%3A%201px%20solid%20%23333340%3B%20border-radius%3A%2012px%3B%20background%3A%20%23222228%3B%20color%3A%20%23e8e8ec%3B%20font-size%3A%2013px%3B%20font-weight%3A%20600%3B%20cursor%3A%20pointer%3B%20text-align%3A%20left%3B%20margin-bottom%3A%2010px%3B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20gap%3A%2012px%3B%20transition%3A%20all%200.15s%20ease%3B%20position%3A%20relative%3B%20overflow%3A%20hidden%3B%20%7D%5C%0A.g2c-btn%3Ahover%20%7B%20background%3A%20%232a2a32%3B%20border-color%3A%20%23444450%3B%20transform%3A%20translateY(-1px)%3B%20%7D%5C%0A.g2c-btn%3Aactive%20%7B%20transform%3A%20translateY(0)%3B%20%7D%5C%0A.g2c-btn.running%20%7B%20pointer-events%3A%20none%3B%20border-color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-btn.done%20%7B%20border-color%3A%20%237eb8a0%3B%20%7D%5C%0A.g2c-btn.error%20%7B%20border-color%3A%20%23e07070%3B%20%7D%5C%0A.g2c-btn-icon%20%7B%20font-size%3A%2020px%3B%20width%3A%2028px%3B%20text-align%3A%20center%3B%20flex-shrink%3A%200%3B%20%7D%5C%0A.g2c-btn-text%20%7B%20flex%3A%201%3B%20%7D%5C%0A.g2c-btn-sub%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23777%3B%20font-weight%3A%20400%3B%20margin-top%3A%203px%3B%20%7D%5C%0A.g2c-progress%20%7B%20margin-top%3A%2010px%3B%20%7D%5C%0A.g2c-progress-bar%20%7B%20width%3A%20100%25%3B%20height%3A%205px%3B%20background%3A%20%23252530%3B%20border-radius%3A%203px%3B%20overflow%3A%20hidden%3B%20%7D%5C%0A.g2c-progress-fill%20%7B%20height%3A%20100%25%3B%20background%3A%20linear-gradient(90deg%2C%20%23d4a574%2C%20%23e8c49a)%3B%20border-radius%3A%203px%3B%20transition%3A%20width%200.3s%20ease%3B%20width%3A%200%25%3B%20%7D%5C%0A.g2c-progress-text%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23999%3B%20margin-top%3A%206px%3B%20%7D%5C%0A.g2c-log%20%7B%20margin-top%3A%2014px%3B%20max-height%3A%20140px%3B%20overflow-y%3A%20auto%3B%20background%3A%20%23141418%3B%20border%3A%201px%20solid%20%23252530%3B%20border-radius%3A%2010px%3B%20padding%3A%2010px%2012px%3B%20font-family%3A%20'SF%20Mono'%2C%20'Consolas'%2C%20monospace%3B%20font-size%3A%2011px%3B%20line-height%3A%201.6%3B%20color%3A%20%23999%3B%20display%3A%20none%3B%20%7D%5C%0A.g2c-log.visible%20%7B%20display%3A%20block%3B%20%7D%5C%0A.g2c-log-entry%20%7B%20white-space%3A%20nowrap%3B%20overflow%3A%20hidden%3B%20text-overflow%3A%20ellipsis%3B%20padding%3A%201px%200%3B%20%7D%5C%0A.g2c-log-entry.error%20%7B%20color%3A%20%23e07070%3B%20%7D%5C%0A.g2c-log-entry.success%20%7B%20color%3A%20%237eb8a0%3B%20%7D%5C%0A.g2c-footer%20%7B%20padding%3A%2014px%2022px%3B%20border-top%3A%201px%20solid%20%23252530%3B%20display%3A%20flex%3B%20justify-content%3A%20space-between%3B%20align-items%3A%20center%3B%20%7D%5C%0A.g2c-footer-text%20%7B%20font-size%3A%2010px%3B%20color%3A%20%23555%3B%20%7D%5C%0A.g2c-footer-link%20%7B%20font-size%3A%2010px%3B%20color%3A%20%23d4a574%3B%20text-decoration%3A%20none%3B%20%7D%5C%0A.g2c-footer-link%3Ahover%20%7B%20text-decoration%3A%20underline%3B%20%7D%5C%0A.g2c-spinner%20%7B%20display%3A%20inline-block%3B%20width%3A%2016px%3B%20height%3A%2016px%3B%20border%3A%202px%20solid%20%23444%3B%20border-top-color%3A%20%23d4a574%3B%20border-radius%3A%2050%25%3B%20animation%3A%20g2c-spin%200.6s%20linear%20infinite%3B%20%7D%5C%0A.g2c-toggle-log%20%7B%20background%3A%20none%3B%20border%3A%20none%3B%20color%3A%20%23666%3B%20font-size%3A%2011px%3B%20cursor%3A%20pointer%3B%20padding%3A%206px%200%3B%20margin-top%3A%2010px%3B%20%7D%5C%0A.g2c-toggle-log%3Ahover%20%7B%20color%3A%20%23aaa%3B%20%7D%5C%0A.g2c-drag-handle%20%7B%20cursor%3A%20move%3B%20%7D%5C%0A.g2c-divider%20%7B%20height%3A%201px%3B%20background%3A%20%232a2a35%3B%20margin%3A%206px%200%2010px%3B%20%7D%5C%0A.g2c-tool-row%20%7B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20justify-content%3A%20space-between%3B%20padding%3A%208px%2012px%3B%20background%3A%20%231e1e26%3B%20border%3A%201px%20solid%20%23252530%3B%20border-radius%3A%2010px%3B%20margin-bottom%3A%206px%3B%20%7D%5C%0A.g2c-tool-label%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23ccc%3B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20gap%3A%208px%3B%20%7D%5C%0A.g2c-tool-label%20.icon%20%7B%20font-size%3A%2016px%3B%20%7D%5C%0A.g2c-tool-label%20.sub%20%7B%20font-size%3A%2010px%3B%20color%3A%20%23666%3B%20display%3A%20block%3B%20%7D%5C%0A.g2c-tool-toggle%20%7B%20padding%3A%204px%2012px%3B%20border-radius%3A%206px%3B%20border%3A%201px%20solid%20%23333340%3B%20background%3A%20%23222228%3B%20color%3A%20%23999%3B%20font-size%3A%2011px%3B%20cursor%3A%20pointer%3B%20font-weight%3A%20600%3B%20transition%3A%20all%200.15s%3B%20%7D%5C%0A.g2c-tool-toggle%3Ahover%20%7B%20border-color%3A%20%23d4a574%3B%20color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-tool-toggle.on%20%7B%20border-color%3A%20%237eb8a0%3B%20color%3A%20%237eb8a0%3B%20background%3A%20rgba(126%2C184%2C160%2C0.08)%3B%20%7D%5C%0A.g2c-tool-toggle.checking%20%7B%20pointer-events%3A%20none%3B%20color%3A%20%23555%3B%20%7D%5C%0A.g2c-tool-note%20%7B%20font-size%3A%2010px%3B%20color%3A%20%237eb8a0%3B%20text-align%3A%20center%3B%20padding%3A%204px%200%202px%3B%20display%3A%20none%3B%20%7D%5C%0A.g2c-filter-panel%20%7B%20margin-top%3A%2010px%3B%20%7D%5C%0A.g2c-filter-section%20%7B%20margin-bottom%3A%2012px%3B%20%7D%5C%0A.g2c-filter-label%20%7B%20font-size%3A%2010px%3B%20color%3A%20%23888%3B%20font-weight%3A%20600%3B%20text-transform%3A%20uppercase%3B%20letter-spacing%3A%200.05em%3B%20margin-bottom%3A%206px%3B%20%7D%5C%0A.g2c-filter-models%20%7B%20max-height%3A%20120px%3B%20overflow-y%3A%20auto%3B%20background%3A%20%23141418%3B%20border%3A%201px%20solid%20%23252530%3B%20border-radius%3A%208px%3B%20padding%3A%206px%208px%3B%20%7D%5C%0A.g2c-model-row%20%7B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20padding%3A%203px%200%3B%20font-size%3A%2012px%3B%20cursor%3A%20pointer%3B%20color%3A%20%23ccc%3B%20%7D%5C%0A.g2c-model-row%3Ahover%20%7B%20color%3A%20%23fff%3B%20%7D%5C%0A.g2c-model-row%20input%20%7B%20margin-right%3A%208px%3B%20accent-color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-model-row%20.cnt%20%7B%20color%3A%20%23666%3B%20margin-left%3A%20auto%3B%20font-size%3A%2010px%3B%20font-family%3A%20monospace%3B%20%7D%5C%0A.g2c-filter-row%20%7B%20display%3A%20flex%3B%20gap%3A%208px%3B%20align-items%3A%20center%3B%20margin-bottom%3A%206px%3B%20%7D%5C%0A.g2c-filter-input%20%7B%20flex%3A%201%3B%20padding%3A%206px%208px%3B%20background%3A%20%23141418%3B%20border%3A%201px%20solid%20%23252530%3B%20border-radius%3A%206px%3B%20color%3A%20%23e8e8ec%3B%20font-size%3A%2012px%3B%20font-family%3A%20monospace%3B%20outline%3A%20none%3B%20%7D%5C%0A.g2c-filter-input%3Afocus%20%7B%20border-color%3A%20%23d4a574%3B%20%7D%5C%0A.g2c-filter-input%3A%3Aplaceholder%20%7B%20color%3A%20%23555%3B%20%7D%5C%0A.g2c-filter-summary%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23d4a574%3B%20padding%3A%208px%200%3B%20font-weight%3A%20600%3B%20%7D%5C%0A.g2c-filter-drop%20%7B%20border%3A%201px%20dashed%20%23333340%3B%20border-radius%3A%208px%3B%20padding%3A%2010px%3B%20text-align%3A%20center%3B%20font-size%3A%2011px%3B%20color%3A%20%23666%3B%20cursor%3A%20pointer%3B%20transition%3A%20all%200.15s%3B%20%7D%5C%0A.g2c-filter-drop%3Ahover%20%7B%20border-color%3A%20%23d4a574%3B%20color%3A%20%23999%3B%20%7D%5C%0A.g2c-filter-drop.active%20%7B%20border-color%3A%20%237eb8a0%3B%20color%3A%20%237eb8a0%3B%20%7D%5C%0A.g2c-select-btns%20%7B%20display%3A%20flex%3B%20gap%3A%206px%3B%20margin-top%3A%204px%3B%20%7D%5C%0A.g2c-select-btns%20button%20%7B%20background%3A%20none%3B%20border%3A%20none%3B%20color%3A%20%23666%3B%20font-size%3A%2010px%3B%20cursor%3A%20pointer%3B%20padding%3A%200%3B%20%7D%5C%0A.g2c-select-btns%20button%3Ahover%20%7B%20color%3A%20%23d4a574%3B%20%7D%5C%0A%22%3B%0Adocument.head.appendChild(style)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20PANEL%20HTML%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20panel%20%3D%20document.createElement(%22div%22)%3B%0Apanel.id%20%3D%20%22gpt2claude-panel%22%3B%0Apanel.innerHTML%20%3D%20'%5C%0A%3Cdiv%20class%3D%22g2c-header%20g2c-drag-handle%22%3E%5C%0A%3Cdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-title%22%3E%3Cspan%20class%3D%22gpt%22%3EGPT%3C%2Fspan%3E%3Cspan%20class%3D%22arrow%22%3E%5Cu2192%3C%2Fspan%3E%3Cspan%20class%3D%22claude%22%3EClaude%3C%2Fspan%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-version%22%3EMigration%20Kit%20v2.4%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cbutton%20class%3D%22g2c-close%22%20id%3D%22g2c-close%22%3E%5Cu00D7%3C%2Fbutton%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-body%22%3E%5C%0A%3Cbutton%20class%3D%22g2c-btn%22%20id%3D%22g2c-btn-memory%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-icon%22%3E%5CuD83E%5CuDDE0%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-text%22%3E%5C%0AExport%20Memories%5C%0A%3Cdiv%20class%3D%22g2c-btn-sub%22%3EFacts%20ChatGPT%20learned%20about%20you%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fbutton%3E%5C%0A%3Cbutton%20class%3D%22g2c-btn%22%20id%3D%22g2c-btn-convos%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-icon%22%3E%5CuD83D%5CuDCAC%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-text%22%3E%5C%0AExport%20All%20Conversations%5C%0A%3Cdiv%20class%3D%22g2c-btn-sub%22%3EScans%20first%2C%20then%20you%20choose%20what%20to%20download%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fbutton%3E%5C%0A%3Cbutton%20class%3D%22g2c-btn%22%20id%3D%22g2c-btn-instructions%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-icon%22%3E%5Cu2699%5CuFE0F%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-text%22%3E%5C%0AExport%20Instructions%5C%0A%3Cdiv%20class%3D%22g2c-btn-sub%22%3ECustom%20instructions%20%26amp%3B%20settings%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fbutton%3E%5C%0A%3Cbutton%20class%3D%22g2c-btn%22%20id%3D%22g2c-btn-all%22%20style%3D%22border-color%3A%23d4a574%3Bbackground%3A%23222228%3B%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-icon%22%3E%5CuD83D%5CuDCE5%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-text%22%3E%5C%0A%3Cspan%20style%3D%22color%3A%23d4a574%3B%22%3EExport%20Everything%3C%2Fspan%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-sub%22%3EAll%20three%20in%20one%20click%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fbutton%3E%5C%0A%3Cdiv%20class%3D%22g2c-divider%22%20id%3D%22g2c-camera-divider%22%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-tool-row%22%20id%3D%22g2c-camera-row%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-tool-label%22%3E%5C%0A%3Cspan%20class%3D%22icon%22%3E%5CuD83D%5CuDCF7%3C%2Fspan%3E%5C%0A%3Cspan%3EDesktop%20Camera%3Cspan%20class%3D%22sub%22%3EChromium%20only%20(Chrome%2C%20Brave%2C%20Edge)%3C%2Fspan%3E%3C%2Fspan%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cbutton%20class%3D%22g2c-tool-toggle%22%20id%3D%22g2c-camera-btn%22%3ECheck%3C%2Fbutton%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-tool-note%22%20id%3D%22g2c-camera-note%22%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-progress%22%20id%3D%22g2c-progress%22%20style%3D%22display%3Anone%3B%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-progress-bar%22%3E%3Cdiv%20class%3D%22g2c-progress-fill%22%20id%3D%22g2c-progress-fill%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-progress-text%22%20id%3D%22g2c-progress-text%22%3E%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cbutton%20class%3D%22g2c-toggle-log%22%20id%3D%22g2c-toggle-log%22%3EShow%20log%20%5Cu25BC%3C%2Fbutton%3E%5C%0A%3Cbutton%20class%3D%22g2c-copy-log%22%20id%3D%22g2c-copy-log%22%3ECopy%20log%3C%2Fbutton%3E%5C%0A%3Cdiv%20class%3D%22g2c-log%22%20id%3D%22g2c-log%22%3E%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-footer%22%3E%5C%0A%3Cspan%20class%3D%22g2c-footer-text%22%3EAll%20data%20stays%20in%20your%20browser%3C%2Fspan%3E%5C%0A%3Ca%20class%3D%22g2c-footer-link%22%20href%3D%22https%3A%2F%2Fgithub.com%2FSiamsnus%2FGPT2Claude-Migration-Kit%22%20target%3D%22_blank%22%3EGitHub%3C%2Fa%3E%5C%0A%3C%2Fdiv%3E%5C%0A'%3B%0Adocument.body.appendChild(panel)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20DRAGGING%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20isDragging%20%3D%20false%3B%0Avar%20dragOffsetX%20%3D%200%3B%0Avar%20dragOffsetY%20%3D%200%3B%0Avar%20header%20%3D%20panel.querySelector(%22.g2c-drag-handle%22)%3B%0Aheader.addEventListener(%22mousedown%22%2C%20function(e)%20%7B%0Aif%20(e.target.classList.contains(%22g2c-close%22))%20return%3B%0AisDragging%20%3D%20true%3B%0Avar%20rect%20%3D%20panel.getBoundingClientRect()%3B%0AdragOffsetX%20%3D%20e.clientX%20-%20rect.left%3B%0AdragOffsetY%20%3D%20e.clientY%20-%20rect.top%3B%0Apanel.style.transition%20%3D%20%22none%22%3B%0Ae.preventDefault()%3B%0A%7D)%3B%0Adocument.addEventListener(%22mousemove%22%2C%20function(e)%20%7B%0Aif%20(!isDragging)%20return%3B%0Apanel.style.right%20%3D%20%22auto%22%3B%0Apanel.style.transform%20%3D%20%22none%22%3B%0Apanel.style.left%20%3D%20(e.clientX%20-%20dragOffsetX)%20%2B%20%22px%22%3B%0Apanel.style.top%20%3D%20(e.clientY%20-%20dragOffsetY)%20%2B%20%22px%22%3B%0A%7D)%3B%0Adocument.addEventListener(%22mouseup%22%2C%20function()%20%7B%0AisDragging%20%3D%20false%3B%0Apanel.style.transition%20%3D%20%22%22%3B%0A%7D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20HELPERS%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20logEl%20%3D%20document.getElementById(%22g2c-log%22)%3B%0Avar%20progressEl%20%3D%20document.getElementById(%22g2c-progress%22)%3B%0Avar%20progressFill%20%3D%20document.getElementById(%22g2c-progress-fill%22)%3B%0Avar%20progressText%20%3D%20document.getElementById(%22g2c-progress-text%22)%3B%0Afunction%20log(msg%2C%20type)%20%7B%0Avar%20entry%20%3D%20document.createElement(%22div%22)%3B%0Aentry.className%20%3D%20%22g2c-log-entry%22%20%2B%20(type%20%3F%20%22%20%22%20%2B%20type%20%3A%20%22%22)%3B%0Aentry.textContent%20%3D%20msg%3B%0AlogEl.appendChild(entry)%3B%0AlogEl.scrollTop%20%3D%20logEl.scrollHeight%3B%0A%7D%0Afunction%20setProgress(pct%2C%20text)%20%7B%0AprogressEl.style.display%20%3D%20%22block%22%3B%0AprogressFill.style.width%20%3D%20pct%20%2B%20%22%25%22%3B%0Aif%20(text)%20progressText.textContent%20%3D%20text%3B%0A%7D%0Afunction%20setButtonState(btn%2C%20state%2C%20label)%20%7B%0Abtn.className%20%3D%20%22g2c-btn%20%22%20%2B%20state%3B%0Avar%20iconEl%20%3D%20btn.querySelector(%22.g2c-btn-icon%22)%3B%0Aif%20(state%20%3D%3D%3D%20%22running%22)%20%7B%0AiconEl.innerHTML%20%3D%20'%3Cdiv%20class%3D%22g2c-spinner%22%3E%3C%2Fdiv%3E'%3B%0A%7D%20else%20if%20(state%20%3D%3D%3D%20%22done%22)%20%7B%0AiconEl.textContent%20%3D%20%22%5Cu2705%22%3B%0A%7D%20else%20if%20(state%20%3D%3D%3D%20%22error%22)%20%7B%0AiconEl.textContent%20%3D%20%22%5Cu274C%22%3B%0A%7D%0Aif%20(label)%20%7B%0Abtn.querySelector(%22.g2c-btn-sub%22).textContent%20%3D%20label%3B%0A%7D%0A%7D%0Afunction%20downloadFile(content%2C%20filename%2C%20type)%20%7B%0Avar%20blob%20%3D%20new%20Blob(%5Bcontent%5D%2C%20%7Btype%3A%20type%20%7C%7C%20%22text%2Fplain%22%7D)%3B%0Avar%20url%20%3D%20URL.createObjectURL(blob)%3B%0Avar%20a%20%3D%20document.createElement(%22a%22)%3B%0Aa.href%20%3D%20url%3B%0Aa.download%20%3D%20filename%3B%0Adocument.body.appendChild(a)%3B%0Aa.click()%3B%0Adocument.body.removeChild(a)%3B%0AURL.revokeObjectURL(url)%3B%0Alog(%22Downloaded%3A%20%22%20%2B%20filename%2C%20%22success%22)%3B%0A%7D%0A%2F%2F%20Safe%20event%20listener%20helper%20%E2%80%94%20guards%20against%20null%20elements%20in%20ChatGPT's%20SPA%0Afunction%20safeAddEvent(id%2C%20event%2C%20handler)%20%7B%0Avar%20el%20%3D%20document.getElementById(id)%3B%0Aif%20(el)%20%7B%0Ael.addEventListener(event%2C%20handler)%3B%0A%7D%20else%20%7B%0Alog(%22Warning%3A%20element%20%23%22%20%2B%20id%20%2B%20%22%20not%20found%22%2C%20%22error%22)%3B%0A%7D%0Areturn%20el%3B%0A%7D%0Avar%20cachedToken%20%3D%20null%3B%0Aasync%20function%20getToken()%20%7B%0Aif%20(cachedToken)%20return%20cachedToken%3B%0Alog(%22Authenticating...%22)%3B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fapi%2Fauth%2Fsession%22%2C%20%7Bcredentials%3A%20%22include%22%7D)%3B%0Aif%20(resp.status%20!%3D%3D%20200)%20%7B%0Athrow%20new%20Error(%22Auth%20failed%20(HTTP%20%22%20%2B%20resp.status%20%2B%20%22).%20Are%20you%20logged%20in%3F%22)%3B%0A%7D%0Avar%20data%20%3D%20await%20resp.json()%3B%0Aif%20(!data.accessToken)%20%7B%0Athrow%20new%20Error(%22No%20token%20found.%20Please%20refresh%20chatgpt.com%20and%20try%20again.%22)%3B%0A%7D%0AcachedToken%20%3D%20data.accessToken%3B%0Alog(%22Authenticated%20OK%22)%3B%0A%2F%2F%20Detect%20account%20type%20(async%2C%20non-blocking)%0AdetectAccount(cachedToken)%3B%0Areturn%20cachedToken%3B%0A%7D%0A%2F%2F%20Account%20detection%20%E2%80%94%20plan%20type%2C%20workspace%20info%0Avar%20cachedAccountInfo%20%3D%20null%3B%0Aasync%20function%20detectAccount(token)%20%7B%0Aif%20(cachedAccountInfo)%20return%20cachedAccountInfo%3B%0Atry%20%7B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Faccounts%2Fcheck%2Fv4-2023-04-27%22%2C%20%7B%0Acredentials%3A%20%22include%22%2C%0Aheaders%3A%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%0A%7D)%3B%0Aif%20(resp.status%20!%3D%3D%20200)%20%7B%0Alog(%22Account%20check%3A%20HTTP%20%22%20%2B%20resp.status)%3B%0Areturn%20null%3B%0A%7D%0Avar%20data%20%3D%20await%20resp.json()%3B%0Avar%20accounts%20%3D%20data.accounts%20%7C%7C%20%7B%7D%3B%0Avar%20acctIds%20%3D%20Object.keys(accounts).filter(function(k)%20%7B%20return%20k%20!%3D%3D%20%22default%22%3B%20%7D)%3B%0Aif%20(acctIds.length%20%3D%3D%3D%200)%20return%20null%3B%0Avar%20primary%20%3D%20accounts%5BacctIds%5B0%5D%5D%3B%0Avar%20acct%20%3D%20primary.account%20%7C%7C%20%7B%7D%3B%0AcachedAccountInfo%20%3D%20%7B%0Aaccount_id%3A%20acct.account_id%20%7C%7C%20acctIds%5B0%5D%2C%0Aplan_type%3A%20acct.plan_type%20%7C%7C%20%22unknown%22%2C%0Astructure%3A%20acct.structure%20%7C%7C%20%22unknown%22%2C%0Aworkspace_type%3A%20acct.workspace_type%20%7C%7C%20null%2C%0Aorganization_id%3A%20acct.organization_id%20%7C%7C%20null%2C%0Ais_hipaa%3A%20acct.is_hipaa_compliant_workspace%20%7C%7C%20false%2C%0Afeatures%3A%20primary.features%20%7C%7C%20%5B%5D%0A%7D%3B%0Avar%20label%20%3D%20cachedAccountInfo.plan_type.charAt(0).toUpperCase()%20%2B%20cachedAccountInfo.plan_type.slice(1)%3B%0Avar%20structLabel%20%3D%20cachedAccountInfo.structure%20%3D%3D%3D%20%22personal%22%20%3F%20%22personal%22%20%3A%20cachedAccountInfo.structure%3B%0Aif%20(cachedAccountInfo.workspace_type)%20structLabel%20%2B%3D%20%22%2F%22%20%2B%20cachedAccountInfo.workspace_type%3B%0Alog(%22Account%3A%20%22%20%2B%20label%20%2B%20%22%20(%22%20%2B%20structLabel%20%2B%20%22)%22)%3B%0Aif%20(cachedAccountInfo.structure%20!%3D%3D%20%22personal%22%20%26%26%20cachedAccountInfo.workspace_type)%20%7B%0Alog(%22Workspace%20detected%3A%20%22%20%2B%20cachedAccountInfo.workspace_type%2C%20%22success%22)%3B%0A%7D%0Areturn%20cachedAccountInfo%3B%0A%7D%20catch%20(e)%20%7B%0Alog(%22Account%20detection%3A%20%22%20%2B%20e.message)%3B%0Areturn%20null%3B%0A%7D%0A%7D%0A%2F%2F%20Extract%20model%20from%20conversation%20metadata%20%E2%80%94%20tries%20multiple%20field%20names%0Afunction%20getConvoModel(c)%20%7B%0Areturn%20c.default_model_slug%20%7C%7C%20c.model%20%7C%7C%20c.model_slug%20%7C%7C%20c.gpt_model%20%7C%7C%20%22unknown%22%3B%0A%7D%0A%2F%2F%20Extract%20timestamp%20from%20conversation%20%E2%80%94%20handles%20epoch%20(seconds%20or%20ms)%20and%20ISO%20strings%0Afunction%20getConvoTime(c)%20%7B%0Avar%20raw%20%3D%20c.update_time%20%7C%7C%20c.updated_at%20%7C%7C%20c.create_time%20%7C%7C%20c.created_at%20%7C%7C%200%3B%0Aif%20(!raw)%20return%200%3B%0Aif%20(typeof%20raw%20%3D%3D%3D%20%22string%22)%20%7B%0A%2F%2F%20ISO%20date%20string%0Avar%20parsed%20%3D%20new%20Date(raw).getTime()%20%2F%201000%3B%0Areturn%20isNaN(parsed)%20%3F%200%20%3A%20parsed%3B%0A%7D%0A%2F%2F%20Epoch%3A%20if%20%3E%201e12%20it's%20milliseconds%2C%20convert%20to%20seconds%0Aif%20(raw%20%3E%201e12)%20return%20raw%20%2F%201000%3B%0Areturn%20raw%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20EXPORT%3A%20MEMORIES%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aasync%20function%20exportMemories()%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-btn-memory%22)%3B%0AsetButtonState(btn%2C%20%22running%22%2C%20%22Exporting...%22)%3B%0Atry%20%7B%0Avar%20token%20%3D%20await%20getToken()%3B%0Alog(%22Fetching%20memories...%22)%3B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fmemories%3Finclude_memory_entries%3Dtrue%22%2C%20%7B%0Acredentials%3A%20%22include%22%2C%0Aheaders%3A%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%0A%7D)%3B%0Aif%20(resp.status%20!%3D%3D%20200)%20%7B%0Athrow%20new%20Error(%22Could%20not%20fetch%20memories%20(HTTP%20%22%20%2B%20resp.status%20%2B%20%22)%22)%3B%0A%7D%0Avar%20data%20%3D%20await%20resp.json()%3B%0Avar%20memories%20%3D%20data.memories%20%7C%7C%20data.results%20%7C%7C%20data%3B%0Avar%20md%20%3D%20%22%23%20ChatGPT%20Memory%20Export%5Cn%22%3B%0Amd%20%2B%3D%20%22%23%20Exported%3A%20%22%20%2B%20new%20Date().toISOString()%20%2B%20%22%5Cn%22%3B%0Amd%20%2B%3D%20%22%23%20Tool%3A%20GPT2Claude%20Migration%20Kit%20v2.4%5Cn%22%3B%0Aif%20(data.memory_num_tokens)%20md%20%2B%3D%20%22%23%20Tokens%20used%3A%20%22%20%2B%20data.memory_num_tokens%20%2B%20%22%20%2F%20%22%20%2B%20(data.memory_max_tokens%20%7C%7C%20%22%3F%22)%20%2B%20%22%5Cn%22%3B%0Amd%20%2B%3D%20%22%5Cn%22%3B%0Avar%20count%20%3D%200%3B%0Avar%20warmCount%20%3D%200%3B%0Avar%20coldCount%20%3D%200%3B%0Aif%20(Array.isArray(memories))%20%7B%0Acount%20%3D%20memories.length%3B%0A%2F%2F%20Sort%3A%20warm%20first%2C%20then%20cold%0Amemories.sort(function(a%2C%20b)%20%7B%0Aif%20(a.status%20%3D%3D%3D%20%22warm%22%20%26%26%20b.status%20!%3D%3D%20%22warm%22)%20return%20-1%3B%0Aif%20(a.status%20!%3D%3D%20%22warm%22%20%26%26%20b.status%20%3D%3D%3D%20%22warm%22)%20return%201%3B%0Areturn%200%3B%0A%7D)%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20memories.length%3B%20i%2B%2B)%20%7B%0Avar%20m%20%3D%20memories%5Bi%5D%3B%0Avar%20content%20%3D%20m.content%20%7C%7C%20m.value%20%7C%7C%20m.text%20%7C%7C%20m.memory%20%7C%7C%20JSON.stringify(m)%3B%0Avar%20status%20%3D%20m.status%20%7C%7C%20%22unknown%22%3B%0Aif%20(status%20%3D%3D%3D%20%22warm%22)%20warmCount%2B%2B%3B%0Aelse%20if%20(status%20%3D%3D%3D%20%22cold%22)%20coldCount%2B%2B%3B%0Avar%20tag%20%3D%20status%20%3D%3D%3D%20%22cold%22%20%3F%20%22%20%5Bolder%2Fless%20relevant%5D%22%20%3A%20%22%22%3B%0Amd%20%2B%3D%20(i%20%2B%201)%20%2B%20%22.%20%22%20%2B%20content%20%2B%20tag%20%2B%20%22%5Cn%22%3B%0A%7D%0A%7D%20else%20%7B%0Amd%20%2B%3D%20JSON.stringify(memories%2C%20null%2C%202)%3B%0A%7D%0Avar%20summary%20%3D%20count%20%2B%20%22%20memories%20(%22%20%2B%20warmCount%20%2B%20%22%20active%22%20%2B%20(coldCount%20%3E%200%20%3F%20%22%2C%20%22%20%2B%20coldCount%20%2B%20%22%20older%22%20%3A%20%22%22)%20%2B%20%22)%22%3B%0Alog(%22Found%20%22%20%2B%20summary)%3B%0AdownloadFile(md%2C%20%22chatgpt_memories.md%22%2C%20%22text%2Fmarkdown%22)%3B%0AsetButtonState(btn%2C%20%22done%22%2C%20summary)%3B%0A%7D%20catch%20(err)%20%7B%0Alog(%22Memory%20export%20failed%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0AsetButtonState(btn%2C%20%22error%22%2C%20err.message)%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20EXPORT%3A%20CONVERSATIONS%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20scannedConvos%20%3D%20%5B%5D%3B%0Avar%20previousExportIds%20%3D%20%7B%7D%3B%0Avar%20BATCH_SIZE%20%3D%2010%3B%0Aasync%20function%20exportConversations()%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-btn-convos%22)%3B%0AsetButtonState(btn%2C%20%22running%22%2C%20%22Scanning...%22)%3B%0A%2F%2F%20Show%20indeterminate%20progress%0Avar%20progressEl%20%3D%20document.getElementById(%22g2c-progress%22)%3B%0AprogressEl.style.display%20%3D%20%22block%22%3B%0Avar%20fillEl%20%3D%20document.getElementById(%22g2c-progress-fill%22)%3B%0AfillEl.classList.add(%22indeterminate%22)%3B%0AfillEl.style.width%20%3D%20%22100%25%22%3B%0A%2F%2F%20Insert%20scan%20hero%20display%20(State%202)%0Avar%20scanHero%20%3D%20document.createElement(%22div%22)%3B%0AscanHero.className%20%3D%20%22g2c-scan-hero%22%3B%0AscanHero.id%20%3D%20%22g2c-scan-hero%22%3B%0AscanHero.innerHTML%20%3D%20'%3Cdiv%20class%3D%22g2c-scan-count%22%20id%3D%22g2c-scan-count%22%3E0%3C%2Fdiv%3E'%20%2B%0A'%3Cdiv%20class%3D%22g2c-scan-label%22%3Econversations%20found%3C%2Fdiv%3E'%20%2B%0A'%3Cdiv%20class%3D%22g2c-scan-status%22%20id%3D%22g2c-scan-status%22%3E'%20%2B%0A'%3Cspan%20class%3D%22g2c-scan-dots%22%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3C%2Fspan%3E'%20%2B%0A'%20Scanning%20your%20conversations%5Cu2026'%20%2B%0A'%3C%2Fdiv%3E'%20%2B%0A'%3Cdiv%20class%3D%22g2c-scan-models%22%20id%3D%22g2c-scan-models%22%3E%3C%2Fdiv%3E'%20%2B%0A'%3Cdiv%20class%3D%22g2c-scan-reassure%22%3EFilter%20options%20appear%20when%20scan%20completes%3C%2Fdiv%3E'%3B%0AprogressEl.parentNode.insertBefore(scanHero%2C%20progressEl.nextSibling)%3B%0Atry%20%7B%0Avar%20token%20%3D%20await%20getToken()%3B%0Avar%20headers%20%3D%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%3B%0AscannedConvos%20%3D%20%5B%5D%3B%0Avar%20offset%20%3D%200%3B%0Avar%20liveModels%20%3D%20%7B%7D%3B%0Avar%20scanLimit%20%3D%20100%3B%0Alog(%22Scanning%20conversation%20list...%22)%3B%0Awhile%20(true)%20%7B%0Avar%20listResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fconversations%3Foffset%3D%22%20%2B%20offset%20%2B%20%22%26limit%3D%22%20%2B%20scanLimit%20%2B%20%22%26order%3Dupdated%22%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(listResp.status%20!%3D%3D%20200)%20%7B%0Athrow%20new%20Error(%22Could%20not%20get%20conversations%20(HTTP%20%22%20%2B%20listResp.status%20%2B%20%22)%22)%3B%0A%7D%0Avar%20listData%20%3D%20await%20listResp.json()%3B%0Avar%20items%20%3D%20listData.items%20%7C%7C%20%5B%5D%3B%0Alog(%22Batch%3A%20%22%20%2B%20items.length%20%2B%20%22%20conversations%20(offset%20%22%20%2B%20offset%20%2B%20%22)%22)%3B%0A%2F%2F%20Log%20first%20item's%20keys%20for%20diagnostics%0Aif%20(offset%20%3D%3D%3D%200%20%26%26%20items.length%20%3E%200)%20%7B%0Avar%20sampleKeys%20%3D%20Object.keys(items%5B0%5D).join(%22%2C%20%22)%3B%0Alog(%22API%20fields%3A%20%22%20%2B%20sampleKeys)%3B%0Avar%20sample%20%3D%20items%5B0%5D%3B%0Alog(%22Sample%20model%3A%20%22%20%2B%20(sample.default_model_slug%20%7C%7C%20sample.model%20%7C%7C%20sample.model_slug%20%7C%7C%20%22null%22))%3B%0Alog(%22Sample%20time%3A%20update%3D%22%20%2B%20sample.update_time%20%2B%20%22%20create%3D%22%20%2B%20sample.create_time)%3B%0Alog(%22Sample%20gizmo%3A%20%22%20%2B%20(sample.gizmo_id%20%7C%7C%20sample.conversation_template_id%20%7C%7C%20sample.workspace_id%20%7C%7C%20%22none%22))%3B%0A%7D%0Afor%20(var%20j%20%3D%200%3B%20j%20%3C%20items.length%3B%20j%2B%2B)%20%7B%0AscannedConvos.push(items%5Bj%5D)%3B%0Avar%20m%20%3D%20getConvoModel(items%5Bj%5D)%3B%0AliveModels%5Bm%5D%20%3D%20(liveModels%5Bm%5D%20%7C%7C%200)%20%2B%201%3B%0A%7D%0A%2F%2F%20Update%20scan%20hero%20display%0Avar%20countEl%20%3D%20document.getElementById(%22g2c-scan-count%22)%3B%0Avar%20statusEl%20%3D%20document.getElementById(%22g2c-scan-status%22)%3B%0Aif%20(countEl)%20countEl.textContent%20%3D%20scannedConvos.length.toLocaleString()%3B%0Aif%20(statusEl)%20%7B%0AstatusEl.innerHTML%20%3D%20items.length%20%3E%3D%20scanLimit%0A%3F%20'%3Cspan%20class%3D%22g2c-scan-dots%22%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3C%2Fspan%3E%20Still%20scanning%20%5Cu2014%20this%20takes%20a%20minute%2C%20all%20good'%0A%3A%20'Scan%20complete!'%3B%0A%7D%0A%2F%2F%20Update%20model%20tags%0Avar%20tagsHtml%20%3D%20%22%22%3B%0Avar%20modelKeys%20%3D%20Object.keys(liveModels).sort(function(a%2C%20b)%20%7B%20return%20liveModels%5Bb%5D%20-%20liveModels%5Ba%5D%3B%20%7D)%3B%0Afor%20(var%20mi%20%3D%200%3B%20mi%20%3C%20modelKeys.length%3B%20mi%2B%2B)%20%7B%0AtagsHtml%20%2B%3D%20'%3Cspan%20class%3D%22g2c-scan-tag%22%3E'%20%2B%20modelKeys%5Bmi%5D%20%2B%20'%20('%20%2B%20liveModels%5BmodelKeys%5Bmi%5D%5D%20%2B%20')%3C%2Fspan%3E'%3B%0A%7D%0Avar%20modelsEl%20%3D%20document.getElementById(%22g2c-scan-models%22)%3B%0Aif%20(modelsEl)%20modelsEl.innerHTML%20%3D%20tagsHtml%3B%0Aoffset%20%2B%3D%20items.length%3B%0Aif%20(items.length%20%3C%20scanLimit)%20break%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%0Alog(%22Total%20conversations%3A%20%22%20%2B%20scannedConvos.length)%3B%0A%2F%2F%20Discover%20and%20fetch%20project%20conversations%20via%20sidebar%20DOM%20scraping%0Atry%20%7B%0Alog(%22Checking%20for%20projects...%22)%3B%0Avar%20statusEl%20%3D%20document.getElementById(%22g2c-scan-status%22)%3B%0Aif%20(statusEl)%20statusEl.innerHTML%20%3D%20'%3Cspan%20class%3D%22g2c-scan-dots%22%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3C%2Fspan%3E%20Checking%20projects%5Cu2026'%3B%0Avar%20discoveredProjects%20%3D%20%7B%7D%3B%0A%2F%2F%20Method%201%3A%20Check%20conversation%20items%20for%20gizmo_id%20(project%20conversations%20have%20this)%0Afor%20(var%20gi%20%3D%200%3B%20gi%20%3C%20scannedConvos.length%3B%20gi%2B%2B)%20%7B%0Avar%20gid%20%3D%20scannedConvos%5Bgi%5D.gizmo_id%20%7C%7C%20scannedConvos%5Bgi%5D.conversation_template_id%20%7C%7C%20scannedConvos%5Bgi%5D.workspace_id%20%7C%7C%20null%3B%0Aif%20(gid%20%26%26%20gid.indexOf(%22g-p-%22)%20%3D%3D%3D%200%20%26%26%20!discoveredProjects%5Bgid%5D)%20%7B%0AdiscoveredProjects%5Bgid%5D%20%3D%20null%3B%20%2F%2F%20name%20unknown%20yet%0Alog(%22Found%20project%20gizmo%20in%20conversation%20list%3A%20%22%20%2B%20gid)%3B%0A%7D%0A%7D%0A%2F%2F%20Method%202%3A%20Try%20API%20endpoint%20for%20user's%20gizmos%2Fprojects%0Atry%20%7B%0Avar%20gizmoResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fgizmos%2Fdiscovery%2Fmine%22%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(gizmoResp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20gizmoData%20%3D%20await%20gizmoResp.json()%3B%0Avar%20gizmoItems%20%3D%20gizmoData.list%20%7C%7C%20gizmoData.items%20%7C%7C%20gizmoData.gizmos%20%7C%7C%20%5B%5D%3B%0Aif%20(Array.isArray(gizmoItems))%20%7B%0Afor%20(var%20gmi%20%3D%200%3B%20gmi%20%3C%20gizmoItems.length%3B%20gmi%2B%2B)%20%7B%0Avar%20gizmo%20%3D%20gizmoItems%5Bgmi%5D.resource%20%7C%7C%20gizmoItems%5Bgmi%5D.gizmo%20%7C%7C%20gizmoItems%5Bgmi%5D%3B%0Avar%20gizmoId%20%3D%20gizmo.id%20%7C%7C%20gizmo.short_url%20%7C%7C%20%22%22%3B%0Aif%20(gizmoId.indexOf(%22g-p-%22)%20%3D%3D%3D%200%20%7C%7C%20(gizmo.type%20%26%26%20gizmo.type%20%3D%3D%3D%20%22project%22))%20%7B%0Avar%20gName%20%3D%20(gizmo.display%20%26%26%20gizmo.display.name)%20%7C%7C%20gizmo.name%20%7C%7C%20gizmo.title%20%7C%7C%20%22Project%22%3B%0AdiscoveredProjects%5BgizmoId%5D%20%3D%20gName%3B%0Alog(%22Found%20project%20via%20API%3A%20%22%20%2B%20gName%20%2B%20%22%20(%22%20%2B%20gizmoId%20%2B%20%22)%22)%3B%0A%7D%0A%7D%0A%7D%0A%7D%20else%20%7B%0Alog(%22Gizmos%20API%3A%20HTTP%20%22%20%2B%20gizmoResp.status%20%2B%20%22%20(trying%20other%20methods)%22)%3B%0A%7D%0A%7D%20catch%20(apiErr)%20%7B%0Alog(%22Gizmos%20API%20failed%3A%20%22%20%2B%20apiErr.message%20%2B%20%22%20(trying%20other%20methods)%22)%3B%0A%7D%0A%2F%2F%20Method%203%3A%20DOM%20scraping%20fallback%20%E2%80%94%20scan%20sidebar%20for%20project%20links%0Avar%20projLinks%20%3D%20document.querySelectorAll('a%5Bhref*%3D%22%2Fg%2Fg-p-%22%5D')%3B%0Afor%20(var%20pl%20%3D%200%3B%20pl%20%3C%20projLinks.length%3B%20pl%2B%2B)%20%7B%0Avar%20href%20%3D%20projLinks%5Bpl%5D.getAttribute(%22href%22)%20%7C%7C%20%22%22%3B%0Avar%20idMatch%20%3D%20href.match(%2Fg-p-%5Ba-f0-9%5D%2B%2F)%3B%0Aif%20(!idMatch)%20continue%3B%0Avar%20projId%20%3D%20idMatch%5B0%5D%3B%0Aif%20(discoveredProjects%5BprojId%5D)%20continue%3B%0Avar%20slugMatch%20%3D%20href.match(%2Fg-p-%5Ba-f0-9%5D%2B-(%5B%5E%2F%5D%2B)%2F)%3B%0Avar%20linkText%20%3D%20projLinks%5Bpl%5D.textContent.trim()%3B%0Avar%20projName%20%3D%20linkText%20%7C%7C%20(slugMatch%20%3F%20slugMatch%5B1%5D.replace(%2F-%2Fg%2C%20%22%20%22)%20%3A%20%22Project%22)%3B%0Aif%20(href.indexOf(%22%2Fc%2F%22)%20%3E%20-1)%20continue%3B%0AdiscoveredProjects%5BprojId%5D%20%3D%20projName%3B%0Alog(%22Found%20project%20via%20DOM%3A%20%22%20%2B%20projName%20%2B%20%22%20(%22%20%2B%20projId%20%2B%20%22)%22)%3B%0A%7D%0Avar%20projIds%20%3D%20Object.keys(discoveredProjects)%3B%0Aif%20(projIds.length%20%3E%200)%20%7B%0Alog(%22Found%20%22%20%2B%20projIds.length%20%2B%20%22%20project(s)%20total%22)%3B%0A%2F%2F%20Build%20index%20of%20existing%20conversation%20IDs%20for%20deduplication%0Avar%20existingIdx%20%3D%20%7B%7D%3B%0Afor%20(var%20ei%20%3D%200%3B%20ei%20%3C%20scannedConvos.length%3B%20ei%2B%2B)%20%7B%0AexistingIdx%5BscannedConvos%5Bei%5D.id%5D%20%3D%20ei%3B%0A%7D%0Afor%20(var%20pi%20%3D%200%3B%20pi%20%3C%20projIds.length%3B%20pi%2B%2B)%20%7B%0Avar%20projId%20%3D%20projIds%5Bpi%5D%3B%0Avar%20projName%20%3D%20discoveredProjects%5BprojId%5D%20%7C%7C%20%22Project%22%3B%0A%2F%2F%20Try%20to%20resolve%20project%20name%20if%20unknown%0Aif%20(projName%20%3D%3D%3D%20%22Project%22%20%7C%7C%20projName%20%3D%3D%3D%20null)%20%7B%0Atry%20%7B%0Avar%20infoResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fgizmos%2F%22%20%2B%20projId%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(infoResp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20infoData%20%3D%20await%20infoResp.json()%3B%0Avar%20gizmoInfo%20%3D%20infoData.gizmo%20%7C%7C%20infoData%3B%0AprojName%20%3D%20(gizmoInfo.display%20%26%26%20gizmoInfo.display.name)%20%7C%7C%20gizmoInfo.name%20%7C%7C%20gizmoInfo.title%20%7C%7C%20%22Project%22%3B%0Alog(%22Resolved%20project%20name%3A%20%22%20%2B%20projName)%3B%0A%7D%0A%7D%20catch%20(nameErr)%20%7B%0A%2F%2F%20keep%20default%20name%0A%7D%0A%7D%0Alog(%22Fetching%20project%3A%20%22%20%2B%20projName%20%2B%20%22%20(%22%20%2B%20projId%20%2B%20%22)%22)%3B%0Avar%20statusEl%20%3D%20document.getElementById(%22g2c-scan-status%22)%3B%0Aif%20(statusEl)%20statusEl.innerHTML%20%3D%20'%3Cspan%20class%3D%22g2c-scan-dots%22%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3C%2Fspan%3E%20Scanning%20project%3A%20'%20%2B%20projName%20%2B%20'%5Cu2026'%3B%0Avar%20cursor%20%3D%200%3B%0Avar%20projConvoCount%20%3D%200%3B%0Avar%20projTaggedCount%20%3D%200%3B%0Awhile%20(true)%20%7B%0Avar%20projConvoResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fgizmos%2F%22%20%2B%20projId%20%2B%20%22%2Fconversations%3Fcursor%3D%22%20%2B%20cursor%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(projConvoResp.status%20!%3D%3D%20200)%20%7B%0Alog(%22Project%20%22%20%2B%20projName%20%2B%20%22%3A%20HTTP%20%22%20%2B%20projConvoResp.status%2C%20%22error%22)%3B%0Abreak%3B%0A%7D%0Avar%20projConvoData%20%3D%20await%20projConvoResp.json()%3B%0Avar%20projItems%20%3D%20projConvoData.items%20%7C%7C%20%5B%5D%3B%0Afor%20(var%20pj%20%3D%200%3B%20pj%20%3C%20projItems.length%3B%20pj%2B%2B)%20%7B%0AprojItems%5Bpj%5D._project%20%3D%20projName%3B%0AprojItems%5Bpj%5D._project_id%20%3D%20projId%3B%0A%2F%2F%20Only%20add%20if%20not%20already%20in%20main%20scan%20(deduplicate)%0Aif%20(existingIdx%5BprojItems%5Bpj%5D.id%5D%20%3D%3D%3D%20undefined)%20%7B%0AscannedConvos.push(projItems%5Bpj%5D)%3B%0AexistingIdx%5BprojItems%5Bpj%5D.id%5D%20%3D%20scannedConvos.length%20-%201%3B%0AprojConvoCount%2B%2B%3B%0A%7D%20else%20%7B%0A%2F%2F%20Tag%20the%20existing%20entry%20as%20belonging%20to%20this%20project%0Avar%20dupIdx%20%3D%20existingIdx%5BprojItems%5Bpj%5D.id%5D%3B%0AscannedConvos%5BdupIdx%5D._project%20%3D%20projName%3B%0AscannedConvos%5BdupIdx%5D._project_id%20%3D%20projId%3B%0AprojTaggedCount%2B%2B%3B%0A%7D%0A%7D%0Avar%20countEl%20%3D%20document.getElementById(%22g2c-scan-count%22)%3B%0Aif%20(countEl)%20countEl.textContent%20%3D%20scannedConvos.length.toLocaleString()%3B%0A%2F%2F%20Cursor-based%20pagination%3A%20null%20cursor%20means%20no%20more%20pages%0Aif%20(projConvoData.cursor%20%3D%3D%3D%20null%20%7C%7C%20projConvoData.cursor%20%3D%3D%3D%20undefined%20%7C%7C%20projItems.length%20%3D%3D%3D%200)%20break%3B%0Acursor%20%3D%20projConvoData.cursor%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%0Alog(%22Project%20%22%20%2B%20projName%20%2B%20%22%3A%20%22%20%2B%20projConvoCount%20%2B%20%22%20new%2C%20%22%20%2B%20projTaggedCount%20%2B%20%22%20tagged%22)%3B%0A%7D%0Alog(%22Total%20with%20projects%3A%20%22%20%2B%20scannedConvos.length)%3B%0A%7D%20else%20%7B%0Alog(%22No%20projects%20found%22)%3B%0A%7D%0A%7D%20catch%20(projErr)%20%7B%0Alog(%22Projects%20check%20failed%3A%20%22%20%2B%20projErr.message%20%2B%20%22%20(continuing%20without)%22)%3B%0A%7D%0A%2F%2F%20Discover%20shared%20conversations%0Atry%20%7B%0Alog(%22Checking%20shared%20conversations...%22)%3B%0Avar%20statusEl%20%3D%20document.getElementById(%22g2c-scan-status%22)%3B%0Aif%20(statusEl)%20statusEl.innerHTML%20%3D%20'%3Cspan%20class%3D%22g2c-scan-dots%22%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3Cspan%3E%3C%2Fspan%3E%3C%2Fspan%3E%20Checking%20shared%20conversations%5Cu2026'%3B%0Avar%20sharedResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fshared_conversations%3Forder%3Dupdated%26limit%3D100%26offset%3D0%22%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(sharedResp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20sharedData%20%3D%20await%20sharedResp.json()%3B%0Avar%20sharedItems%20%3D%20sharedData.items%20%7C%7C%20%5B%5D%3B%0Avar%20totalShared%20%3D%20sharedItems.length%3B%0A%2F%2F%20Paginate%20if%20more%0Avar%20sharedOffset%20%3D%20sharedItems.length%3B%0Awhile%20(sharedItems.length%20%3E%3D%20100)%20%7B%0Avar%20moreResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fshared_conversations%3Forder%3Dupdated%26limit%3D100%26offset%3D%22%20%2B%20sharedOffset%2C%0A%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(moreResp.status%20!%3D%3D%20200)%20break%3B%0Avar%20moreData%20%3D%20await%20moreResp.json()%3B%0Avar%20moreItems%20%3D%20moreData.items%20%7C%7C%20%5B%5D%3B%0Aif%20(moreItems.length%20%3D%3D%3D%200)%20break%3B%0Afor%20(var%20mi%20%3D%200%3B%20mi%20%3C%20moreItems.length%3B%20mi%2B%2B)%20sharedItems.push(moreItems%5Bmi%5D)%3B%0AsharedOffset%20%2B%3D%20moreItems.length%3B%0AtotalShared%20%3D%20sharedItems.length%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%0A%2F%2F%20Build%20index%20of%20existing%20conversation%20IDs%20for%20deduplication%0Avar%20existingIds%20%3D%20%7B%7D%3B%0Afor%20(var%20ei%20%3D%200%3B%20ei%20%3C%20scannedConvos.length%3B%20ei%2B%2B)%20%7B%0AexistingIds%5BscannedConvos%5Bei%5D.id%5D%20%3D%20true%3B%0A%7D%0Avar%20newShared%20%3D%200%3B%0Afor%20(var%20si%20%3D%200%3B%20si%20%3C%20sharedItems.length%3B%20si%2B%2B)%20%7B%0Avar%20shared%20%3D%20sharedItems%5Bsi%5D%3B%0A%2F%2F%20Shared%20items%20might%20have%20conversation_id%20linking%20to%20a%20regular%20conversation%0Avar%20sharedConvoId%20%3D%20shared.conversation_id%20%7C%7C%20shared.id%3B%0Aif%20(existingIds%5BsharedConvoId%5D)%20%7B%0A%2F%2F%20Already%20in%20main%20list%20%E2%80%94%20tag%20it%20as%20shared%20but%20don't%20duplicate%0Afor%20(var%20ti%20%3D%200%3B%20ti%20%3C%20scannedConvos.length%3B%20ti%2B%2B)%20%7B%0Aif%20(scannedConvos%5Bti%5D.id%20%3D%3D%3D%20sharedConvoId)%20%7B%0AscannedConvos%5Bti%5D._also_shared%20%3D%20true%3B%0AscannedConvos%5Bti%5D._share_id%20%3D%20shared.share_id%20%7C%7C%20shared.id%3B%0Abreak%3B%0A%7D%0A%7D%0A%7D%20else%20%7B%0A%2F%2F%20New%20shared%20conversation%20%E2%80%94%20add%20to%20scan%20list%0Ashared._shared%20%3D%20true%3B%0Ashared._share_id%20%3D%20shared.share_id%20%7C%7C%20shared.id%3B%0Aif%20(!shared.title)%20shared.title%20%3D%20shared.title%20%7C%7C%20%22Shared%20conversation%22%3B%0AscannedConvos.push(shared)%3B%0AnewShared%2B%2B%3B%0A%7D%0A%7D%0Aif%20(totalShared%20%3E%200)%20%7B%0Alog(%22Shared%20conversations%3A%20%22%20%2B%20totalShared%20%2B%20%22%20found%20(%22%20%2B%20newShared%20%2B%20%22%20unique)%22)%3B%0A%7D%20else%20%7B%0Alog(%22No%20shared%20conversations%22)%3B%0A%7D%0Avar%20countEl%20%3D%20document.getElementById(%22g2c-scan-count%22)%3B%0Aif%20(countEl)%20countEl.textContent%20%3D%20scannedConvos.length.toLocaleString()%3B%0A%7D%20else%20if%20(sharedResp.status%20!%3D%3D%20404)%20%7B%0Alog(%22Shared%20conversations%3A%20HTTP%20%22%20%2B%20sharedResp.status%20%2B%20%22%20(skipped)%22)%3B%0A%7D%20else%20%7B%0Alog(%22No%20shared%20conversations%22)%3B%0A%7D%0A%7D%20catch%20(sharedErr)%20%7B%0Alog(%22Shared%20conversations%20check%3A%20%22%20%2B%20sharedErr.message%20%2B%20%22%20(continuing%20without)%22)%3B%0A%7D%0A%2F%2F%20Show%20filter%20panel%0AsetButtonState(btn%2C%20%22done%22%2C%20scannedConvos.length%20%2B%20%22%20conversations%20found%22)%3B%0A%2F%2F%20Clean%20up%20scan%20hero%20display%0Avar%20scanHeroEl%20%3D%20document.getElementById(%22g2c-scan-hero%22)%3B%0Aif%20(scanHeroEl)%20scanHeroEl.parentNode.removeChild(scanHeroEl)%3B%0Avar%20fillEl%20%3D%20document.getElementById(%22g2c-progress-fill%22)%3B%0AfillEl.classList.remove(%22indeterminate%22)%3B%0AfillEl.style.width%20%3D%20%220%25%22%3B%0Adocument.getElementById(%22g2c-progress%22).style.display%20%3D%20%22none%22%3B%0AshowFilterPanel()%3B%0A%7D%20catch%20(err)%20%7B%0Alog(%22Scan%20failed%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0AsetButtonState(btn%2C%20%22error%22%2C%20err.message)%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20FILTER%20PANEL%20(State%203)%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Afunction%20showFilterPanel()%20%7B%0Avar%20models%20%3D%20%7B%7D%3B%0Avar%20oldest%20%3D%20Infinity%3B%0Avar%20newest%20%3D%200%3B%0Avar%20sources%20%3D%20%7B%7D%3B%20%2F%2F%20Track%20main%20vs%20project%20conversations%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20scannedConvos.length%3B%20i%2B%2B)%20%7B%0Avar%20c%20%3D%20scannedConvos%5Bi%5D%3B%0Avar%20m%20%3D%20getConvoModel(c)%3B%0Amodels%5Bm%5D%20%3D%20(models%5Bm%5D%20%7C%7C%200)%20%2B%201%3B%0Avar%20t%20%3D%20getConvoTime(c)%3B%0Aif%20(t%20%3E%200%20%26%26%20t%20%3C%20oldest)%20oldest%20%3D%20t%3B%0Aif%20(t%20%3E%200%20%26%26%20t%20%3E%20newest)%20newest%20%3D%20t%3B%0A%2F%2F%20Track%20source%0Avar%20src%20%3D%20c._shared%20%3F%20%22Shared%20conversations%22%20%3A%20(c._project%20%7C%7C%20%22Main%20conversations%22)%3B%0Asources%5Bsrc%5D%20%3D%20(sources%5Bsrc%5D%20%7C%7C%200)%20%2B%201%3B%0A%7D%0Avar%20modelKeys%20%3D%20Object.keys(models).sort(function(a%2C%20b)%20%7B%20return%20models%5Bb%5D%20-%20models%5Ba%5D%3B%20%7D)%3B%0Afunction%20tsToDate(ts)%20%7B%0Aif%20(!ts%20%7C%7C%20ts%20%3D%3D%3D%20Infinity)%20return%20%22%22%3B%0Aif%20(typeof%20ts%20%3D%3D%3D%20%22string%22)%20%7B%0A%2F%2F%20ISO%20string%20%E2%80%94%20just%20extract%20the%20date%20part%0Avar%20d%20%3D%20new%20Date(ts)%3B%0Aif%20(isNaN(d.getTime()))%20return%20%22%22%3B%0Areturn%20d.toISOString().slice(0%2C%2010)%3B%0A%7D%0Avar%20d%20%3D%20new%20Date(ts%20%3E%201e12%20%3F%20ts%20%3A%20ts%20*%201000)%3B%0Aif%20(isNaN(d.getTime()))%20return%20%22%22%3B%0Areturn%20d.toISOString().slice(0%2C%2010)%3B%0A%7D%0Avar%20modelCheckboxes%20%3D%20%22%22%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20modelKeys.length%3B%20i%2B%2B)%20%7B%0Avar%20mk%20%3D%20modelKeys%5Bi%5D%3B%0AmodelCheckboxes%20%2B%3D%20'%3Clabel%20class%3D%22g2c-model-row%22%3E%3Cinput%20type%3D%22checkbox%22%20checked%20data-model%3D%22'%20%2B%20mk%20%2B%20'%22%3E%20'%20%2B%20mk%20%2B%20'%3Cspan%20class%3D%22cnt%22%3E'%20%2B%20models%5Bmk%5D%20%2B%20'%3C%2Fspan%3E%3C%2Flabel%3E'%3B%0A%7D%0A%2F%2F%20Build%20source%2Fproject%20checkboxes%0Avar%20sourceKeys%20%3D%20Object.keys(sources).sort(function(a%2C%20b)%20%7B%0Aif%20(a%20%3D%3D%3D%20%22Main%20conversations%22)%20return%20-1%3B%0Aif%20(b%20%3D%3D%3D%20%22Main%20conversations%22)%20return%201%3B%0Areturn%20sources%5Bb%5D%20-%20sources%5Ba%5D%3B%0A%7D)%3B%0Avar%20sourceCheckboxes%20%3D%20%22%22%3B%0Avar%20hasProjects%20%3D%20sourceKeys.length%20%3E%201%3B%0Afor%20(var%20si%20%3D%200%3B%20si%20%3C%20sourceKeys.length%3B%20si%2B%2B)%20%7B%0Avar%20sk%20%3D%20sourceKeys%5Bsi%5D%3B%0Avar%20icon%20%3D%20sk%20%3D%3D%3D%20%22Main%20conversations%22%20%3F%20%22%5CuD83D%5CuDCAC%22%20%3A%20(sk%20%3D%3D%3D%20%22Shared%20conversations%22%20%3F%20%22%5CuD83D%5CuDD17%22%20%3A%20%22%5CuD83D%5CuDCC1%22)%3B%0AsourceCheckboxes%20%2B%3D%20'%3Clabel%20class%3D%22g2c-model-row%22%3E%3Cinput%20type%3D%22checkbox%22%20checked%20data-source%3D%22'%20%2B%20sk%20%2B%20'%22%3E%20'%20%2B%20icon%20%2B%20'%20'%20%2B%20sk%20%2B%20'%3Cspan%20class%3D%22cnt%22%3E'%20%2B%20sources%5Bsk%5D%20%2B%20'%3C%2Fspan%3E%3C%2Flabel%3E'%3B%0A%7D%0A%2F%2F%20Scan%20summary%20%E2%80%94%20show%20project%20breakdown%20if%20applicable%0Avar%20projCount%20%3D%20sourceKeys.length%20-%201%3B%0Avar%20projConvoCount%20%3D%20scannedConvos.filter(function(c)%20%7B%20return%20c._project%3B%20%7D).length%3B%0Avar%20mainCount%20%3D%20scannedConvos.length%20-%20projConvoCount%3B%0Avar%20scanSummaryText%20%3D%20scannedConvos.length.toLocaleString()%20%2B%20'%3C%2Fspan%3E'%20%2B%0A'%3Cspan%20style%3D%22font-size%3A12px%3Bcolor%3A%23888%3B%22%3E%20conversations%20scanned%3C%2Fspan%3E'%3B%0Aif%20(projCount%20%3E%200)%20%7B%0AscanSummaryText%20%2B%3D%20'%3Cdiv%20style%3D%22font-size%3A11px%3Bcolor%3A%237eb8a0%3Bmargin-top%3A4px%3B%22%3E'%20%2B%0AmainCount.toLocaleString()%20%2B%20'%20main%20%2B%20'%20%2B%20projConvoCount%20%2B%20'%20from%20'%20%2B%20projCount%20%2B%20'%20project'%20%2B%20(projCount%20%3E%201%20%3F%20's'%20%3A%20'')%20%2B%20'%3C%2Fdiv%3E'%3B%0A%7D%0Avar%20scanSummary%20%3D%20'%3Cdiv%20style%3D%22text-align%3Acenter%3Bmargin-bottom%3A14px%3B%22%3E'%20%2B%0A'%3Cspan%20style%3D%22font-size%3A28px%3Bfont-weight%3A800%3Bcolor%3A%237eb8a0%3B%22%3E'%20%2B%20scanSummaryText%20%2B%0A'%3C%2Fdiv%3E'%3B%0A%2F%2F%20Determine%20if%20model%20filter%20is%20useful%20(not%20just%20%22unknown%22)%0Avar%20hasRealModels%20%3D%20modelKeys.length%20%3E%201%20%7C%7C%20(modelKeys.length%20%3D%3D%3D%201%20%26%26%20modelKeys%5B0%5D%20!%3D%3D%20%22unknown%22)%3B%0Avar%20modelSection%20%3D%20''%3B%0Aif%20(hasRealModels)%20%7B%0AmodelSection%20%3D%20'%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3EModels%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-models%22%20id%3D%22g2c-filter-models%22%3E'%20%2B%20modelCheckboxes%20%2B%20'%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-select-btns%22%3E%3Cbutton%20id%3D%22g2c-sel-all%22%3ESelect%20all%3C%2Fbutton%3E%20%5Cu00B7%20%3Cbutton%20id%3D%22g2c-sel-none%22%3ESelect%20none%3C%2Fbutton%3E%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E'%3B%0A%7D%0Avar%20filterHtml%20%3D%20'%5C%0A%3Cdiv%20class%3D%22g2c-filter-panel%22%20id%3D%22g2c-filter-panel%22%3E%5C%0A'%20%2B%20scanSummary%20%2B%20'%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3ESearch%20conversations%3C%2Fdiv%3E%5C%0A%3Cinput%20type%3D%22text%22%20class%3D%22g2c-filter-input%22%20id%3D%22g2c-search%22%20placeholder%3D%22Filter%20by%20title%5Cu2026%22%20style%3D%22width%3A100%25%3B%22%3E%5C%0A%3Cdiv%20style%3D%22font-size%3A10px%3Bcolor%3A%23555%3Bmargin-top%3A3px%3B%22%3EFilters%20by%20conversation%20title.%20Leave%20empty%20%3D%20all.%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A'%20%2B%20(hasProjects%20%3F%20'%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3ESource%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-models%22%20id%3D%22g2c-filter-sources%22%3E'%20%2B%20sourceCheckboxes%20%2B%20'%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E'%20%3A%20'')%20%2B%20'%5C%0A'%20%2B%20modelSection%20%2B%20'%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3EDate%20range%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-row%22%3E%5C%0A%3Cinput%20type%3D%22date%22%20class%3D%22g2c-filter-input%22%20id%3D%22g2c-date-from%22%20value%3D%22'%20%2B%20tsToDate(oldest)%20%2B%20'%22%3E%5C%0A%3Cspan%20style%3D%22color%3A%23555%3B%22%3E%5Cu2192%3C%2Fspan%3E%5C%0A%3Cinput%20type%3D%22date%22%20class%3D%22g2c-filter-input%22%20id%3D%22g2c-date-to%22%20value%3D%22'%20%2B%20tsToDate(newest)%20%2B%20'%22%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-select-btns%22%20id%3D%22g2c-era-btns%22%20style%3D%22flex-wrap%3Awrap%3Bmargin-top%3A4px%3B%22%3E%5C%0A%3Cbutton%20data-era%3D%22all%22%3EAll%3C%2Fbutton%3E%20%5Cu00B7%5C%0A%3Cbutton%20data-era%3D%22gpt35%22%3EGPT-3.5%3C%2Fbutton%3E%20%5Cu00B7%5C%0A%3Cbutton%20data-era%3D%22gpt4%22%3EGPT-4%3C%2Fbutton%3E%20%5Cu00B7%5C%0A%3Cbutton%20data-era%3D%22gpt4o%22%3EGPT-4o%3C%2Fbutton%3E%20%5Cu00B7%5C%0A%3Cbutton%20data-era%3D%22gpt5%22%3EGPT-5%2B%3C%2Fbutton%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3EMax%20conversations%20(0%20%3D%20all)%3C%2Fdiv%3E%5C%0A%3Cinput%20type%3D%22number%22%20class%3D%22g2c-filter-input%22%20id%3D%22g2c-limit%22%20value%3D%220%22%20min%3D%220%22%20style%3D%22width%3A100%25%3B%22%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-section%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-label%22%3EIncremental%20export%20(skip%20already%20exported)%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-drop%22%20id%3D%22g2c-prev-drop%22%3EDrop%20or%20click%20to%20load%20previous%20export%3C%2Fdiv%3E%5C%0A%3Cinput%20type%3D%22file%22%20id%3D%22g2c-prev-file%22%20accept%3D%22.json%22%20style%3D%22display%3Anone%3B%22%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-filter-summary%22%20id%3D%22g2c-filter-summary%22%3E'%20%2B%20scannedConvos.length%20%2B%20'%20conversations%20selected%3C%2Fdiv%3E%5C%0A%3Cbutton%20class%3D%22g2c-btn%22%20id%3D%22g2c-btn-download%22%20style%3D%22border-color%3A%23d4a574%3Bmargin-bottom%3A0%3B%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-icon%22%3E%5CuD83D%5CuDCE5%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-text%22%3E%3Cspan%20style%3D%22color%3A%23d4a574%3B%22%3EDownload%20'%20%2B%20scannedConvos.length%20%2B%20'%20conversations%3C%2Fspan%3E%5C%0A%3Cdiv%20class%3D%22g2c-btn-sub%22%3E~'%20%2B%20estimateTime(scannedConvos.length)%20%2B%20'%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fbutton%3E%5C%0A%3C%2Fdiv%3E'%3B%0A%2F%2F%20Insert%20filter%20panel%20%E2%80%94%20with%20fallback%20for%20SPA%20DOM%20issues%0Avar%20bodyEl%20%3D%20panel.querySelector(%22.g2c-body%22)%3B%0Aif%20(!bodyEl)%20%7B%0Alog(%22Warning%3A%20panel%20body%20not%20found%22%2C%20%22error%22)%3B%0Areturn%3B%0A%7D%0Avar%20progressEl%20%3D%20document.getElementById(%22g2c-progress%22)%3B%0Avar%20filterDiv%20%3D%20document.createElement(%22div%22)%3B%0AfilterDiv.innerHTML%20%3D%20filterHtml%3B%0Avar%20filterPanel%20%3D%20filterDiv.firstElementChild%20%7C%7C%20filterDiv.firstChild%3B%0Aif%20(progressEl%20%26%26%20progressEl.parentNode)%20%7B%0AprogressEl.parentNode.insertBefore(filterPanel%2C%20progressEl)%3B%0A%7D%20else%20%7B%0AbodyEl.appendChild(filterPanel)%3B%0A%7D%0A%2F%2F%20Hide%20the%20main%20buttons%20%E2%80%94%20with%20null%20guards%0Avar%20hideIds%20%3D%20%5B%22g2c-btn-memory%22%2C%20%22g2c-btn-convos%22%2C%20%22g2c-btn-instructions%22%2C%20%22g2c-btn-all%22%2C%20%22g2c-camera-divider%22%2C%20%22g2c-camera-row%22%2C%20%22g2c-camera-note%22%5D%3B%0Afor%20(var%20hi%20%3D%200%3B%20hi%20%3C%20hideIds.length%3B%20hi%2B%2B)%20%7B%0Avar%20hideEl%20%3D%20document.getElementById(hideIds%5Bhi%5D)%3B%0Aif%20(hideEl)%20hideEl.style.display%20%3D%20%22none%22%3B%0A%7D%0A%2F%2F%20Wire%20up%20events%20using%20safeAddEvent%20(BUG%20FIX)%0Aif%20(hasRealModels)%20%7B%0AsafeAddEvent(%22g2c-sel-all%22%2C%20%22click%22%2C%20function()%20%7B%0Avar%20boxes%20%3D%20document.querySelectorAll(%22%23g2c-filter-models%20input%22)%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20boxes.length%3B%20i%2B%2B)%20boxes%5Bi%5D.checked%20%3D%20true%3B%0AupdateFilterSummary()%3B%0A%7D)%3B%0AsafeAddEvent(%22g2c-sel-none%22%2C%20%22click%22%2C%20function()%20%7B%0Avar%20boxes%20%3D%20document.querySelectorAll(%22%23g2c-filter-models%20input%22)%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20boxes.length%3B%20i%2B%2B)%20boxes%5Bi%5D.checked%20%3D%20false%3B%0AupdateFilterSummary()%3B%0A%7D)%3B%0A%7D%0AsafeAddEvent(%22g2c-prev-drop%22%2C%20%22click%22%2C%20function()%20%7B%0Avar%20fileInput%20%3D%20document.getElementById(%22g2c-prev-file%22)%3B%0Aif%20(fileInput)%20fileInput.click()%3B%0A%7D)%3B%0Avar%20filterInputs%20%3D%20document.querySelectorAll(%22%23g2c-filter-models%20input%2C%20%23g2c-filter-sources%20input%2C%20%23g2c-date-from%2C%20%23g2c-date-to%2C%20%23g2c-limit%22)%3B%0Afor%20(var%20fi%20%3D%200%3B%20fi%20%3C%20filterInputs.length%3B%20fi%2B%2B)%20%7B%0AfilterInputs%5Bfi%5D.addEventListener(%22change%22%2C%20updateFilterSummary)%3B%0A%7D%0A%2F%2F%20Search%20box%20%E2%80%94%20live%20filtering%20as%20you%20type%0Avar%20searchInput%20%3D%20document.getElementById(%22g2c-search%22)%3B%0Aif%20(searchInput)%20searchInput.addEventListener(%22input%22%2C%20updateFilterSummary)%3B%0A%2F%2F%20Era%20preset%20buttons%0Avar%20eraRanges%20%3D%20%7B%0A%22all%22%3A%20%5BtsToDate(oldest)%2C%20tsToDate(newest)%5D%2C%0A%22gpt35%22%3A%20%5B%222022-11-30%22%2C%20%222023-03-13%22%5D%2C%0A%22gpt4%22%3A%20%5B%222023-03-14%22%2C%20%222024-05-12%22%5D%2C%0A%22gpt4o%22%3A%20%5B%222024-05-13%22%2C%20%222025-08-06%22%5D%2C%0A%22gpt5%22%3A%20%5B%222025-08-07%22%2C%20tsToDate(newest)%5D%0A%7D%3B%0Avar%20eraBtns%20%3D%20document.querySelectorAll(%22%23g2c-era-btns%20button%22)%3B%0Afor%20(var%20ei%20%3D%200%3B%20ei%20%3C%20eraBtns.length%3B%20ei%2B%2B)%20%7B%0AeraBtns%5Bei%5D.addEventListener(%22click%22%2C%20function()%20%7B%0Avar%20era%20%3D%20this.getAttribute(%22data-era%22)%3B%0Avar%20range%20%3D%20eraRanges%5Bera%5D%3B%0Aif%20(range)%20%7B%0Avar%20fromEl%20%3D%20document.getElementById(%22g2c-date-from%22)%3B%0Avar%20toEl%20%3D%20document.getElementById(%22g2c-date-to%22)%3B%0Aif%20(fromEl)%20fromEl.value%20%3D%20range%5B0%5D%3B%0Aif%20(toEl)%20toEl.value%20%3D%20range%5B1%5D%3B%0A%2F%2F%20Highlight%20active%20era%20button%0Avar%20siblings%20%3D%20document.querySelectorAll(%22%23g2c-era-btns%20button%22)%3B%0Afor%20(var%20si%20%3D%200%3B%20si%20%3C%20siblings.length%3B%20si%2B%2B)%20siblings%5Bsi%5D.style.color%20%3D%20%22%22%3B%0Athis.style.color%20%3D%20%22%23d4a574%22%3B%0AupdateFilterSummary()%3B%0A%7D%0A%7D)%3B%0A%7D%0AsafeAddEvent(%22g2c-prev-file%22%2C%20%22change%22%2C%20function()%20%7B%0Aif%20(this.files.length)%20loadPreviousExport(this.files%5B0%5D)%3B%0A%7D)%3B%0Avar%20dropEl%20%3D%20document.getElementById(%22g2c-prev-drop%22)%3B%0Aif%20(dropEl)%20%7B%0AdropEl.addEventListener(%22dragover%22%2C%20function(e)%20%7B%20e.preventDefault()%3B%20this.style.borderColor%20%3D%20%22%23d4a574%22%3B%20%7D)%3B%0AdropEl.addEventListener(%22dragleave%22%2C%20function()%20%7B%20this.style.borderColor%20%3D%20%22%22%3B%20%7D)%3B%0AdropEl.addEventListener(%22drop%22%2C%20function(e)%20%7B%0Ae.preventDefault()%3B%0Athis.style.borderColor%20%3D%20%22%22%3B%0Aif%20(e.dataTransfer.files.length)%20loadPreviousExport(e.dataTransfer.files%5B0%5D)%3B%0A%7D)%3B%0A%7D%0AsafeAddEvent(%22g2c-btn-download%22%2C%20%22click%22%2C%20startFilteredDownload)%3B%0A%2F%2F%20Ensure%20all%20model%20and%20source%20checkboxes%20are%20programmatically%20checked%20(defensive)%0Avar%20allBoxes%20%3D%20document.querySelectorAll(%22%23g2c-filter-models%20input%2C%20%23g2c-filter-sources%20input%22)%3B%0Afor%20(var%20bi%20%3D%200%3B%20bi%20%3C%20allBoxes.length%3B%20bi%2B%2B)%20allBoxes%5Bbi%5D.checked%20%3D%20true%3B%0A%2F%2F%20Force-recalculate%20summary%20after%20DOM%20is%20fully%20wired%0AupdateFilterSummary()%3B%0A%7D%0Afunction%20estimateTime(count)%20%7B%0A%2F%2F%20Real-world%20calibration%3A%203361%20convos%20%3D%2029m34s%20%3D%20~5.3s%20per%20batch%20of%2010%0A%2F%2F%20Using%205s%20per%20batch%20as%20conservative%20estimate%0Avar%20secs%20%3D%20Math.ceil(count%20%2F%20BATCH_SIZE)%20*%205%3B%0Aif%20(secs%20%3C%2060)%20return%20%22~%22%20%2B%20Math.max(Math.round(secs)%2C%201)%20%2B%20%22%20seconds%22%3B%0Avar%20mins%20%3D%20Math.round(secs%20%2F%2060)%3B%0Aif%20(mins%20%3C%2060)%20return%20%22~%22%20%2B%20mins%20%2B%20%22%20minutes%22%3B%0Avar%20hrs%20%3D%20(secs%20%2F%203600).toFixed(1)%3B%0Areturn%20%22~%22%20%2B%20hrs%20%2B%20%22%20hours%22%3B%0A%7D%0Afunction%20getFilteredConvos()%20%7B%0Atry%20%7B%0Avar%20selectedModels%20%3D%20%7B%7D%3B%0Avar%20boxes%20%3D%20document.querySelectorAll(%22%23g2c-filter-models%20input%22)%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20boxes.length%3B%20i%2B%2B)%20%7B%0Aif%20(boxes%5Bi%5D.checked)%20selectedModels%5Bboxes%5Bi%5D.getAttribute(%22data-model%22)%5D%20%3D%20true%3B%0A%7D%0A%2F%2F%20Source%2Fproject%20filter%0Avar%20selectedSources%20%3D%20%7B%7D%3B%0Avar%20sourceBoxes%20%3D%20document.querySelectorAll(%22%23g2c-filter-sources%20input%22)%3B%0Afor%20(var%20si%20%3D%200%3B%20si%20%3C%20sourceBoxes.length%3B%20si%2B%2B)%20%7B%0Aif%20(sourceBoxes%5Bsi%5D.checked)%20selectedSources%5BsourceBoxes%5Bsi%5D.getAttribute(%22data-source%22)%5D%20%3D%20true%3B%0A%7D%0Avar%20hasSourceFilter%20%3D%20sourceBoxes.length%20%3E%200%20%26%26%20Object.keys(selectedSources).length%20%3E%200%3B%0A%2F%2F%20If%20no%20models%20selected%2C%20return%20all%20(fail-open)%0Avar%20hasModelFilter%20%3D%20Object.keys(selectedModels).length%20%3E%200%3B%0Avar%20fromEl%20%3D%20document.getElementById(%22g2c-date-from%22)%3B%0Avar%20toEl%20%3D%20document.getElementById(%22g2c-date-to%22)%3B%0Avar%20limitEl%20%3D%20document.getElementById(%22g2c-limit%22)%3B%0Avar%20fromStr%20%3D%20fromEl%20%3F%20fromEl.value%20%3A%20%22%22%3B%0Avar%20toStr%20%3D%20toEl%20%3F%20toEl.value%20%3A%20%22%22%3B%0Avar%20fromTs%20%3D%20fromStr%20%3F%20new%20Date(fromStr%20%2B%20%22T00%3A00%3A00%22).getTime()%20%2F%201000%20%3A%200%3B%0Avar%20toTs%20%3D%20toStr%20%3F%20new%20Date(toStr%20%2B%20%22T23%3A59%3A59%22).getTime()%20%2F%201000%20%3A%20Infinity%3B%0Avar%20limit%20%3D%20limitEl%20%3F%20(parseInt(limitEl.value)%20%7C%7C%200)%20%3A%200%3B%0A%2F%2F%20Search%20filter%20%E2%80%94%20client-side%20title%20matching%0Avar%20searchEl%20%3D%20document.getElementById(%22g2c-search%22)%3B%0Avar%20searchText%20%3D%20searchEl%20%3F%20searchEl.value.trim().toLowerCase()%20%3A%20%22%22%3B%0Avar%20filtered%20%3D%20%5B%5D%3B%0Avar%20mainCount%20%3D%200%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20scannedConvos.length%3B%20i%2B%2B)%20%7B%0Avar%20c%20%3D%20scannedConvos%5Bi%5D%3B%0A%2F%2F%20Search%20filter%20%E2%80%94%20match%20against%20title%0Aif%20(searchText)%20%7B%0Avar%20title%20%3D%20(c.title%20%7C%7C%20%22%22).toLowerCase()%3B%0Aif%20(title.indexOf(searchText)%20%3D%3D%3D%20-1)%20continue%3B%0A%7D%0A%2F%2F%20Source%20filter%0Aif%20(hasSourceFilter)%20%7B%0Avar%20src%20%3D%20c._shared%20%3F%20%22Shared%20conversations%22%20%3A%20(c._project%20%7C%7C%20%22Main%20conversations%22)%3B%0Aif%20(!selectedSources%5Bsrc%5D)%20continue%3B%0A%7D%0Avar%20model%20%3D%20getConvoModel(c)%3B%0Aif%20(hasModelFilter%20%26%26%20!selectedModels%5Bmodel%5D)%20continue%3B%0Avar%20ts%20%3D%20getConvoTime(c)%3B%0Aif%20(ts%20%3E%200%20%26%26%20(ts%20%3C%20fromTs%20%7C%7C%20ts%20%3E%20toTs))%20continue%3B%0Aif%20(previousExportIds%5Bc.id%5D)%20continue%3B%0A%2F%2F%20Limit%20only%20applies%20to%20main%20conversations%20%E2%80%94%20project%20convos%20always%20included%0Aif%20(!c._project)%20%7B%0Aif%20(limit%20%3E%200%20%26%26%20mainCount%20%3E%3D%20limit)%20continue%3B%0AmainCount%2B%2B%3B%0A%7D%0Afiltered.push(c)%3B%0A%7D%0Areturn%20filtered%3B%0A%7D%20catch%20(err)%20%7B%0Alog(%22Filter%20error%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0Areturn%20scannedConvos%3B%20%2F%2F%20fail-open%3A%20return%20all%0A%7D%0A%7D%0Afunction%20updateFilterSummary()%20%7B%0Avar%20filtered%20%3D%20getFilteredConvos()%3B%0Avar%20summary%20%3D%20document.getElementById(%22g2c-filter-summary%22)%3B%0Avar%20dlBtn%20%3D%20document.getElementById(%22g2c-btn-download%22)%3B%0Avar%20skipped%20%3D%20Object.keys(previousExportIds).length%3B%0Avar%20text%20%3D%20filtered.length%20%2B%20%22%20conversations%20selected%22%3B%0Aif%20(skipped%20%3E%200)%20text%20%2B%3D%20%22%20(%22%20%2B%20skipped%20%2B%20%22%20skipped%20from%20previous%20export)%22%3B%0Aif%20(summary)%20summary.textContent%20%3D%20text%3B%0Aif%20(dlBtn)%20%7B%0Avar%20spanEl%20%3D%20dlBtn.querySelector(%22.g2c-btn-text%20span%22)%3B%0Aif%20(spanEl)%20spanEl.textContent%20%3D%20%22Download%20%22%20%2B%20filtered.length%20%2B%20%22%20conversations%22%3B%0Avar%20subEl%20%3D%20dlBtn.querySelector(%22.g2c-btn-sub%22)%3B%0Aif%20(subEl)%20subEl.textContent%20%3D%20estimateTime(filtered.length)%3B%0A%7D%0A%7D%0Afunction%20loadPreviousExport(file)%20%7B%0Avar%20dropEl%20%3D%20document.getElementById(%22g2c-prev-drop%22)%3B%0Aif%20(dropEl)%20dropEl.textContent%20%3D%20%22Loading%20%22%20%2B%20file.name%20%2B%20%22...%22%3B%0Avar%20reader%20%3D%20new%20FileReader()%3B%0Areader.onload%20%3D%20function(e)%20%7B%0Atry%20%7B%0Avar%20data%20%3D%20JSON.parse(e.target.result)%3B%0Avar%20convos%20%3D%20data.conversations%20%7C%7C%20data%20%7C%7C%20%5B%5D%3B%0Aif%20(Array.isArray(convos))%20%7B%0ApreviousExportIds%20%3D%20%7B%7D%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20convos.length%3B%20i%2B%2B)%20%7B%0Aif%20(convos%5Bi%5D.id)%20previousExportIds%5Bconvos%5Bi%5D.id%5D%20%3D%20true%3B%0A%7D%0Aif%20(dropEl)%20%7B%0AdropEl.textContent%20%3D%20%22%5Cu2705%20%22%20%2B%20Object.keys(previousExportIds).length%20%2B%20%22%20conversations%20from%20previous%20export%22%3B%0AdropEl.className%20%3D%20%22g2c-filter-drop%20active%22%3B%0A%7D%0Alog(%22Loaded%20previous%20export%3A%20%22%20%2B%20Object.keys(previousExportIds).length%20%2B%20%22%20conversation%20IDs%22)%3B%0AupdateFilterSummary()%3B%0A%7D%0A%7D%20catch%20(err)%20%7B%0Aif%20(dropEl)%20dropEl.textContent%20%3D%20%22%5Cu274C%20Could%20not%20parse%20file%22%3B%0Alog(%22Previous%20export%20error%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0A%7D%0A%7D%3B%0Areader.readAsText(file)%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20CONVERSATION%20PROCESSING%20HELPERS%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Afunction%20extractNodeText(node)%20%7B%0Aif%20(!node%20%7C%7C%20!node.message%20%7C%7C%20!node.message.content)%20return%20%22%22%3B%0Avar%20content%20%3D%20node.message.content%3B%0A%2F%2F%20Handle%20special%20content%20types%20at%20the%20top%20level%0Avar%20ct%20%3D%20content.content_type%3B%0Aif%20(ct%20%3D%3D%3D%20%22model_editable_context%22)%20return%20%22%22%3B%20%2F%2F%20system%20memory%2C%20skip%0Aif%20(ct%20%3D%3D%3D%20%22thoughts%22)%20%7B%0A%2F%2F%20Reasoning%20model%20thinking%20block%20%E2%80%94%20OpenAI%20hides%20actual%20CoT%0Areturn%20%22%5Bthinking%5D%22%3B%0A%7D%0Aif%20(ct%20%3D%3D%3D%20%22reasoning_recap%22)%20%7B%0A%2F%2F%20%22Thought%20for%20a%20few%20seconds%22%20etc%0Areturn%20%22%5B%22%20%2B%20(content.content%20%7C%7C%20%22Thinking...%22)%20%2B%20%22%5D%22%3B%0A%7D%0Aif%20(ct%20%3D%3D%3D%20%22code%22%20%7C%7C%20ct%20%3D%3D%3D%20%22execution_output%22)%20%7B%0Avar%20lang%20%3D%20content.language%20%7C%7C%20%22%22%3B%0Avar%20codeText%20%3D%20content.text%20%7C%7C%20%22%22%3B%0Aif%20(lang%20%3D%3D%3D%20%22unknown%22%20%26%26%20codeText.indexOf(%22search(%22)%20%3D%3D%3D%200)%20%7B%0Areturn%20%22%5B%5CuD83D%5CuDD0D%20%22%20%2B%20codeText%20%2B%20%22%5D%22%3B%0A%7D%0Areturn%20%22%60%60%60%22%20%2B%20lang%20%2B%20%22%5Cn%22%20%2B%20codeText%20%2B%20%22%5Cn%60%60%60%22%3B%0A%7D%0Avar%20parts%20%3D%20content.parts%3B%0Aif%20(!Array.isArray(parts))%20return%20JSON.stringify(content)%3B%0Avar%20textParts%20%3D%20%5B%5D%3B%0Afor%20(var%20p%20%3D%200%3B%20p%20%3C%20parts.length%3B%20p%2B%2B)%20%7B%0Aif%20(typeof%20parts%5Bp%5D%20%3D%3D%3D%20%22string%22)%20%7B%0AtextParts.push(parts%5Bp%5D)%3B%0A%7D%20else%20if%20(parts%5Bp%5D%20%26%26%20typeof%20parts%5Bp%5D%20%3D%3D%3D%20%22object%22)%20%7B%0Aif%20(parts%5Bp%5D.content_type%20%3D%3D%3D%20%22image_asset_pointer%22%20%7C%7C%20parts%5Bp%5D.asset_pointer)%20%7B%0Avar%20imgName%20%3D%20(parts%5Bp%5D.metadata%20%26%26%20parts%5Bp%5D.metadata.dalle%20%26%26%20parts%5Bp%5D.metadata.dalle.prompt)%0A%3F%20%22DALL-E%3A%20%22%20%2B%20parts%5Bp%5D.metadata.dalle.prompt%20%3A%20%22image%22%3B%0AtextParts.push(%22%5B%5CuD83D%5CuDDBC%20%22%20%2B%20imgName%20%2B%20%22%5D%22)%3B%0A%7D%0A%7D%0A%7D%0Areturn%20textParts.join(%22%5Cn%22)%0A.replace(%2F%5CuE200cite(%5CuE202turn%5Cdsearch%5Cd%2B)%2B%5CuE201%2Fg%2C%20%22%22)%0A.replace(%2F%5CuE200image_group%5CuE202%5C%7B%5B%5E%7D%5D*%5C%7D%5CuE201%2Fg%2C%20%22%5B%F0%9F%96%BC%20images%5D%22)%0A.replace(%2F%5CuE200%5B%5Cs%5CS%5D*%3F%5CuE201%2Fg%2C%20%22%22)%3B%0A%7D%0Afunction%20extractNodeRole(node)%20%7B%0Areturn%20(node.message%20%26%26%20node.message.author%20%26%26%20node.message.author.role)%20%7C%7C%20%22unknown%22%3B%0A%7D%0Afunction%20extractNodeModel(node)%20%7B%0Areturn%20(node.message%20%26%26%20node.message.metadata%20%26%26%20node.message.metadata.model_slug)%20%7C%7C%20null%3B%0A%7D%0Afunction%20extractNodeTime(node)%20%7B%0Areturn%20(node.message%20%26%26%20node.message.create_time)%20%7C%7C%20null%3B%0A%7D%0Afunction%20processConversationDetail(detail%2C%20listItem)%20%7B%0Avar%20messages%20%3D%20%5B%5D%3B%0Avar%20hasBranches%20%3D%20false%3B%0Aif%20(detail.mapping)%20%7B%0Avar%20mapKeys%20%3D%20Object.keys(detail.mapping)%3B%0Avar%20rootId%20%3D%20null%3B%0Afor%20(var%20mk%20%3D%200%3B%20mk%20%3C%20mapKeys.length%3B%20mk%2B%2B)%20%7B%0Aif%20(!detail.mapping%5BmapKeys%5Bmk%5D%5D.parent)%20%7B%0ArootId%20%3D%20mapKeys%5Bmk%5D%3B%0Abreak%3B%0A%7D%0A%7D%0Aif%20(!rootId)%20rootId%20%3D%20mapKeys%5B0%5D%3B%0Avar%20current%20%3D%20rootId%3B%0Avar%20visited%20%3D%20%7B%7D%3B%0Avar%20safety%20%3D%200%3B%0Awhile%20(current%20%26%26%20safety%20%3C%2050000)%20%7B%0Asafety%2B%2B%3B%0Aif%20(visited%5Bcurrent%5D)%20break%3B%0Avisited%5Bcurrent%5D%20%3D%20true%3B%0Avar%20node%20%3D%20detail.mapping%5Bcurrent%5D%3B%0Aif%20(!node)%20break%3B%0Aif%20(node.message%20%26%26%20node.message.content)%20%7B%0Avar%20text%20%3D%20extractNodeText(node)%3B%0Aif%20(text.trim()%20!%3D%3D%20%22%22)%20%7B%0Avar%20msgObj%20%3D%20%7B%0Arole%3A%20extractNodeRole(node)%2C%0Acontent%3A%20text%2C%0Atimestamp%3A%20extractNodeTime(node)%2C%0Amodel%3A%20extractNodeModel(node)%0A%7D%3B%0Aif%20(node.parent%20%26%26%20detail.mapping%5Bnode.parent%5D)%20%7B%0Avar%20parentNode%20%3D%20detail.mapping%5Bnode.parent%5D%3B%0Aif%20(parentNode.children%20%26%26%20parentNode.children.length%20%3E%201)%20%7B%0Avar%20alts%20%3D%20%5B%5D%3B%0Afor%20(var%20ci%20%3D%200%3B%20ci%20%3C%20parentNode.children.length%3B%20ci%2B%2B)%20%7B%0Avar%20sibId%20%3D%20parentNode.children%5Bci%5D%3B%0Aif%20(sibId%20%3D%3D%3D%20current)%20continue%3B%0Avar%20sib%20%3D%20detail.mapping%5BsibId%5D%3B%0Aif%20(sib%20%26%26%20sib.message%20%26%26%20sib.message.content)%20%7B%0Avar%20sibText%20%3D%20extractNodeText(sib)%3B%0Aif%20(sibText.trim())%20%7B%0Aalts.push(%7B%0Acontent%3A%20sibText%2C%0Arole%3A%20extractNodeRole(sib)%2C%0Atimestamp%3A%20extractNodeTime(sib)%2C%0Amodel%3A%20extractNodeModel(sib)%0A%7D)%3B%0A%7D%0A%7D%0A%7D%0Aif%20(alts.length%20%3E%200)%20%7B%0AmsgObj.alternatives%20%3D%20alts%3B%0AhasBranches%20%3D%20true%3B%0A%7D%0A%7D%0A%7D%0Amessages.push(msgObj)%3B%0A%7D%0A%7D%0Aif%20(node.children%20%26%26%20node.children.length%20%3E%200)%20%7B%0Acurrent%20%3D%20node.children%5Bnode.children.length%20-%201%5D%3B%0A%7D%20else%20%7B%0Abreak%3B%0A%7D%0A%7D%0A%7D%0A%2F%2F%20Extract%20model%20from%20mapping%20metadata%20(since%20list%20API%20no%20longer%20provides%20it)%0Avar%20model%20%3D%20detail.default_model_slug%20%7C%7C%20null%3B%0Aif%20(!model%20%26%26%20detail.mapping)%20%7B%0Avar%20mKeys%20%3D%20Object.keys(detail.mapping)%3B%0Afor%20(var%20mi%20%3D%200%3B%20mi%20%3C%20mKeys.length%3B%20mi%2B%2B)%20%7B%0Avar%20mNode%20%3D%20detail.mapping%5BmKeys%5Bmi%5D%5D%3B%0Aif%20(mNode%20%26%26%20mNode.message%20%26%26%20mNode.message.metadata%20%26%26%20mNode.message.metadata.model_slug)%20%7B%0Amodel%20%3D%20mNode.message.metadata.model_slug%3B%0Abreak%3B%0A%7D%0A%7D%0A%7D%0Areturn%20%7B%0Aid%3A%20detail.conversation_id%20%7C%7C%20(listItem%20%26%26%20listItem.id)%20%7C%7C%20detail.id%2C%0Atitle%3A%20detail.title%20%7C%7C%20(listItem%20%26%26%20listItem.title)%20%7C%7C%20%22Untitled%22%2C%0Acreate_time%3A%20detail.create_time%20%7C%7C%20(listItem%20%26%26%20listItem.create_time)%20%7C%7C%20null%2C%0Aupdate_time%3A%20detail.update_time%20%7C%7C%20(listItem%20%26%26%20listItem.update_time)%20%7C%7C%20null%2C%0Amodel%3A%20model%2C%0Aproject%3A%20(listItem%20%26%26%20listItem._project)%20%7C%7C%20null%2C%0Aproject_id%3A%20(listItem%20%26%26%20listItem._project_id)%20%7C%7C%20null%2C%0Amemory_scope%3A%20(listItem%20%26%26%20listItem.memory_scope)%20%7C%7C%20null%2C%0Ais_do_not_remember%3A%20(listItem%20%26%26%20listItem.is_do_not_remember)%20%7C%7C%20false%2C%0Ahas_branches%3A%20hasBranches%2C%0Amessage_count%3A%20messages.length%2C%0Amessages%3A%20messages%0A%7D%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20FILTERED%20DOWNLOAD%20(States%204%20%26%205)%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Afunction%20updateDlUI(completed%2C%20total%2C%20title%2C%20startTime)%20%7B%0Avar%20pct%20%3D%20Math.round((completed%20%2F%20total)%20*%20100)%3B%0Avar%20remaining%20%3D%20total%20-%20completed%3B%0Avar%20dlCount%20%3D%20document.getElementById(%22g2c-dl-count%22)%3B%0Avar%20dlTitle%20%3D%20document.getElementById(%22g2c-dl-title%22)%3B%0Avar%20dlFill%20%3D%20document.getElementById(%22g2c-dl-fill%22)%3B%0Avar%20dlPct%20%3D%20document.getElementById(%22g2c-dl-pct%22)%3B%0Avar%20dlRemaining%20%3D%20document.getElementById(%22g2c-dl-remaining%22)%3B%0Avar%20dlMode%20%3D%20document.getElementById(%22g2c-dl-mode%22)%3B%0Aif%20(dlCount)%20dlCount.textContent%20%3D%20completed%3B%0Aif%20(dlTitle)%20dlTitle.textContent%20%3D%20title%3B%0Aif%20(dlFill)%20dlFill.style.width%20%3D%20pct%20%2B%20%22%25%22%3B%0Aif%20(dlPct)%20dlPct.textContent%20%3D%20pct%20%2B%20%22%25%22%3B%0Aif%20(dlRemaining%20%26%26%20completed%20%3E%200)%20%7B%0Avar%20elapsed%20%3D%20(Date.now()%20-%20startTime)%20%2F%201000%3B%0Avar%20perItem%20%3D%20elapsed%20%2F%20completed%3B%0Avar%20secsLeft%20%3D%20Math.round(perItem%20*%20remaining)%3B%0Aif%20(secsLeft%20%3C%2060)%20%7B%0AdlRemaining.textContent%20%3D%20%22~%22%20%2B%20secsLeft%20%2B%20%22%20seconds%20remaining%22%3B%0A%7D%20else%20%7B%0AdlRemaining.textContent%20%3D%20%22~%22%20%2B%20Math.round(secsLeft%20%2F%2060)%20%2B%20%22%20minutes%20remaining%22%3B%0A%7D%0A%7D%0A%7D%0Aasync%20function%20downloadBatch(ids%2C%20token)%20%7B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fconversations%2Fbatch%22%2C%20%7B%0Amethod%3A%20%22POST%22%2C%0Acredentials%3A%20%22include%22%2C%0Aheaders%3A%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%2C%20%22Content-Type%22%3A%20%22application%2Fjson%22%7D%2C%0Abody%3A%20JSON.stringify(%7Bconversation_ids%3A%20ids%7D)%0A%7D)%3B%0Areturn%20resp%3B%0A%7D%0Aasync%20function%20downloadSingle(id%2C%20token)%20%7B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fconversation%2F%22%20%2B%20id%2C%20%7B%0Acredentials%3A%20%22include%22%2C%0Aheaders%3A%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%0A%7D)%3B%0Areturn%20resp%3B%0A%7D%0Aasync%20function%20downloadShared(shareId%2C%20token)%20%7B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fshare%2F%22%20%2B%20shareId%2C%20%7B%0Acredentials%3A%20%22include%22%2C%0Aheaders%3A%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%0A%7D)%3B%0Areturn%20resp%3B%0A%7D%0Aasync%20function%20startFilteredDownload()%20%7B%0Avar%20filtered%20%3D%20getFilteredConvos()%3B%0Aif%20(filtered.length%20%3D%3D%3D%200)%20%7B%0Aalert(%22No%20conversations%20selected.%20Adjust%20your%20filters.%22)%3B%0Areturn%3B%0A%7D%0A%2F%2F%20Separate%20shared%20conversations%20(can't%20use%20batch%20endpoint)%0Avar%20regularConvos%20%3D%20%5B%5D%3B%0Avar%20sharedConvos%20%3D%20%5B%5D%3B%0Afor%20(var%20fi%20%3D%200%3B%20fi%20%3C%20filtered.length%3B%20fi%2B%2B)%20%7B%0Aif%20(filtered%5Bfi%5D._shared)%20%7B%0AsharedConvos.push(filtered%5Bfi%5D)%3B%0A%7D%20else%20%7B%0AregularConvos.push(filtered%5Bfi%5D)%3B%0A%7D%0A%7D%0A%2F%2F%20Replace%20filter%20panel%20with%20download%20hero%20UI%20(State%204)%0Avar%20filterPanel%20%3D%20document.getElementById(%22g2c-filter-panel%22)%3B%0Aif%20(filterPanel)%20%7B%0AfilterPanel.innerHTML%20%3D%20'%5C%0A%3Cdiv%20class%3D%22g2c-dl-hero%22%20id%3D%22g2c-dl-hero%22%3E%5C%0A%3Cspan%20class%3D%22g2c-dl-count%22%20id%3D%22g2c-dl-count%22%3E0%3C%2Fspan%3E%5C%0A%3Cspan%20class%3D%22g2c-dl-of%22%20id%3D%22g2c-dl-of%22%3E%20%2F%20'%20%2B%20filtered.length%20%2B%20'%3C%2Fspan%3E%5C%0A%3Cdiv%20class%3D%22g2c-dl-title%22%20id%3D%22g2c-dl-title%22%3EStarting%20download%5Cu2026%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20style%3D%22margin%3A10px%200%3B%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-progress-bar%22%3E%3Cdiv%20class%3D%22g2c-progress-fill%22%20id%3D%22g2c-dl-fill%22%20style%3D%22width%3A0%25%3B%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-dl-pct%22%20id%3D%22g2c-dl-pct%22%3E0%25%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-dl-remaining%22%20id%3D%22g2c-dl-remaining%22%3E%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-dl-mode%22%20id%3D%22g2c-dl-mode%22%20style%3D%22text-align%3Acenter%3Bfont-size%3A10px%3Bcolor%3A%23666%3Bmargin-top%3A4px%3B%22%3E%3C%2Fdiv%3E'%3B%0A%7D%0Avar%20startTime%20%3D%20Date.now()%3B%0Atry%20%7B%0Avar%20token%20%3D%20await%20getToken()%3B%0Avar%20fullExport%20%3D%20%7B%0Aexport_date%3A%20new%20Date().toISOString()%2C%0Atool%3A%20%22GPT2Claude%20Migration%20Kit%20v2.4%22%2C%0Aformat_version%3A%204%2C%0Aaccount%3A%20cachedAccountInfo%20%7C%7C%20null%2C%0Atotal_conversations%3A%20filtered.length%2C%0Aconversations%3A%20%5B%5D%0A%7D%3B%0Avar%20successCount%20%3D%200%3B%0Avar%20errorCount%20%3D%200%3B%0Avar%20useBatch%20%3D%20true%3B%0A%2F%2F%20Build%20ID-to-listItem%20lookup%0Avar%20listLookup%20%3D%20%7B%7D%3B%0Afor%20(var%20li%20%3D%200%3B%20li%20%3C%20filtered.length%3B%20li%2B%2B)%20%7B%0AlistLookup%5Bfiltered%5Bli%5D.id%5D%20%3D%20filtered%5Bli%5D%3B%0A%7D%0A%2F%2F%20----%20TRY%20BATCH%20MODE%20FIRST%20(regular%20conversations%20only)%20----%0Aif%20(regularConvos.length%20%3E%200)%20%7B%0Alog(%22Using%20batch%20download%20(10%20at%20a%20time)%5Cu2026%22)%3B%0Avar%20dlMode%20%3D%20document.getElementById(%22g2c-dl-mode%22)%3B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5Cu26A1%20Batch%20mode%20%5Cu2014%2010x%20faster%22%3B%0Avar%20batchIndex%20%3D%200%3B%0Avar%20consecutiveGroupFails%20%3D%200%3B%0Avar%20MAX_CONSECUTIVE_FAILS%20%3D%203%3B%0A%2F%2F%20Helper%3A%20download%20a%20list%20of%20IDs%20individually%2C%20return%20results%0Aasync%20function%20downloadIndividually(items%2C%20tkn)%20%7B%0Avar%20results%20%3D%20%5B%5D%3B%0Afor%20(var%20ii%20%3D%200%3B%20ii%20%3C%20items.length%3B%20ii%2B%2B)%20%7B%0Atry%20%7B%0Avar%20resp%20%3D%20await%20downloadSingle(items%5Bii%5D.id%2C%20tkn)%3B%0Aif%20(resp.status%20%3D%3D%3D%20429)%20%7B%0Alog(%22Rate%20limited%2C%20waiting%2030s%5Cu2026%22%2C%20%22error%22)%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%2030000)%3B%20%7D)%3B%0Aii--%3B%20continue%3B%0A%7D%0Aif%20(resp.status%20!%3D%3D%20200)%20%7B%0Aresults.push(%7Berror%3A%20%22HTTP%20%22%20%2B%20resp.status%2C%20item%3A%20items%5Bii%5D%7D)%3B%0Acontinue%3B%0A%7D%0Avar%20det%20%3D%20await%20resp.json()%3B%0Aresults.push(%7Bdetail%3A%20det%2C%20item%3A%20items%5Bii%5D%7D)%3B%0A%7D%20catch%20(e)%20%7B%0Aresults.push(%7Berror%3A%20e.message%2C%20item%3A%20items%5Bii%5D%7D)%3B%0A%7D%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%0Areturn%20results%3B%0A%7D%0A%2F%2F%20Helper%3A%20try%20a%20batch%2C%20return%20%7Bok%2C%20data%2C%20status%7D%0Aasync%20function%20tryBatch(ids%2C%20tkn)%20%7B%0Atry%20%7B%0Avar%20resp%20%3D%20await%20downloadBatch(ids%2C%20tkn)%3B%0Aif%20(resp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20d%20%3D%20await%20resp.json()%3B%0Areturn%20%7Bok%3A%20true%2C%20data%3A%20d%2C%20status%3A%20200%7D%3B%0A%7D%0Areturn%20%7Bok%3A%20false%2C%20data%3A%20null%2C%20status%3A%20resp.status%7D%3B%0A%7D%20catch%20(e)%20%7B%0Areturn%20%7Bok%3A%20false%2C%20data%3A%20null%2C%20status%3A%200%2C%20error%3A%20e.message%7D%3B%0A%7D%0A%7D%0Awhile%20(batchIndex%20%3C%20regularConvos.length%20%26%26%20useBatch)%20%7B%0Avar%20batchItems%20%3D%20regularConvos.slice(batchIndex%2C%20batchIndex%20%2B%20BATCH_SIZE)%3B%0Avar%20batchIds%20%3D%20%5B%5D%3B%0Afor%20(var%20bi%20%3D%200%3B%20bi%20%3C%20batchItems.length%3B%20bi%2B%2B)%20batchIds.push(batchItems%5Bbi%5D.id)%3B%0A%2F%2F%20---%20Attempt%201%3A%20full%20batch%20---%0Avar%20result%20%3D%20await%20tryBatch(batchIds%2C%20token)%3B%0Aif%20(result.status%20%3D%3D%3D%20429)%20%7B%0Alog(%22Rate%20limited%2C%20waiting%2030s%5Cu2026%22%2C%20%22error%22)%3B%0Avar%20dlTitle%20%3D%20document.getElementById(%22g2c-dl-title%22)%3B%0Avar%20dlRemaining%20%3D%20document.getElementById(%22g2c-dl-remaining%22)%3B%0Aif%20(dlTitle)%20dlTitle.textContent%20%3D%20%22Rate%20limited%20%5Cu2014%20waiting%2030s%5Cu2026%22%3B%0Aif%20(dlRemaining)%20dlRemaining.textContent%20%3D%20%22Will%20resume%20automatically%22%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%2030000)%3B%20%7D)%3B%0Acontinue%3B%20%2F%2F%20retry%20same%20batch%0A%7D%0Aif%20(result.status%20%3D%3D%3D%20422%20%7C%7C%20result.status%20%3D%3D%3D%20405%20%7C%7C%20result.status%20%3D%3D%3D%20404)%20%7B%0Alog(%22Batch%20endpoint%20unavailable%20(HTTP%20%22%20%2B%20result.status%20%2B%20%22)%2C%20falling%20back%20to%20individual%20downloads%5Cu2026%22%2C%20%22error%22)%3B%0AuseBatch%20%3D%20false%3B%0Abreak%3B%0A%7D%0Aif%20(result.ok)%20%7B%0A%2F%2F%20Success%20%E2%80%94%20process%20batch%0AconsecutiveGroupFails%20%3D%200%3B%0Avar%20batchData%20%3D%20result.data%3B%0Avar%20batchArr%20%3D%20Array.isArray(batchData)%20%3F%20batchData%20%3A%20Object.values(batchData)%3B%0Afor%20(var%20bj%20%3D%200%3B%20bj%20%3C%20batchArr.length%3B%20bj%2B%2B)%20%7B%0Atry%20%7B%0Avar%20detail%20%3D%20batchArr%5Bbj%5D%3B%0Avar%20detailId%20%3D%20detail.conversation_id%20%7C%7C%20detail.id%3B%0Avar%20listItem%20%3D%20listLookup%5BdetailId%5D%20%7C%7C%20batchItems%5Bbj%5D%3B%0Avar%20processed%20%3D%20processConversationDetail(detail%2C%20listItem)%3B%0AfullExport.conversations.push(processed)%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(procErr)%20%7B%0Avar%20errTitle%20%3D%20(batchItems%5Bbj%5D%20%26%26%20batchItems%5Bbj%5D.title)%20%7C%7C%20%22Unknown%22%3B%0Alog(%22Error%20processing%3A%20%22%20%2B%20errTitle%20%2B%20%22%20%5Cu2014%20%22%20%2B%20procErr.message%2C%20%22error%22)%3B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7B%0Aid%3A%20batchIds%5Bbj%5D%2C%0Atitle%3A%20errTitle%2C%0Aerror%3A%20procErr.message%0A%7D)%3B%0A%7D%0A%7D%0AbatchIndex%20%2B%3D%20BATCH_SIZE%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%20else%20%7B%0A%2F%2F%20---%20Batch%20failed%20(likely%20500)%20%E2%80%94%20graduated%20retry%20---%0Alog(%22Batch%20error%20(HTTP%20%22%20%2B%20(result.status%20%7C%7C%20result.error)%20%2B%20%22)%2C%20retrying%20in%203s%5Cu2026%22%2C%20%22error%22)%3B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5Cu26A1%20Retrying%20batch%5Cu2026%22%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%203000)%3B%20%7D)%3B%0A%2F%2F%20---%20Attempt%202%3A%20retry%20same%20batch%20---%0Avar%20retry%20%3D%20await%20tryBatch(batchIds%2C%20token)%3B%0Aif%20(retry.ok)%20%7B%0AconsecutiveGroupFails%20%3D%200%3B%0Avar%20retryArr%20%3D%20Array.isArray(retry.data)%20%3F%20retry.data%20%3A%20Object.values(retry.data)%3B%0Afor%20(var%20rj%20%3D%200%3B%20rj%20%3C%20retryArr.length%3B%20rj%2B%2B)%20%7B%0Atry%20%7B%0Avar%20det%20%3D%20retryArr%5Brj%5D%3B%0Avar%20detId%20%3D%20det.conversation_id%20%7C%7C%20det.id%3B%0Avar%20li%20%3D%20listLookup%5BdetId%5D%20%7C%7C%20batchItems%5Brj%5D%3B%0AfullExport.conversations.push(processConversationDetail(det%2C%20li))%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(e)%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20batchIds%5Brj%5D%2C%20title%3A%20(batchItems%5Brj%5D%20%26%26%20batchItems%5Brj%5D.title)%20%7C%7C%20%22Unknown%22%2C%20error%3A%20e.message%7D)%3B%0A%7D%0A%7D%0AbatchIndex%20%2B%3D%20BATCH_SIZE%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%20else%20if%20(batchIds.length%20%3E%201)%20%7B%0A%2F%2F%20---%20Attempt%203%3A%20split%20batch%20in%20half%20---%0Alog(%22Retry%20failed%2C%20splitting%20batch%5Cu2026%22%2C%20%22error%22)%3B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5Cu26A1%20Splitting%20batch%5Cu2026%22%3B%0Avar%20mid%20%3D%20Math.ceil(batchIds.length%20%2F%202)%3B%0Avar%20halfA%20%3D%20batchIds.slice(0%2C%20mid)%3B%0Avar%20halfB%20%3D%20batchIds.slice(mid)%3B%0Avar%20itemsA%20%3D%20batchItems.slice(0%2C%20mid)%3B%0Avar%20itemsB%20%3D%20batchItems.slice(mid)%3B%0Avar%20anyHalfFailed%20%3D%20false%3B%0Avar%20halves%20%3D%20%5B%7Bids%3A%20halfA%2C%20items%3A%20itemsA%7D%2C%20%7Bids%3A%20halfB%2C%20items%3A%20itemsB%7D%5D%3B%0Afor%20(var%20hi%20%3D%200%3B%20hi%20%3C%20halves.length%3B%20hi%2B%2B)%20%7B%0Avar%20halfResult%20%3D%20await%20tryBatch(halves%5Bhi%5D.ids%2C%20token)%3B%0Aif%20(halfResult.ok)%20%7B%0Avar%20halfArr%20%3D%20Array.isArray(halfResult.data)%20%3F%20halfResult.data%20%3A%20Object.values(halfResult.data)%3B%0Afor%20(var%20hj%20%3D%200%3B%20hj%20%3C%20halfArr.length%3B%20hj%2B%2B)%20%7B%0Atry%20%7B%0Avar%20hDet%20%3D%20halfArr%5Bhj%5D%3B%0Avar%20hId%20%3D%20hDet.conversation_id%20%7C%7C%20hDet.id%3B%0Avar%20hLi%20%3D%20listLookup%5BhId%5D%20%7C%7C%20halves%5Bhi%5D.items%5Bhj%5D%3B%0AfullExport.conversations.push(processConversationDetail(hDet%2C%20hLi))%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(e)%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20halves%5Bhi%5D.ids%5Bhj%5D%2C%20title%3A%20(halves%5Bhi%5D.items%5Bhj%5D%20%26%26%20halves%5Bhi%5D.items%5Bhj%5D.title)%20%7C%7C%20%22Unknown%22%2C%20error%3A%20e.message%7D)%3B%0A%7D%0A%7D%0A%7D%20else%20%7B%0A%2F%2F%20Half%20batch%20also%20failed%20%E2%80%94%20download%20individually%0AanyHalfFailed%20%3D%20true%3B%0Alog(%22Half-batch%20failed%2C%20downloading%20%22%20%2B%20halves%5Bhi%5D.ids.length%20%2B%20%22%20individually%5Cu2026%22%2C%20%22error%22)%3B%0Avar%20indResults%20%3D%20await%20downloadIndividually(halves%5Bhi%5D.items%2C%20token)%3B%0Afor%20(var%20ir%20%3D%200%3B%20ir%20%3C%20indResults.length%3B%20ir%2B%2B)%20%7B%0Aif%20(indResults%5Bir%5D.detail)%20%7B%0Atry%20%7B%0AfullExport.conversations.push(processConversationDetail(indResults%5Bir%5D.detail%2C%20indResults%5Bir%5D.item))%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(e)%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20indResults%5Bir%5D.item.id%2C%20title%3A%20indResults%5Bir%5D.item.title%20%7C%7C%20%22Unknown%22%2C%20error%3A%20e.message%7D)%3B%0A%7D%0A%7D%20else%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20indResults%5Bir%5D.item.id%2C%20title%3A%20indResults%5Bir%5D.item.title%20%7C%7C%20%22Unknown%22%2C%20error%3A%20indResults%5Bir%5D.error%7D)%3B%0A%7D%0A%7D%0A%7D%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%20500)%3B%20%7D)%3B%0A%7D%0Aif%20(anyHalfFailed)%20%7B%0AconsecutiveGroupFails%2B%2B%3B%0Alog(%22Batch%20group%20recovered%20individually%2C%20resuming%20batch%20mode%20(%22%20%2B%20consecutiveGroupFails%20%2B%20%22%2F%22%20%2B%20MAX_CONSECUTIVE_FAILS%20%2B%20%22%20fails)%22%2C%20%22error%22)%3B%0A%7D%20else%20%7B%0AconsecutiveGroupFails%20%3D%200%3B%0A%7D%0AbatchIndex%20%2B%3D%20BATCH_SIZE%3B%0A%7D%20else%20%7B%0A%2F%2F%20Single%20item%20batch%20failed%20%E2%80%94%20download%20individually%0Avar%20singleResults%20%3D%20await%20downloadIndividually(batchItems%2C%20token)%3B%0Afor%20(var%20sr%20%3D%200%3B%20sr%20%3C%20singleResults.length%3B%20sr%2B%2B)%20%7B%0Aif%20(singleResults%5Bsr%5D.detail)%20%7B%0Atry%20%7B%0AfullExport.conversations.push(processConversationDetail(singleResults%5Bsr%5D.detail%2C%20singleResults%5Bsr%5D.item))%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(e)%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20singleResults%5Bsr%5D.item.id%2C%20title%3A%20singleResults%5Bsr%5D.item.title%20%7C%7C%20%22Unknown%22%2C%20error%3A%20e.message%7D)%3B%0A%7D%0A%7D%20else%20%7B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20singleResults%5Bsr%5D.item.id%2C%20title%3A%20singleResults%5Bsr%5D.item.title%20%7C%7C%20%22Unknown%22%2C%20error%3A%20singleResults%5Bsr%5D.error%7D)%3B%0A%7D%0A%7D%0AconsecutiveGroupFails%2B%2B%3B%0AbatchIndex%20%2B%3D%20BATCH_SIZE%3B%0A%7D%0A%2F%2F%20Check%20if%20we%20should%20permanently%20give%20up%20on%20batch%20mode%0Aif%20(consecutiveGroupFails%20%3E%3D%20MAX_CONSECUTIVE_FAILS)%20%7B%0Alog(%22Too%20many%20consecutive%20batch%20failures%20(%22%20%2B%20MAX_CONSECUTIVE_FAILS%20%2B%20%22)%2C%20switching%20to%20individual%20mode%22%2C%20%22error%22)%3B%0AuseBatch%20%3D%20false%3B%0A%7D%20else%20if%20(consecutiveGroupFails%20%3E%200)%20%7B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5Cu26A1%20Batch%20mode%20%5Cu2014%20resumed%22%3B%0A%7D%0A%7D%0A%2F%2F%20Update%20UI%20after%20each%20group%0Avar%20completed%20%3D%20successCount%20%2B%20errorCount%3B%0Avar%20lastTitle%20%3D%20batchItems%5BbatchItems.length%20-%201%5D.title%20%7C%7C%20%22Untitled%22%3B%0AupdateDlUI(completed%2C%20filtered.length%2C%20lastTitle%2C%20startTime)%3B%0Aif%20(completed%20%25%20100%20%3D%3D%3D%200%20%7C%7C%20completed%20%3D%3D%3D%20filtered.length)%20%7B%0Alog(%22Progress%3A%20%22%20%2B%20completed%20%2B%20%22%2F%22%20%2B%20filtered.length)%3B%0A%7D%0A%7D%0A%2F%2F%20----%20FALLBACK%3A%20INDIVIDUAL%20DOWNLOADS%20----%0Aif%20(!useBatch)%20%7B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5CuD83D%5CuDC22%20Individual%20mode%22%3B%0Alog(%22Switching%20to%20individual%20downloads%5Cu2026%22)%3B%0A%2F%2F%20Start%20from%20where%20batch%20left%20off%0Avar%20startFrom%20%3D%20successCount%20%2B%20errorCount%3B%0Afor%20(var%20i%20%3D%20startFrom%3B%20i%20%3C%20regularConvos.length%3B%20i%2B%2B)%20%7B%0Avar%20c%20%3D%20regularConvos%5Bi%5D%3B%0Avar%20title%20%3D%20c.title%20%7C%7C%20%22Untitled%22%3B%0AupdateDlUI(i%20%2B%201%2C%20filtered.length%2C%20title%2C%20startTime)%3B%0Atry%20%7B%0Avar%20convoResp%20%3D%20await%20downloadSingle(c.id%2C%20token)%3B%0Aif%20(convoResp.status%20%3D%3D%3D%20429)%20%7B%0Alog(%22Rate%20limited%2C%20waiting%2030s%5Cu2026%22%2C%20%22error%22)%3B%0Avar%20dlTitle%20%3D%20document.getElementById(%22g2c-dl-title%22)%3B%0Avar%20dlRemaining%20%3D%20document.getElementById(%22g2c-dl-remaining%22)%3B%0Aif%20(dlTitle)%20dlTitle.textContent%20%3D%20%22Rate%20limited%20%5Cu2014%20waiting%2030s%5Cu2026%22%3B%0Aif%20(dlRemaining)%20dlRemaining.textContent%20%3D%20%22Will%20resume%20automatically%22%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%2030000)%3B%20%7D)%3B%0Ai--%3B%0Acontinue%3B%0A%7D%0Aif%20(convoResp.status%20!%3D%3D%20200)%20%7B%0Alog(%22Skipped%3A%20%22%20%2B%20title%20%2B%20%22%20(HTTP%20%22%20%2B%20convoResp.status%20%2B%20%22)%22%2C%20%22error%22)%3B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20c.id%2C%20title%3A%20title%2C%20error%3A%20%22HTTP%20%22%20%2B%20convoResp.status%7D)%3B%0Acontinue%3B%0A%7D%0Avar%20detail%20%3D%20await%20convoResp.json()%3B%0Avar%20processed%20%3D%20processConversationDetail(detail%2C%20c)%3B%0AfullExport.conversations.push(processed)%3B%0AsuccessCount%2B%2B%3B%0Aif%20(i%20%25%2025%20%3D%3D%3D%200%20%26%26%20i%20%3E%200)%20%7B%0Alog(%22Progress%3A%20%22%20%2B%20(i%20%2B%201)%20%2B%20%22%2F%22%20%2B%20filtered.length)%3B%0A%7D%0A%7D%20catch%20(err)%20%7B%0Alog(%22Error%3A%20%22%20%2B%20title%20%2B%20%22%20%5Cu2014%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20c.id%2C%20title%3A%20title%2C%20error%3A%20err.message%7D)%3B%0A%7D%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%201000)%3B%20%7D)%3B%0A%7D%0A%7D%0A%7D%20%2F%2F%20end%20if%20(regularConvos.length%20%3E%200)%0A%2F%2F%20----%20DOWNLOAD%20SHARED%20CONVERSATIONS%20----%0Aif%20(sharedConvos.length%20%3E%200)%20%7B%0Alog(%22Downloading%20%22%20%2B%20sharedConvos.length%20%2B%20%22%20shared%20conversation(s)%5Cu2026%22)%3B%0Avar%20dlMode%20%3D%20document.getElementById(%22g2c-dl-mode%22)%3B%0Aif%20(dlMode)%20dlMode.textContent%20%3D%20%22%5CuD83D%5CuDD17%20Shared%20conversations%22%3B%0Afor%20(var%20si%20%3D%200%3B%20si%20%3C%20sharedConvos.length%3B%20si%2B%2B)%20%7B%0Avar%20sc%20%3D%20sharedConvos%5Bsi%5D%3B%0Avar%20shareId%20%3D%20sc._share_id%3B%0Avar%20scTitle%20%3D%20sc.title%20%7C%7C%20%22Shared%20conversation%22%3B%0Avar%20completed%20%3D%20successCount%20%2B%20errorCount%3B%0AupdateDlUI(completed%20%2B%201%2C%20filtered.length%2C%20scTitle%2C%20startTime)%3B%0Atry%20%7B%0Avar%20sharedResp%20%3D%20await%20downloadShared(shareId%2C%20token)%3B%0Aif%20(sharedResp.status%20%3D%3D%3D%20429)%20%7B%0Alog(%22Rate%20limited%2C%20waiting%2030s%5Cu2026%22%2C%20%22error%22)%3B%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%2030000)%3B%20%7D)%3B%0Asi--%3B%20continue%3B%0A%7D%0Aif%20(sharedResp.status%20!%3D%3D%20200)%20%7B%0Alog(%22Skipped%20shared%3A%20%22%20%2B%20scTitle%20%2B%20%22%20(HTTP%20%22%20%2B%20sharedResp.status%20%2B%20%22)%22%2C%20%22error%22)%3B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20sc.id%2C%20title%3A%20scTitle%2C%20shared%3A%20true%2C%20error%3A%20%22HTTP%20%22%20%2B%20sharedResp.status%7D)%3B%0Acontinue%3B%0A%7D%0Avar%20sharedDetail%20%3D%20await%20sharedResp.json()%3B%0Avar%20processed%20%3D%20processConversationDetail(sharedDetail%2C%20sc)%3B%0Aprocessed.shared%20%3D%20true%3B%0Aprocessed.share_id%20%3D%20shareId%3B%0AfullExport.conversations.push(processed)%3B%0AsuccessCount%2B%2B%3B%0A%7D%20catch%20(sharedErr)%20%7B%0Alog(%22Error%20shared%3A%20%22%20%2B%20scTitle%20%2B%20%22%20%5Cu2014%20%22%20%2B%20sharedErr.message%2C%20%22error%22)%3B%0AerrorCount%2B%2B%3B%0AfullExport.conversations.push(%7Bid%3A%20sc.id%2C%20title%3A%20scTitle%2C%20shared%3A%20true%2C%20error%3A%20sharedErr.message%7D)%3B%0A%7D%0Aawait%20new%20Promise(function(r)%20%7B%20setTimeout(r%2C%201000)%3B%20%7D)%3B%0A%7D%0A%7D%0Avar%20json%20%3D%20JSON.stringify(fullExport%2C%20null%2C%202)%3B%0Avar%20sizeBytes%20%3D%20json.length%3B%0Avar%20sizeStr%20%3D%20sizeBytes%20%3C%201024%20*%201024%0A%3F%20(sizeBytes%20%2F%201024).toFixed(0)%20%2B%20%22%20KB%22%0A%3A%20(sizeBytes%20%2F%201024%20%2F%201024).toFixed(1)%20%2B%20%22%20MB%22%3B%0A%2F%2F%20Smart%20filename%20based%20on%20what%20was%20exported%0Avar%20exportFilename%20%3D%20%22chatgpt_all_conversations.json%22%3B%0Avar%20projectNames%20%3D%20%7B%7D%3B%0Avar%20hasMain%20%3D%20false%3B%0Avar%20hasShared%20%3D%20false%3B%0Afor%20(var%20fi%20%3D%200%3B%20fi%20%3C%20fullExport.conversations.length%3B%20fi%2B%2B)%20%7B%0Aif%20(fullExport.conversations%5Bfi%5D.shared)%20%7B%0AhasShared%20%3D%20true%3B%0A%7D%20else%20if%20(fullExport.conversations%5Bfi%5D.project)%20%7B%0AprojectNames%5BfullExport.conversations%5Bfi%5D.project%5D%20%3D%20true%3B%0A%7D%20else%20%7B%0AhasMain%20%3D%20true%3B%0A%7D%0A%7D%0Avar%20projNameList%20%3D%20Object.keys(projectNames)%3B%0Aif%20(!hasMain%20%26%26%20!hasShared%20%26%26%20projNameList.length%20%3D%3D%3D%201)%20%7B%0A%2F%2F%20Only%20one%20project%20exported%0AexportFilename%20%3D%20%22chatgpt_project_%22%20%2B%20projNameList%5B0%5D.toLowerCase().replace(%2F%5B%5Ea-z0-9%5D%2B%2Fg%2C%20%22_%22)%20%2B%20%22.json%22%3B%0A%7D%20else%20if%20(!hasMain%20%26%26%20!hasShared%20%26%26%20projNameList.length%20%3E%201)%20%7B%0AexportFilename%20%3D%20%22chatgpt_projects.json%22%3B%0A%7D%20else%20if%20(!hasMain%20%26%26%20hasShared%20%26%26%20projNameList.length%20%3D%3D%3D%200)%20%7B%0AexportFilename%20%3D%20%22chatgpt_shared_conversations.json%22%3B%0A%7D%0AdownloadFile(json%2C%20exportFilename%2C%20%22application%2Fjson%22)%3B%0Alog(%22DONE!%20%22%20%2B%20successCount%20%2B%20%22%20conversations%2C%20%22%20%2B%20errorCount%20%2B%20%22%20errors%2C%20~%22%20%2B%20sizeStr%2C%20%22success%22)%3B%0A%2F%2F%20Collect%20model%20breakdown%20from%20export%0Avar%20modelBreakdown%20%3D%20%7B%7D%3B%0Afor%20(var%20mi%20%3D%200%3B%20mi%20%3C%20fullExport.conversations.length%3B%20mi%2B%2B)%20%7B%0Avar%20cm%20%3D%20fullExport.conversations%5Bmi%5D.model%20%7C%7C%20%22unknown%22%3B%0AmodelBreakdown%5Bcm%5D%20%3D%20(modelBreakdown%5Bcm%5D%20%7C%7C%200)%20%2B%201%3B%0A%7D%0Avar%20sortedModels%20%3D%20Object.keys(modelBreakdown).sort(function(a%2C%20b)%20%7B%0Areturn%20modelBreakdown%5Bb%5D%20-%20modelBreakdown%5Ba%5D%3B%0A%7D)%3B%0A%2F%2F%20Build%20model%20tags%20HTML%20%E2%80%94%20top%205%20visible%2C%20rest%20collapsed%0Avar%20TOP_N%20%3D%205%3B%0Avar%20modelTagsHtml%20%3D%20'%3Cdiv%20class%3D%22g2c-complete-models-wrap%22%3E'%3B%0Afor%20(var%20ti%20%3D%200%3B%20ti%20%3C%20Math.min(TOP_N%2C%20sortedModels.length)%3B%20ti%2B%2B)%20%7B%0Avar%20mk%20%3D%20sortedModels%5Bti%5D%3B%0AmodelTagsHtml%20%2B%3D%20'%3Cspan%20class%3D%22g2c-scan-tag%22%3E'%20%2B%20mk%20%2B%20'%20%3Cspan%20style%3D%22opacity%3A0.6%3B%22%3E'%20%2B%20modelBreakdown%5Bmk%5D%20%2B%20'%3C%2Fspan%3E%3C%2Fspan%3E'%3B%0A%7D%0Aif%20(sortedModels.length%20%3E%20TOP_N)%20%7B%0Avar%20moreCount%20%3D%20sortedModels.length%20-%20TOP_N%3B%0AmodelTagsHtml%20%2B%3D%20'%3Cbutton%20class%3D%22g2c-models-toggle%22%20id%3D%22g2c-models-toggle%22%3E%2B'%20%2B%20moreCount%20%2B%20'%20more%3C%2Fbutton%3E'%3B%0AmodelTagsHtml%20%2B%3D%20'%3Cdiv%20class%3D%22g2c-models-extra%22%20id%3D%22g2c-models-extra%22%20style%3D%22display%3Anone%3B%22%3E'%3B%0Afor%20(var%20ti%20%3D%20TOP_N%3B%20ti%20%3C%20sortedModels.length%3B%20ti%2B%2B)%20%7B%0Avar%20mk%20%3D%20sortedModels%5Bti%5D%3B%0AmodelTagsHtml%20%2B%3D%20'%3Cspan%20class%3D%22g2c-scan-tag%22%3E'%20%2B%20mk%20%2B%20'%20%3Cspan%20style%3D%22opacity%3A0.6%3B%22%3E'%20%2B%20modelBreakdown%5Bmk%5D%20%2B%20'%3C%2Fspan%3E%3C%2Fspan%3E'%3B%0A%7D%0AmodelTagsHtml%20%2B%3D%20'%3C%2Fdiv%3E'%3B%0A%7D%0AmodelTagsHtml%20%2B%3D%20'%3C%2Fdiv%3E'%3B%0A%2F%2F%20Show%20completion%20screen%20(State%205)%0Avar%20filterPanel%20%3D%20document.getElementById(%22g2c-filter-panel%22)%3B%0Aif%20(filterPanel)%20%7B%0Avar%20elapsed%20%3D%20Math.round((Date.now()%20-%20startTime)%20%2F%201000)%3B%0Avar%20elapsedStr%20%3D%20elapsed%20%3C%2060%20%3F%20elapsed%20%2B%20%22s%22%20%3A%20Math.round(elapsed%20%2F%2060)%20%2B%20%22m%20%22%20%2B%20(elapsed%20%25%2060)%20%2B%20%22s%22%3B%0AfilterPanel.innerHTML%20%3D%20'%5C%0A%3Cdiv%20class%3D%22g2c-complete%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-complete-icon%22%3E%5Cu2705%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-complete-title%22%3EExport%20Complete!%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-complete-sub%22%3E'%20%2B%20successCount%20%2B%20'%20conversations%20%5Cu00B7%20'%20%2B%20sizeStr%20%2B%20'%20%5Cu00B7%20'%20%2B%20elapsedStr%20%2B%20'%3C%2Fdiv%3E%5C%0A'%20%2B%20modelTagsHtml%20%2B%20'%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-whatsnext%22%3E%5C%0A%3Cdiv%20class%3D%22g2c-whatsnext-title%22%3EWhat%5Cu2019s%20next%3F%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-whatsnext-item%22%3E%5C%0A%3Cspan%20style%3D%22color%3A%23a0a0e0%3B%22%3E%5CuD83D%5CuDC40%20Browse%20your%20data%3C%2Fspan%3E%3Cbr%3E%5C%0A%3Cspan%20style%3D%22color%3A%23999%3B%22%3EOpen%20the%20%3Ca%20href%3D%22https%3A%2F%2Fsiamsnus.github.io%2FGPT2Claude-Migration-Kit%2Fviewer.html%22%20target%3D%22_blank%22%3EConversation%20Viewer%3C%2Fa%3E%20to%20explore%20your%20chats.%20You%20can%20%3Ca%20href%3D%22https%3A%2F%2Fsiamsnus.github.io%2FGPT2Claude-Migration-Kit%2Fviewer.html%22%20download%20target%3D%22_blank%22%3Edownload%20it%3C%2Fa%3E%20for%20fully%20offline%20use.%3C%2Fspan%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3Cdiv%20class%3D%22g2c-whatsnext-item%22%3E%5C%0A%3Cspan%20style%3D%22color%3A%237eb8a0%3B%22%3E%5CuD83D%5CuDE80%20Import%20to%20Claude%3C%2Fspan%3E%20%3Cspan%20class%3D%22g2c-whatsnext-badge%22%3Erecommended%3C%2Fspan%3E%3Cbr%3E%5C%0A%3Cspan%20style%3D%22color%3A%23999%3B%22%3EFollow%20the%20%3Ca%20href%3D%22https%3A%2F%2Fsiamsnus.github.io%2FGPT2Claude-Migration-Kit%2F%23importing%22%20target%3D%22_blank%22%3Eimport%20guide%3C%2Fa%3E%20to%20bring%20your%20history%20into%20Claude.%3C%2Fspan%3E%5C%0A%3C%2Fdiv%3E%5C%0A%3C%2Fdiv%3E'%3B%0A%2F%2F%20Wire%20up%20%22show%20more%20models%22%20toggle%0Avar%20modelsToggle%20%3D%20document.getElementById(%22g2c-models-toggle%22)%3B%0Aif%20(modelsToggle)%20%7B%0AmodelsToggle.addEventListener(%22click%22%2C%20function()%20%7B%0Avar%20extra%20%3D%20document.getElementById(%22g2c-models-extra%22)%3B%0Aif%20(extra)%20%7B%0Avar%20showing%20%3D%20extra.style.display%20!%3D%3D%20%22none%22%3B%0Aextra.style.display%20%3D%20showing%20%3F%20%22none%22%20%3A%20%22flex%22%3B%0Athis.textContent%20%3D%20showing%20%3F%20%22%2B%22%20%2B%20(sortedModels.length%20-%20TOP_N)%20%2B%20%22%20more%22%20%3A%20%22show%20less%22%3B%0A%7D%0A%7D)%3B%0A%7D%0A%7D%0A%7D%20catch%20(err)%20%7B%0Alog(%22Download%20failed%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0Avar%20dlTitle%20%3D%20document.getElementById(%22g2c-dl-title%22)%3B%0Aif%20(dlTitle)%20dlTitle.textContent%20%3D%20%22Error%3A%20%22%20%2B%20err.message%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20EXPORT%3A%20INSTRUCTIONS%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aasync%20function%20exportInstructions()%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-btn-instructions%22)%3B%0AsetButtonState(btn%2C%20%22running%22%2C%20%22Exporting...%22)%3B%0Atry%20%7B%0Avar%20token%20%3D%20await%20getToken()%3B%0Avar%20headers%20%3D%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%3B%0Avar%20endpoints%20%3D%20%5B%0A%7Bname%3A%20%22custom_instructions%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fuser_system_messages%22%7D%2C%0A%7Bname%3A%20%22settings%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fsettings%22%7D%2C%0A%7Bname%3A%20%22beta_features%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fsettings%2Fbeta_features%22%7D%2C%0A%7Bname%3A%20%22models%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fmodels%22%7D%2C%0A%7Bname%3A%20%22account%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Faccounts%2Fcheck%2Fv4-2023-04-27%22%7D%2C%0A%7Bname%3A%20%22codex_usage%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fcodex%2Fusage%22%7D%2C%0A%7Bname%3A%20%22compliance%22%2C%20url%3A%20%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fcompliance%22%7D%0A%5D%3B%0Avar%20result%20%3D%20%7B%0Aexport_date%3A%20new%20Date().toISOString()%2C%0Atool%3A%20%22GPT2Claude%20Migration%20Kit%20v2.4%22%2C%0Adata%3A%20%7B%7D%0A%7D%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20endpoints.length%3B%20i%2B%2B)%20%7B%0Avar%20ep%20%3D%20endpoints%5Bi%5D%3B%0Alog(%22Fetching%20%22%20%2B%20ep.name%20%2B%20%22...%22)%3B%0Atry%20%7B%0Avar%20resp%20%3D%20await%20fetch(ep.url%2C%20%7Bcredentials%3A%20%22include%22%2C%20headers%3A%20headers%7D)%3B%0Aif%20(resp.status%20%3D%3D%3D%20200)%20%7B%0Aresult.data%5Bep.name%5D%20%3D%20await%20resp.json()%3B%0Alog(%22Got%3A%20%22%20%2B%20ep.name)%3B%0A%7D%20else%20if%20(resp.status%20%3D%3D%3D%20404)%20%7B%0Aresult.data%5Bep.name%5D%20%3D%20%7Bnote%3A%20%22Not%20available%20on%20this%20account%22%7D%3B%0Alog(ep.name%20%2B%20%22%3A%20not%20available%20(skipped)%22)%3B%0A%7D%20else%20%7B%0Aresult.data%5Bep.name%5D%20%3D%20%7Berror%3A%20%22HTTP%20%22%20%2B%20resp.status%7D%3B%0Alog(ep.name%20%2B%20%22%3A%20HTTP%20%22%20%2B%20resp.status%2C%20%22error%22)%3B%0A%7D%0A%7D%20catch%20(e)%20%7B%0Aresult.data%5Bep.name%5D%20%3D%20%7Berror%3A%20e.message%7D%3B%0Alog(ep.name%20%2B%20%22%20error%3A%20%22%20%2B%20e.message%2C%20%22error%22)%3B%0A%7D%0A%7D%0AdownloadFile(JSON.stringify(result%2C%20null%2C%202)%2C%20%22chatgpt_instructions.json%22%2C%20%22application%2Fjson%22)%3B%0AsetButtonState(btn%2C%20%22done%22%2C%20%22Instructions%20exported%22)%3B%0A%7D%20catch%20(err)%20%7B%0Alog(%22Instructions%20export%20failed%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0AsetButtonState(btn%2C%20%22error%22%2C%20err.message)%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20EVENT%20LISTENERS%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Adocument.getElementById(%22g2c-close%22).addEventListener(%22click%22%2C%20function()%20%7B%0Apanel.style.animation%20%3D%20%22g2c-fadein%200.2s%20ease-out%20reverse%22%3B%0AsetTimeout(function()%20%7B%20panel.remove()%3B%20style.remove()%3B%20%7D%2C%20200)%3B%0A%7D)%3B%0Adocument.getElementById(%22g2c-btn-memory%22).addEventListener(%22click%22%2C%20exportMemories)%3B%0Adocument.getElementById(%22g2c-btn-convos%22).addEventListener(%22click%22%2C%20exportConversations)%3B%0Adocument.getElementById(%22g2c-btn-instructions%22).addEventListener(%22click%22%2C%20exportInstructions)%3B%0Adocument.getElementById(%22g2c-btn-all%22).addEventListener(%22click%22%2C%20async%20function()%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-btn-all%22)%3B%0AsetButtonState(btn%2C%20%22running%22%2C%20%22Exporting%20everything...%22)%3B%0Alog(%22---%20EXPORT%20ALL%20started%20---%22)%3B%0Aawait%20exportMemories()%3B%0Aawait%20exportInstructions()%3B%0Alog(%22Memories%20%26%20instructions%20done.%20Scanning%20conversations...%22)%3B%0Aawait%20exportConversations()%3B%0Alog(%22Memories%20%26%20instructions%20exported.%20Configure%20conversation%20filters%20and%20click%20Download.%22%2C%20%22success%22)%3B%0A%7D)%3B%0Adocument.getElementById(%22g2c-toggle-log%22).addEventListener(%22click%22%2C%20function()%20%7B%0Avar%20logVisible%20%3D%20logEl.classList.contains(%22visible%22)%3B%0AlogEl.classList.toggle(%22visible%22)%3B%0Athis.textContent%20%3D%20logVisible%20%3F%20%22Show%20log%20%5Cu25BC%22%20%3A%20%22Hide%20log%20%5Cu25B2%22%3B%0A%7D)%3B%0A%2F%2F%20Copy%20log%20button%0Adocument.getElementById(%22g2c-copy-log%22).addEventListener(%22click%22%2C%20function()%20%7B%0Avar%20copyBtn%20%3D%20this%3B%0Avar%20entries%20%3D%20document.querySelectorAll(%22.g2c-log-entry%22)%3B%0Avar%20text%20%3D%20%22%22%3B%0Afor%20(var%20i%20%3D%200%3B%20i%20%3C%20entries.length%3B%20i%2B%2B)%20%7B%0Atext%20%2B%3D%20entries%5Bi%5D.textContent%20%2B%20%22%5Cn%22%3B%0A%7D%0Aif%20(navigator.clipboard%20%26%26%20navigator.clipboard.writeText)%20%7B%0Anavigator.clipboard.writeText(text).then(function()%20%7B%0AcopyBtn.textContent%20%3D%20%22%5Cu2705%20Copied!%22%3B%0AsetTimeout(function()%20%7B%20copyBtn.textContent%20%3D%20%22Copy%20log%22%3B%20%7D%2C%202000)%3B%0A%7D).catch(function()%20%7B%0AfallbackCopy(text%2C%20copyBtn)%3B%0A%7D)%3B%0A%7D%20else%20%7B%0AfallbackCopy(text%2C%20copyBtn)%3B%0A%7D%0A%7D)%3B%0Afunction%20fallbackCopy(text%2C%20btn)%20%7B%0Avar%20ta%20%3D%20document.createElement(%22textarea%22)%3B%0Ata.value%20%3D%20text%3B%0Ata.style.position%20%3D%20%22fixed%22%3B%0Ata.style.left%20%3D%20%22-9999px%22%3B%0Adocument.body.appendChild(ta)%3B%0Ata.select()%3B%0Atry%20%7B%0Adocument.execCommand(%22copy%22)%3B%0Abtn.textContent%20%3D%20%22%5Cu2705%20Copied!%22%3B%0AsetTimeout(function()%20%7B%20btn.textContent%20%3D%20%22Copy%20log%22%3B%20%7D%2C%202000)%3B%0A%7D%20catch%20(e)%20%7B%0Abtn.textContent%20%3D%20%22Copy%20failed%22%3B%0AsetTimeout(function()%20%7B%20btn.textContent%20%3D%20%22Copy%20log%22%3B%20%7D%2C%202000)%3B%0A%7D%0Adocument.body.removeChild(ta)%3B%0A%7D%0Alog(%22Ready.%20Click%20a%20button%20to%20start%20exporting.%22)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20CAMERA%20TOGGLE%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Avar%20cameraState%20%3D%20null%3B%20%2F%2F%20null%3Dunknown%2C%20true%3Don%2C%20false%3Doff%0Aasync%20function%20toggleCamera()%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-camera-btn%22)%3B%0Avar%20note%20%3D%20document.getElementById(%22g2c-camera-note%22)%3B%0Aif%20(!btn)%20return%3B%0Abtn.className%20%3D%20%22g2c-tool-toggle%20checking%22%3B%0Abtn.textContent%20%3D%20%22%5Cu2026%22%3B%0Atry%20%7B%0Avar%20token%20%3D%20await%20getToken()%3B%0Avar%20headers%20%3D%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%2C%20%22Content-Type%22%3A%20%22application%2Fjson%22%7D%3B%0A%2F%2F%20If%20we%20don't%20know%20current%20state%2C%20check%20first%0Aif%20(cameraState%20%3D%3D%3D%20null)%20%7B%0Avar%20checkResp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fsettings%2Fbeta_features%22%2C%20%7B%0Acredentials%3A%20%22include%22%2C%20headers%3A%20headers%0A%7D)%3B%0Aif%20(checkResp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20features%20%3D%20await%20checkResp.json()%3B%0AcameraState%20%3D%20!!(features.video_screen_sharing)%3B%0Alog(%22Camera%20currently%3A%20%22%20%2B%20(cameraState%20%3F%20%22ON%22%20%3A%20%22OFF%22))%3B%0A%7D%20else%20%7B%0AcameraState%20%3D%20false%3B%0Alog(%22Beta%20features%3A%20HTTP%20%22%20%2B%20checkResp.status%20%2B%20%22%20(assuming%20off)%22)%3B%0A%7D%0A%7D%0A%2F%2F%20Toggle%20to%20opposite%20state%0Avar%20newState%20%3D%20!cameraState%3B%0Avar%20toggleResp%20%3D%20await%20fetch(%0A%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fsettings%2Fbeta_features%3Ffeature%3Dvideo_screen_sharing%26value%3D%22%20%2B%20newState%2C%0A%7Bmethod%3A%20%22POST%22%2C%20credentials%3A%20%22include%22%2C%20headers%3A%20headers%7D%0A)%3B%0Aif%20(toggleResp.status%20%3D%3D%3D%20200)%20%7B%0AcameraState%20%3D%20newState%3B%0Abtn.className%20%3D%20%22g2c-tool-toggle%22%20%2B%20(newState%20%3F%20%22%20on%22%20%3A%20%22%22)%3B%0Abtn.textContent%20%3D%20newState%20%3F%20%22ON%22%20%3A%20%22OFF%22%3B%0Alog(%22Camera%20%22%20%2B%20(newState%20%3F%20%22enabled%22%20%3A%20%22disabled%22)%2C%20%22success%22)%3B%0Aif%20(note)%20%7B%0Anote.style.display%20%3D%20%22block%22%3B%0Anote.textContent%20%3D%20newState%0A%3F%20%22%5Cu2705%20Enabled!%20Refresh%20the%20page%20(F5)%20to%20see%20the%20camera%20icon%22%0A%3A%20%22Disabled.%20Refresh%20the%20page%20to%20remove%20the%20camera%20icon%22%3B%0AsetTimeout(function()%20%7B%0Aif%20(note)%20note.style.display%20%3D%20%22none%22%3B%0A%7D%2C%208000)%3B%0A%7D%0A%7D%20else%20%7B%0Athrow%20new%20Error(%22HTTP%20%22%20%2B%20toggleResp.status)%3B%0A%7D%0A%7D%20catch%20(err)%20%7B%0Abtn.className%20%3D%20%22g2c-tool-toggle%22%3B%0Abtn.textContent%20%3D%20%22Error%22%3B%0Alog(%22Camera%20toggle%20failed%3A%20%22%20%2B%20err.message%2C%20%22error%22)%3B%0AsetTimeout(function()%20%7B%0Aif%20(btn)%20btn.textContent%20%3D%20%22Retry%22%3B%0A%7D%2C%202000)%3B%0A%7D%0A%7D%0A%2F%2F%20Auto-check%20camera%20state%20on%20load%0A(async%20function()%20%7B%0Atry%20%7B%0Avar%20btn%20%3D%20document.getElementById(%22g2c-camera-btn%22)%3B%0Aif%20(!btn)%20return%3B%0Avar%20token%20%3D%20await%20getToken()%3B%0Avar%20headers%20%3D%20%7B%22Authorization%22%3A%20%22Bearer%20%22%20%2B%20token%7D%3B%0Avar%20resp%20%3D%20await%20fetch(%22https%3A%2F%2Fchatgpt.com%2Fbackend-api%2Fsettings%2Fbeta_features%22%2C%20%7B%0Acredentials%3A%20%22include%22%2C%20headers%3A%20headers%0A%7D)%3B%0Aif%20(resp.status%20%3D%3D%3D%20200)%20%7B%0Avar%20features%20%3D%20await%20resp.json()%3B%0AcameraState%20%3D%20!!(features.video_screen_sharing)%3B%0Abtn.className%20%3D%20%22g2c-tool-toggle%22%20%2B%20(cameraState%20%3F%20%22%20on%22%20%3A%20%22%22)%3B%0Abtn.textContent%20%3D%20cameraState%20%3F%20%22ON%22%20%3A%20%22OFF%22%3B%0A%7D%0A%7D%20catch%20(e)%20%7B%0A%2F%2F%20silent%20%E2%80%94%20user%20can%20click%20to%20check%20manually%0A%7D%0A%7D)()%3B%0AsafeAddEvent(%22g2c-camera-btn%22%2C%20%22click%22%2C%20toggleCamera)%3B%0A%7D)()%3B"
           onclick="event.preventDefault();alert('Don\'t click — drag this button up to your bookmark bar!');">
          📦 GPT→Claude Export
        </a>
        <p class="drag-hint"><strong>Drag</strong> the button above to your bookmark bar.<br>No bookmark bar? Press <strong>Ctrl+Shift+B</strong></p>
      </div>
      <div class="install-steps">
        <div class="install-step"><div class="install-step-num">1</div><p>Drag the gold button above into your <strong>bookmark bar</strong></p></div>
        <div class="install-step"><div class="install-step-num">2</div><p>Go to <a href="https://chatgpt.com" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:600;">chatgpt.com</a> and make sure you're logged in</p></div>
        <div class="install-step"><div class="install-step-num">3</div><p>Click the <strong>GPT→Claude Export</strong> bookmark — a panel appears on the page</p></div>
        <div class="install-step"><div class="install-step-num">4</div><p>Click the export buttons. Files download to your computer automatically.</p></div>
      </div>
    </div>

    <!-- FIREFOX TAB -->
    <div class="tab-content" id="tab-firefox">
      <div class="install-steps">
        <div class="install-step"><div class="install-step-num">⚠️</div>
          <div>
            <p>Firefox can't use the bookmarklet — it exceeds Firefox's 65KB bookmark URL limit, and ChatGPT's security policy blocks external script loading. <strong>Use console paste instead:</strong></p>
          </div>
        </div>
        <div class="install-step"><div class="install-step-num">1</div><p>Go to <a href="https://chatgpt.com" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:600;">chatgpt.com</a> and log in</p></div>
        <div class="install-step"><div class="install-step-num">2</div><p>Press <strong>F12</strong> on your keyboard → click the <strong>Console</strong> tab</p></div>
        <div class="install-step"><div class="install-step-num">3</div>
          <div>
            <p>If Firefox warns about pasting, type <strong>allow pasting</strong> and press Enter first</p>
          </div>
        </div>
        <div class="install-step"><div class="install-step-num">4</div>
          <div>
            <p>Click the button below to copy the export script:</p>
            <button class="action-btn" id="copy-firefox-script" style="margin-top:0.5rem;">📋 Copy export script</button>
            <p class="copy-confirm" id="copy-firefox-confirm">✅ Copied! Now paste into the console.</p>
          </div>
        </div>
        <div class="install-step"><div class="install-step-num">5</div><p>Click inside the console, press <strong>Ctrl+V</strong> to paste, then press <strong>Enter</strong></p></div>
        <div class="install-step"><div class="install-step-num">6</div><p>The export panel appears on the ChatGPT page. Click the buttons to export.</p></div>
      </div>
    </div>

    <!-- ANY BROWSER / PASTE TAB -->
    <div class="tab-content" id="tab-paste">
      <div class="install-steps">
        <div class="install-step"><div class="install-step-num">1</div><p>Go to <a href="https://chatgpt.com" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:600;">chatgpt.com</a> and log in</p></div>
        <div class="install-step"><div class="install-step-num">2</div><p>Press <strong>F12</strong> on your keyboard → click the <strong>Console</strong> tab</p></div>
        <div class="install-step"><div class="install-step-num">3</div>
          <div>
            <p>Click the button below to copy the export script:</p>
            <button class="action-btn" id="copy-full-script" style="margin-top:0.5rem;">📋 Copy export script</button>
            <p class="copy-confirm" id="copy-script-confirm">✅ Copied! Now paste into the console.</p>
          </div>
        </div>
        <div class="install-step"><div class="install-step-num">4</div><p>Click inside the console, press <strong>Ctrl+V</strong> to paste, then press <strong>Enter</strong></p></div>
        <div class="install-step"><div class="install-step-num">5</div><p>The export panel appears on the ChatGPT page. Click the buttons to export.</p></div>
      </div>
      <p style="font-size:0.8rem; color:#555; margin-top:1rem;">Firefox users: if you see a warning about pasting, type <strong>allow pasting</strong> and press Enter first.</p>
    </div>
  </div>

  <!-- ========== HOW TO USE ========== -->
  <div class="steps">
    <h2>What happens when you run it</h2>
    <div class="step-list">
      <div class="step-item">
        <div class="step-num s1">1</div>
        <div class="step-text"><h3>A floating panel appears</h3><p>Dark panel on the right side of the ChatGPT page with three export buttons. You can drag it around.</p></div>
      </div>
      <div class="step-item">
        <div class="step-num s2">2</div>
        <div class="step-text"><h3>Click each button to export</h3><p>Memories, conversations, and instructions. Each one downloads a file automatically. Conversations show a progress bar.</p></div>
      </div>
      <div class="step-item">
        <div class="step-num s3">3</div>
        <div class="step-text"><h3>Upload to Claude</h3><p>Go to <a href="https://claude.ai" style="color:var(--accent)">claude.ai</a> (or the desktop app: <strong>+</strong> → <strong>Add files</strong>) and upload the downloaded files.</p></div>
      </div>
    </div>
  </div>

  <!-- ========== WHAT YOU GET ========== -->
  <div class="exports-section">
    <h2>What you get</h2>
    <div class="export-grid">
      <div class="export-card">
        <div class="icon">🧠</div>
        <h3>Memories</h3>
        <p>Every fact ChatGPT memorized about you.</p>
        <span class="filename">chatgpt_memories.md</span>
      </div>
      <div class="export-card">
        <div class="icon">💬</div>
        <h3>Conversations</h3>
        <p>Every chat with full history, timestamps, model info.</p>
        <span class="filename">chatgpt_all_conversations.json</span>
      </div>
      <div class="export-card">
        <div class="icon">⚙️</div>
        <h3>Instructions</h3>
        <p>Custom instructions and settings.</p>
        <span class="filename">chatgpt_instructions.json</span>
      </div>
    </div>
  </div>

  <!-- ========== IMPORTING TO CLAUDE ========== -->
  <div class="exports-section" id="importing">
    <h2>Importing to Claude</h2>
    <div class="step-list">
      <div class="step-item">
        <div class="step-num s1">1</div>
        <div class="step-text">
          <h3>Upload memories first</h3>
          <p>Upload <strong>chatgpt_memories.md</strong> with this prompt:</p>
          <p style="color:var(--accent); margin-top:0.5rem; font-style:italic;">"I just migrated from ChatGPT. This file contains all the facts and memories ChatGPT had stored about me. Please read through every item carefully and remember all of these facts about me. Confirm what you've learned and note if anything seems contradictory or outdated."</p>
        </div>
      </div>
      <div class="step-item">
        <div class="step-num s2">2</div>
        <div class="step-text">
          <h3>Upload conversations</h3>
          <p>Upload <strong>chatgpt_all_conversations.json</strong> (zip it if large) with this prompt:</p>
          <p style="color:var(--accent); margin-top:0.5rem; font-style:italic;">"This is my complete ChatGPT conversation history. Please analyze it and create a structured summary: (1) Key ongoing projects, (2) Important decisions, (3) Personal context and preferences, (4) Anything unfinished I should pick up."</p>
        </div>
      </div>
      <div class="step-item">
        <div class="step-num s3">3</div>
        <div class="step-text">
          <h3>Upload instructions</h3>
          <p>Upload <strong>chatgpt_instructions.json</strong> with this prompt:</p>
          <p style="color:var(--accent); margin-top:0.5rem; font-style:italic;">"These are my custom instructions from ChatGPT. Please adapt your communication style to match my preferences."</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== WHAT TO EXPECT ========== -->
  <div class="exports-section" id="expectations">
    <h2>What to expect after migrating</h2>
    <div class="fallback-box">
      <h3>Claude remembers the facts, but needs time to know <em>you</em></h3>
      <p>Think of it like switching doctors. The new doctor has your complete file but doesn't <em>know</em> you yet. Claude gets roughly <strong>70%</strong> from the import. The rest — your humor, style, priorities — builds naturally over a couple of weeks.</p>
      <p style="margin-bottom:0;"><strong>The upside:</strong> Claude calibrates to who you are <em>now</em>, not who you were two years ago.</p>
    </div>
    <div class="fallback-box">
      <h3>Example conversations after import</h3>
      <p style="color:var(--text);"><strong>You:</strong> "Remember that sourdough recipe we worked on?"</p>
      <p style="color:var(--accent)"><strong>Claude:</strong> "Yes — 78% hydration, overnight cold proof. You said the crust was perfect but crumb too dense. We were going to try autolyse. Want to tweak it?"</p>
      <p style="color:var(--text); margin-top:0.75rem;"><strong>You:</strong> "What was that movie you recommended?"</p>
      <p style="color:var(--accent); margin-bottom:0;"><strong>Claude:</strong> "You asked for sci-fi that doesn't treat the audience like idiots. I suggested Arrival, Primer, and Coherence. You watched Primer and said it melted your brain."</p>
    </div>
  </div>

  <!-- ========== FAQ ========== -->
  <div class="faq">
    <h2>Common questions</h2>
    <div class="faq-item"><h3>How do I read the exported JSON?</h3><p>Open the <a href="viewer.html" style="color:var(--accent);text-decoration:none;font-weight:600;">Conversation Viewer</a> in your browser and drag your file into it. You can browse, sort, and search all your conversations in a chat-like format. Or upload the file to Claude and ask it to find what you're looking for.</p></div>
    <div class="faq-item"><h3>Is this safe?</h3><p>Everything runs in your browser. No data is sent anywhere. Files save directly to your computer. Source code is open on GitHub.</p></div>
    <div class="faq-item"><h3>How long does the conversation export take?</h3><p>~1 second per conversation. 500 chats ≈ 10 minutes. Don't close the tab.</p></div>
    <div class="faq-item"><h3>Works with free ChatGPT?</h3><p>Yes. Free, Plus, Team, Enterprise — all work.</p></div>
    <div class="faq-item"><h3>File too large for Claude?</h3><p>Zip it first. Right-click → Compress. Claude accepts .zip uploads.</p></div>
    <div class="faq-item"><h3>Export stopped or errored?</h3><p>Usually a rate limit. Wait a minute, refresh <a href="https://chatgpt.com" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;font-weight:700;">chatgpt.com</a>, try again. The tool retries automatically.</p></div>
    <div class="faq-item"><h3>Will OpenAI ban me?</h3><p>You're accessing your own data through your own login session, using the same API the website uses. That said, these are undocumented endpoints.</p></div>
    <div class="faq-item"><h3>Why not just use a browser extension?</h3><p>Extensions export conversations as text. This tool exports <strong>memory items</strong>, message metadata, timestamps, model info, and custom instructions — everything needed for a real migration.</p></div>
  </div>

  <!-- ========== FOOTER ========== -->
  <div class="footer">
    <p>GPT→Claude Migration Kit — built with <a href="https://claude.ai">Claude</a> by <a href="https://www.siamsnus.com">Siamsnus</a></p>
    <p>Open source under MIT License — <a href="https://github.com/Siamsnus/GPT2Claude-Migration-Kit">View source on GitHub</a></p>
    <p style="margin-top:0.75rem; font-size:0.72rem; color:#444;">OpenAI's internal API may change without notice. Not affiliated with OpenAI or Anthropic.</p>
  </div>
</div>

<!-- Full script stored here for copy button -->
<script id="migrate-source" type="text/plain">
// GPT2Claude Migration Kit v2.4
// https://github.com/Siamsnus/GPT2Claude-Migration-Kit
// Exports ChatGPT memories, conversations, and instructions
// No data leaves your browser - everything runs locally

(function() {
  // Prevent double-loading
  if (document.getElementById("gpt2claude-panel")) {
    var existing = document.getElementById("gpt2claude-panel");
    existing.style.animation = "g2c-shake 0.3s ease-in-out";
    setTimeout(function() { existing.style.animation = ""; }, 300);
    return;
  }

  // ========== STYLES ==========
  var style = document.createElement("style");
  style.textContent = "\
    @keyframes g2c-fadein { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }\
    @keyframes g2c-shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }\
    @keyframes g2c-spin { to { transform: rotate(360deg); } }\
    @keyframes g2c-pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }\
    @keyframes g2c-indeterminate { 0% { left: -30%; width: 30%; } 50% { left: 50%; width: 30%; } 100% { left: 100%; width: 30%; } }\
    @keyframes g2c-pulse-count { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }\
    @keyframes g2c-dot-bounce { 0%,80%,100% { transform: translateY(0); } 40% { transform: translateY(-4px); } }\
    .g2c-progress-fill.indeterminate { position: relative; width: 100% !important; background: none !important; overflow: hidden; }\
    .g2c-progress-fill.indeterminate::after { content: ''; position: absolute; top: 0; left: -30%; width: 30%; height: 100%; background: linear-gradient(90deg, transparent, #d4a574, transparent); border-radius: 3px; animation: g2c-indeterminate 1.5s ease-in-out infinite; }\
    .g2c-scan-hero { text-align: center; padding: 20px 0 10px; }\
    .g2c-scan-hero .g2c-scan-count { font-size: 42px; font-weight: 800; color: #d4a574; font-variant-numeric: tabular-nums; animation: g2c-pulse-count 2s ease-in-out infinite; line-height: 1; }\
    .g2c-scan-hero .g2c-scan-label { font-size: 12px; color: #888; margin-top: 4px; }\
    .g2c-scan-hero .g2c-scan-status { display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 12px; font-size: 12px; color: #999; }\
    .g2c-scan-dots { display: flex; gap: 3px; }\
    .g2c-scan-dots span { width: 4px; height: 4px; background: #d4a574; border-radius: 50%; animation: g2c-dot-bounce 1.2s ease-in-out infinite; }\
    .g2c-scan-dots span:nth-child(2) { animation-delay: 0.15s; }\
    .g2c-scan-dots span:nth-child(3) { animation-delay: 0.3s; }\
    .g2c-scan-models { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; margin-top: 14px; padding-top: 14px; border-top: 1px solid #2a2a35; }\
    .g2c-scan-tag { font-size: 10px; padding: 3px 10px; background: #1e1e26; border: 1px solid #2a2a35; border-radius: 20px; color: #a0a0e0; font-family: 'SF Mono', Consolas, monospace; }\
    .g2c-scan-reassure { font-size: 11px; color: #555; text-align: center; margin-top: 12px; }\
    .g2c-dl-hero { text-align: center; padding: 16px 0 8px; }\
    .g2c-dl-hero .g2c-dl-count { font-size: 28px; font-weight: 700; color: #7eb8a0; }\
    .g2c-dl-hero .g2c-dl-of { font-size: 14px; color: #555; }\
    .g2c-dl-hero .g2c-dl-title { font-size: 11px; color: #888; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 10px; }\
    .g2c-dl-pct { font-size: 11px; color: #d4a574; font-family: 'SF Mono', Consolas, monospace; text-align: right; margin-top: 6px; }\
    .g2c-dl-remaining { font-size: 11px; color: #666; text-align: center; margin-top: 8px; }\
    .g2c-complete { text-align: center; padding: 20px 0 10px; }\
    .g2c-complete-icon { font-size: 36px; margin-bottom: 6px; }\
    .g2c-complete-title { font-size: 18px; font-weight: 700; color: #7eb8a0; }\
    .g2c-complete-sub { font-size: 12px; color: #888; margin-top: 6px; }\
    .g2c-complete-models { font-size: 11px; color: #d4a574; margin-top: 6px; font-family: 'SF Mono', Consolas, monospace; }\
.g2c-complete-models-wrap { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; margin-top: 12px; }\
.g2c-models-extra { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; width: 100%; margin-top: 4px; }\
.g2c-models-toggle { font-size: 10px; padding: 3px 10px; background: none; border: 1px dashed #333340; border-radius: 20px; color: #888; cursor: pointer; font-family: 'SF Mono', Consolas, monospace; }\
.g2c-models-toggle:hover { border-color: #d4a574; color: #d4a574; }\
    .g2c-whatsnext { margin: 16px 0; padding: 14px; background: #141418; border: 1px solid #252530; border-radius: 10px; }\
    .g2c-whatsnext-title { font-size: 11px; color: #888; margin-bottom: 10px; font-weight: 600; }\
    .g2c-whatsnext-item { font-size: 12px; color: #ccc; line-height: 1.8; margin-bottom: 10px; }\
    .g2c-whatsnext-item:last-child { margin-bottom: 0; }\
    .g2c-whatsnext-item a { color: #d4a574; text-decoration: none; }\
    .g2c-whatsnext-item a:hover { text-decoration: underline; }\
    .g2c-whatsnext-badge { font-size: 10px; color: #7eb8a0; background: rgba(126,184,160,0.12); padding: 1px 6px; border-radius: 4px; }\
    .g2c-copy-log { background: none; border: none; color: #666; font-size: 11px; cursor: pointer; padding: 6px 0; margin-top: 10px; margin-left: 12px; }\
    .g2c-copy-log:hover { color: #aaa; }\
    #gpt2claude-panel { position: fixed; top: 50%; right: 24px; transform: translateY(-50%); width: 360px; background: #1a1a1f; border: 1px solid #333340; border-radius: 16px; box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.06); z-index: 999999; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #e8e8ec; animation: g2c-fadein 0.3s ease-out; }\
    #gpt2claude-panel * { box-sizing: border-box; margin: 0; padding: 0; }\
    .g2c-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 22px 14px; border-bottom: 1px solid #2a2a35; background: #1e1e24; border-radius: 16px 16px 0 0; }\
    .g2c-title { font-size: 15px; font-weight: 700; letter-spacing: -0.01em; }\
    .g2c-title span.gpt { color: #a0a0e0; }\
    .g2c-title span.arrow { color: #555; margin: 0 4px; }\
    .g2c-title span.claude { color: #d4a574; }\
    .g2c-version { font-size: 10px; color: #666; font-weight: 600; margin-top: 2px; }\
    .g2c-close { background: none; border: none; color: #777; font-size: 20px; cursor: pointer; padding: 4px 8px; border-radius: 6px; line-height: 1; }\
    .g2c-close:hover { background: #252530; color: #e8e8ec; }\
    .g2c-body { padding: 18px 22px 14px; }\
    .g2c-btn { width: 100%; padding: 14px 16px; border: 1px solid #333340; border-radius: 12px; background: #222228; color: #e8e8ec; font-size: 13px; font-weight: 600; cursor: pointer; text-align: left; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; transition: all 0.15s ease; position: relative; overflow: hidden; }\
    .g2c-btn:hover { background: #2a2a32; border-color: #444450; transform: translateY(-1px); }\
    .g2c-btn:active { transform: translateY(0); }\
    .g2c-btn.running { pointer-events: none; border-color: #d4a574; }\
    .g2c-btn.done { border-color: #7eb8a0; }\
    .g2c-btn.error { border-color: #e07070; }\
    .g2c-btn-icon { font-size: 20px; width: 28px; text-align: center; flex-shrink: 0; }\
    .g2c-btn-text { flex: 1; }\
    .g2c-btn-sub { font-size: 11px; color: #777; font-weight: 400; margin-top: 3px; }\
    .g2c-progress { margin-top: 10px; }\
    .g2c-progress-bar { width: 100%; height: 5px; background: #252530; border-radius: 3px; overflow: hidden; }\
    .g2c-progress-fill { height: 100%; background: linear-gradient(90deg, #d4a574, #e8c49a); border-radius: 3px; transition: width 0.3s ease; width: 0%; }\
    .g2c-progress-text { font-size: 11px; color: #999; margin-top: 6px; }\
    .g2c-log { margin-top: 14px; max-height: 140px; overflow-y: auto; background: #141418; border: 1px solid #252530; border-radius: 10px; padding: 10px 12px; font-family: 'SF Mono', 'Consolas', monospace; font-size: 11px; line-height: 1.6; color: #999; display: none; }\
    .g2c-log.visible { display: block; }\
    .g2c-log-entry { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 1px 0; }\
    .g2c-log-entry.error { color: #e07070; }\
    .g2c-log-entry.success { color: #7eb8a0; }\
    .g2c-footer { padding: 14px 22px; border-top: 1px solid #252530; display: flex; justify-content: space-between; align-items: center; }\
    .g2c-footer-text { font-size: 10px; color: #555; }\
    .g2c-footer-link { font-size: 10px; color: #d4a574; text-decoration: none; }\
    .g2c-footer-link:hover { text-decoration: underline; }\
    .g2c-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #444; border-top-color: #d4a574; border-radius: 50%; animation: g2c-spin 0.6s linear infinite; }\
    .g2c-toggle-log { background: none; border: none; color: #666; font-size: 11px; cursor: pointer; padding: 6px 0; margin-top: 10px; }\
    .g2c-toggle-log:hover { color: #aaa; }\
    .g2c-drag-handle { cursor: move; }\
    .g2c-divider { height: 1px; background: #2a2a35; margin: 6px 0 10px; }\
    .g2c-tool-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: #1e1e26; border: 1px solid #252530; border-radius: 10px; margin-bottom: 6px; }\
    .g2c-tool-label { font-size: 12px; color: #ccc; display: flex; align-items: center; gap: 8px; }\
    .g2c-tool-label .icon { font-size: 16px; }\
    .g2c-tool-label .sub { font-size: 10px; color: #666; display: block; }\
    .g2c-tool-toggle { padding: 4px 12px; border-radius: 6px; border: 1px solid #333340; background: #222228; color: #999; font-size: 11px; cursor: pointer; font-weight: 600; transition: all 0.15s; }\
    .g2c-tool-toggle:hover { border-color: #d4a574; color: #d4a574; }\
    .g2c-tool-toggle.on { border-color: #7eb8a0; color: #7eb8a0; background: rgba(126,184,160,0.08); }\
    .g2c-tool-toggle.checking { pointer-events: none; color: #555; }\
    .g2c-tool-note { font-size: 10px; color: #7eb8a0; text-align: center; padding: 4px 0 2px; display: none; }\
    .g2c-filter-panel { margin-top: 10px; }\
    .g2c-filter-section { margin-bottom: 12px; }\
    .g2c-filter-label { font-size: 10px; color: #888; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }\
    .g2c-filter-models { max-height: 120px; overflow-y: auto; background: #141418; border: 1px solid #252530; border-radius: 8px; padding: 6px 8px; }\
    .g2c-model-row { display: flex; align-items: center; padding: 3px 0; font-size: 12px; cursor: pointer; color: #ccc; }\
    .g2c-model-row:hover { color: #fff; }\
    .g2c-model-row input { margin-right: 8px; accent-color: #d4a574; }\
    .g2c-model-row .cnt { color: #666; margin-left: auto; font-size: 10px; font-family: monospace; }\
    .g2c-filter-row { display: flex; gap: 8px; align-items: center; margin-bottom: 6px; }\
    .g2c-filter-input { flex: 1; padding: 6px 8px; background: #141418; border: 1px solid #252530; border-radius: 6px; color: #e8e8ec; font-size: 12px; font-family: monospace; outline: none; }\
    .g2c-filter-input:focus { border-color: #d4a574; }\
    .g2c-filter-input::placeholder { color: #555; }\
    .g2c-filter-summary { font-size: 12px; color: #d4a574; padding: 8px 0; font-weight: 600; }\
    .g2c-filter-drop { border: 1px dashed #333340; border-radius: 8px; padding: 10px; text-align: center; font-size: 11px; color: #666; cursor: pointer; transition: all 0.15s; }\
    .g2c-filter-drop:hover { border-color: #d4a574; color: #999; }\
    .g2c-filter-drop.active { border-color: #7eb8a0; color: #7eb8a0; }\
    .g2c-select-btns { display: flex; gap: 6px; margin-top: 4px; }\
    .g2c-select-btns button { background: none; border: none; color: #666; font-size: 10px; cursor: pointer; padding: 0; }\
    .g2c-select-btns button:hover { color: #d4a574; }\
  ";
  document.head.appendChild(style);

  // ========== PANEL HTML ==========
  var panel = document.createElement("div");
  panel.id = "gpt2claude-panel";
  panel.innerHTML = '\
    <div class="g2c-header g2c-drag-handle">\
      <div>\
        <div class="g2c-title"><span class="gpt">GPT</span><span class="arrow">\u2192</span><span class="claude">Claude</span></div>\
        <div class="g2c-version">Migration Kit v2.4</div>\
      </div>\
      <button class="g2c-close" id="g2c-close">\u00D7</button>\
    </div>\
    <div class="g2c-body">\
      <button class="g2c-btn" id="g2c-btn-memory">\
        <div class="g2c-btn-icon">\uD83E\uDDE0</div>\
        <div class="g2c-btn-text">\
          Export Memories\
          <div class="g2c-btn-sub">Facts ChatGPT learned about you</div>\
        </div>\
      </button>\
      <button class="g2c-btn" id="g2c-btn-convos">\
        <div class="g2c-btn-icon">\uD83D\uDCAC</div>\
        <div class="g2c-btn-text">\
          Export All Conversations\
          <div class="g2c-btn-sub">Scans first, then you choose what to download</div>\
        </div>\
      </button>\
      <button class="g2c-btn" id="g2c-btn-instructions">\
        <div class="g2c-btn-icon">\u2699\uFE0F</div>\
        <div class="g2c-btn-text">\
          Export Instructions\
          <div class="g2c-btn-sub">Custom instructions &amp; settings</div>\
        </div>\
      </button>\
      <button class="g2c-btn" id="g2c-btn-all" style="border-color:#d4a574;background:#222228;">\
        <div class="g2c-btn-icon">\uD83D\uDCE5</div>\
        <div class="g2c-btn-text">\
          <span style="color:#d4a574;">Export Everything</span>\
          <div class="g2c-btn-sub">All three in one click</div>\
        </div>\
      </button>\
      <div class="g2c-divider" id="g2c-camera-divider"></div>\
      <div class="g2c-tool-row" id="g2c-camera-row">\
        <div class="g2c-tool-label">\
          <span class="icon">\uD83D\uDCF7</span>\
          <span>Desktop Camera<span class="sub">Chromium only (Chrome, Brave, Edge)</span></span>\
        </div>\
        <button class="g2c-tool-toggle" id="g2c-camera-btn">Check</button>\
      </div>\
      <div class="g2c-tool-note" id="g2c-camera-note"></div>\
      <div class="g2c-progress" id="g2c-progress" style="display:none;">\
        <div class="g2c-progress-bar"><div class="g2c-progress-fill" id="g2c-progress-fill"></div></div>\
        <div class="g2c-progress-text" id="g2c-progress-text"></div>\
      </div>\
      <button class="g2c-toggle-log" id="g2c-toggle-log">Show log \u25BC</button>\
      <button class="g2c-copy-log" id="g2c-copy-log">Copy log</button>\
      <div class="g2c-log" id="g2c-log"></div>\
    </div>\
    <div class="g2c-footer">\
      <span class="g2c-footer-text">All data stays in your browser</span>\
      <a class="g2c-footer-link" href="https://github.com/Siamsnus/GPT2Claude-Migration-Kit" target="_blank">GitHub</a>\
    </div>\
  ';
  document.body.appendChild(panel);

  // ========== DRAGGING ==========
  var isDragging = false;
  var dragOffsetX = 0;
  var dragOffsetY = 0;
  var header = panel.querySelector(".g2c-drag-handle");

  header.addEventListener("mousedown", function(e) {
    if (e.target.classList.contains("g2c-close")) return;
    isDragging = true;
    var rect = panel.getBoundingClientRect();
    dragOffsetX = e.clientX - rect.left;
    dragOffsetY = e.clientY - rect.top;
    panel.style.transition = "none";
    e.preventDefault();
  });

  document.addEventListener("mousemove", function(e) {
    if (!isDragging) return;
    panel.style.right = "auto";
    panel.style.transform = "none";
    panel.style.left = (e.clientX - dragOffsetX) + "px";
    panel.style.top = (e.clientY - dragOffsetY) + "px";
  });

  document.addEventListener("mouseup", function() {
    isDragging = false;
    panel.style.transition = "";
  });

  // ========== HELPERS ==========
  var logEl = document.getElementById("g2c-log");
  var progressEl = document.getElementById("g2c-progress");
  var progressFill = document.getElementById("g2c-progress-fill");
  var progressText = document.getElementById("g2c-progress-text");

  function log(msg, type) {
    var entry = document.createElement("div");
    entry.className = "g2c-log-entry" + (type ? " " + type : "");
    entry.textContent = msg;
    logEl.appendChild(entry);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function setProgress(pct, text) {
    progressEl.style.display = "block";
    progressFill.style.width = pct + "%";
    if (text) progressText.textContent = text;
  }

  function setButtonState(btn, state, label) {
    btn.className = "g2c-btn " + state;
    var iconEl = btn.querySelector(".g2c-btn-icon");
    if (state === "running") {
      iconEl.innerHTML = '<div class="g2c-spinner"></div>';
    } else if (state === "done") {
      iconEl.textContent = "\u2705";
    } else if (state === "error") {
      iconEl.textContent = "\u274C";
    }
    if (label) {
      btn.querySelector(".g2c-btn-sub").textContent = label;
    }
  }

  function downloadFile(content, filename, type) {
    var blob = new Blob([content], {type: type || "text/plain"});
    var url = URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    log("Downloaded: " + filename, "success");
  }

  // Safe event listener helper — guards against null elements in ChatGPT's SPA
  function safeAddEvent(id, event, handler) {
    var el = document.getElementById(id);
    if (el) {
      el.addEventListener(event, handler);
    } else {
      log("Warning: element #" + id + " not found", "error");
    }
    return el;
  }

  var cachedToken = null;

  async function getToken() {
    if (cachedToken) return cachedToken;
    log("Authenticating...");
    var resp = await fetch("https://chatgpt.com/api/auth/session", {credentials: "include"});
    if (resp.status !== 200) {
      throw new Error("Auth failed (HTTP " + resp.status + "). Are you logged in?");
    }
    var data = await resp.json();
    if (!data.accessToken) {
      throw new Error("No token found. Please refresh chatgpt.com and try again.");
    }
    cachedToken = data.accessToken;
    log("Authenticated OK");
    // Detect account type (async, non-blocking)
    detectAccount(cachedToken);
    return cachedToken;
  }

  // Account detection — plan type, workspace info
  var cachedAccountInfo = null;
  async function detectAccount(token) {
    if (cachedAccountInfo) return cachedAccountInfo;
    try {
      var resp = await fetch("https://chatgpt.com/backend-api/accounts/check/v4-2023-04-27", {
        credentials: "include",
        headers: {"Authorization": "Bearer " + token}
      });
      if (resp.status !== 200) {
        log("Account check: HTTP " + resp.status);
        return null;
      }
      var data = await resp.json();
      var accounts = data.accounts || {};
      var acctIds = Object.keys(accounts).filter(function(k) { return k !== "default"; });
      if (acctIds.length === 0) return null;
      var primary = accounts[acctIds[0]];
      var acct = primary.account || {};
      cachedAccountInfo = {
        account_id: acct.account_id || acctIds[0],
        plan_type: acct.plan_type || "unknown",
        structure: acct.structure || "unknown",
        workspace_type: acct.workspace_type || null,
        organization_id: acct.organization_id || null,
        is_hipaa: acct.is_hipaa_compliant_workspace || false,
        features: primary.features || []
      };
      var label = cachedAccountInfo.plan_type.charAt(0).toUpperCase() + cachedAccountInfo.plan_type.slice(1);
      var structLabel = cachedAccountInfo.structure === "personal" ? "personal" : cachedAccountInfo.structure;
      if (cachedAccountInfo.workspace_type) structLabel += "/" + cachedAccountInfo.workspace_type;
      log("Account: " + label + " (" + structLabel + ")");
      if (cachedAccountInfo.structure !== "personal" && cachedAccountInfo.workspace_type) {
        log("Workspace detected: " + cachedAccountInfo.workspace_type, "success");
      }
      return cachedAccountInfo;
    } catch (e) {
      log("Account detection: " + e.message);
      return null;
    }
  }

  // Extract model from conversation metadata — tries multiple field names
  function getConvoModel(c) {
    return c.default_model_slug || c.model || c.model_slug || c.gpt_model || "unknown";
  }

  // Extract timestamp from conversation — handles epoch (seconds or ms) and ISO strings
  function getConvoTime(c) {
    var raw = c.update_time || c.updated_at || c.create_time || c.created_at || 0;
    if (!raw) return 0;
    if (typeof raw === "string") {
      // ISO date string
      var parsed = new Date(raw).getTime() / 1000;
      return isNaN(parsed) ? 0 : parsed;
    }
    // Epoch: if > 1e12 it's milliseconds, convert to seconds
    if (raw > 1e12) return raw / 1000;
    return raw;
  }

  // ========== EXPORT: MEMORIES ==========
  async function exportMemories() {
    var btn = document.getElementById("g2c-btn-memory");
    setButtonState(btn, "running", "Exporting...");

    try {
      var token = await getToken();

      log("Fetching memories...");
      var resp = await fetch("https://chatgpt.com/backend-api/memories?include_memory_entries=true", {
        credentials: "include",
        headers: {"Authorization": "Bearer " + token}
      });

      if (resp.status !== 200) {
        throw new Error("Could not fetch memories (HTTP " + resp.status + ")");
      }

      var data = await resp.json();
      var memories = data.memories || data.results || data;
      var md = "# ChatGPT Memory Export\n";
      md += "# Exported: " + new Date().toISOString() + "\n";
      md += "# Tool: GPT2Claude Migration Kit v2.4\n";
      if (data.memory_num_tokens) md += "# Tokens used: " + data.memory_num_tokens + " / " + (data.memory_max_tokens || "?") + "\n";
      md += "\n";

      var count = 0;
      var warmCount = 0;
      var coldCount = 0;
      if (Array.isArray(memories)) {
        count = memories.length;
        // Sort: warm first, then cold
        memories.sort(function(a, b) {
          if (a.status === "warm" && b.status !== "warm") return -1;
          if (a.status !== "warm" && b.status === "warm") return 1;
          return 0;
        });
        for (var i = 0; i < memories.length; i++) {
          var m = memories[i];
          var content = m.content || m.value || m.text || m.memory || JSON.stringify(m);
          var status = m.status || "unknown";
          if (status === "warm") warmCount++;
          else if (status === "cold") coldCount++;
          var tag = status === "cold" ? " [older/less relevant]" : "";
          md += (i + 1) + ". " + content + tag + "\n";
        }
      } else {
        md += JSON.stringify(memories, null, 2);
      }

      var summary = count + " memories (" + warmCount + " active" + (coldCount > 0 ? ", " + coldCount + " older" : "") + ")";
      log("Found " + summary);
      downloadFile(md, "chatgpt_memories.md", "text/markdown");
      setButtonState(btn, "done", summary);

    } catch (err) {
      log("Memory export failed: " + err.message, "error");
      setButtonState(btn, "error", err.message);
    }
  }

  // ========== EXPORT: CONVERSATIONS ==========
  var scannedConvos = [];
  var previousExportIds = {};
  var BATCH_SIZE = 10;

  async function exportConversations() {
    var btn = document.getElementById("g2c-btn-convos");
    setButtonState(btn, "running", "Scanning...");

    // Show indeterminate progress
    var progressEl = document.getElementById("g2c-progress");
    progressEl.style.display = "block";
    var fillEl = document.getElementById("g2c-progress-fill");
    fillEl.classList.add("indeterminate");
    fillEl.style.width = "100%";

    // Insert scan hero display (State 2)
    var scanHero = document.createElement("div");
    scanHero.className = "g2c-scan-hero";
    scanHero.id = "g2c-scan-hero";
    scanHero.innerHTML = '<div class="g2c-scan-count" id="g2c-scan-count">0</div>' +
      '<div class="g2c-scan-label">conversations found</div>' +
      '<div class="g2c-scan-status" id="g2c-scan-status">' +
        '<span class="g2c-scan-dots"><span></span><span></span><span></span></span>' +
        ' Scanning your conversations\u2026' +
      '</div>' +
      '<div class="g2c-scan-models" id="g2c-scan-models"></div>' +
      '<div class="g2c-scan-reassure">Filter options appear when scan completes</div>';
    progressEl.parentNode.insertBefore(scanHero, progressEl.nextSibling);

    try {
      var token = await getToken();
      var headers = {"Authorization": "Bearer " + token};
      scannedConvos = [];
      var offset = 0;
      var liveModels = {};
      var scanLimit = 100;

      log("Scanning conversation list...");

      while (true) {
        var listResp = await fetch(
          "https://chatgpt.com/backend-api/conversations?offset=" + offset + "&limit=" + scanLimit + "&order=updated",
          {credentials: "include", headers: headers}
        );

        if (listResp.status !== 200) {
          throw new Error("Could not get conversations (HTTP " + listResp.status + ")");
        }

        var listData = await listResp.json();
        var items = listData.items || [];
        log("Batch: " + items.length + " conversations (offset " + offset + ")");

        // Log first item's keys for diagnostics
        if (offset === 0 && items.length > 0) {
          var sampleKeys = Object.keys(items[0]).join(", ");
          log("API fields: " + sampleKeys);
          var sample = items[0];
          log("Sample model: " + (sample.default_model_slug || sample.model || sample.model_slug || "null"));
          log("Sample time: update=" + sample.update_time + " create=" + sample.create_time);
          log("Sample gizmo: " + (sample.gizmo_id || sample.conversation_template_id || sample.workspace_id || "none"));
        }

        for (var j = 0; j < items.length; j++) {
          scannedConvos.push(items[j]);
          var m = getConvoModel(items[j]);
          liveModels[m] = (liveModels[m] || 0) + 1;
        }

        // Update scan hero display
        var countEl = document.getElementById("g2c-scan-count");
        var statusEl = document.getElementById("g2c-scan-status");
        if (countEl) countEl.textContent = scannedConvos.length.toLocaleString();
        if (statusEl) {
          statusEl.innerHTML = items.length >= scanLimit
            ? '<span class="g2c-scan-dots"><span></span><span></span><span></span></span> Still scanning \u2014 this takes a minute, all good'
            : 'Scan complete!';
        }

        // Update model tags
        var tagsHtml = "";
        var modelKeys = Object.keys(liveModels).sort(function(a, b) { return liveModels[b] - liveModels[a]; });
        for (var mi = 0; mi < modelKeys.length; mi++) {
          tagsHtml += '<span class="g2c-scan-tag">' + modelKeys[mi] + ' (' + liveModels[modelKeys[mi]] + ')</span>';
        }
        var modelsEl = document.getElementById("g2c-scan-models");
        if (modelsEl) modelsEl.innerHTML = tagsHtml;

        offset += items.length;
        if (items.length < scanLimit) break;
        await new Promise(function(r) { setTimeout(r, 500); });
      }

      log("Total conversations: " + scannedConvos.length);

      // Discover and fetch project conversations via sidebar DOM scraping
      try {
        log("Checking for projects...");
        var statusEl = document.getElementById("g2c-scan-status");
        if (statusEl) statusEl.innerHTML = '<span class="g2c-scan-dots"><span></span><span></span><span></span></span> Checking projects\u2026';

        var discoveredProjects = {};

        // Method 1: Check conversation items for gizmo_id (project conversations have this)
        for (var gi = 0; gi < scannedConvos.length; gi++) {
          var gid = scannedConvos[gi].gizmo_id || scannedConvos[gi].conversation_template_id || scannedConvos[gi].workspace_id || null;
          if (gid && gid.indexOf("g-p-") === 0 && !discoveredProjects[gid]) {
            discoveredProjects[gid] = null; // name unknown yet
            log("Found project gizmo in conversation list: " + gid);
          }
        }

        // Method 2: Try API endpoint for user's gizmos/projects
        try {
          var gizmoResp = await fetch(
            "https://chatgpt.com/backend-api/gizmos/discovery/mine",
            {credentials: "include", headers: headers}
          );
          if (gizmoResp.status === 200) {
            var gizmoData = await gizmoResp.json();
            var gizmoItems = gizmoData.list || gizmoData.items || gizmoData.gizmos || [];
            if (Array.isArray(gizmoItems)) {
              for (var gmi = 0; gmi < gizmoItems.length; gmi++) {
                var gizmo = gizmoItems[gmi].resource || gizmoItems[gmi].gizmo || gizmoItems[gmi];
                var gizmoId = gizmo.id || gizmo.short_url || "";
                if (gizmoId.indexOf("g-p-") === 0 || (gizmo.type && gizmo.type === "project")) {
                  var gName = (gizmo.display && gizmo.display.name) || gizmo.name || gizmo.title || "Project";
                  discoveredProjects[gizmoId] = gName;
                  log("Found project via API: " + gName + " (" + gizmoId + ")");
                }
              }
            }
          } else {
            log("Gizmos API: HTTP " + gizmoResp.status + " (trying other methods)");
          }
        } catch (apiErr) {
          log("Gizmos API failed: " + apiErr.message + " (trying other methods)");
        }

        // Method 3: DOM scraping fallback — scan sidebar for project links
        var projLinks = document.querySelectorAll('a[href*="/g/g-p-"]');
        for (var pl = 0; pl < projLinks.length; pl++) {
          var href = projLinks[pl].getAttribute("href") || "";
          var idMatch = href.match(/g-p-[a-f0-9]+/);
          if (!idMatch) continue;
          var projId = idMatch[0];
          if (discoveredProjects[projId]) continue;
          var slugMatch = href.match(/g-p-[a-f0-9]+-([^/]+)/);
          var linkText = projLinks[pl].textContent.trim();
          var projName = linkText || (slugMatch ? slugMatch[1].replace(/-/g, " ") : "Project");
          if (href.indexOf("/c/") > -1) continue;
          discoveredProjects[projId] = projName;
          log("Found project via DOM: " + projName + " (" + projId + ")");
        }

        var projIds = Object.keys(discoveredProjects);
        if (projIds.length > 0) {
          log("Found " + projIds.length + " project(s) total");

          // Build index of existing conversation IDs for deduplication
          var existingIdx = {};
          for (var ei = 0; ei < scannedConvos.length; ei++) {
            existingIdx[scannedConvos[ei].id] = ei;
          }

          for (var pi = 0; pi < projIds.length; pi++) {
            var projId = projIds[pi];
            var projName = discoveredProjects[projId] || "Project";

            // Try to resolve project name if unknown
            if (projName === "Project" || projName === null) {
              try {
                var infoResp = await fetch(
                  "https://chatgpt.com/backend-api/gizmos/" + projId,
                  {credentials: "include", headers: headers}
                );
                if (infoResp.status === 200) {
                  var infoData = await infoResp.json();
                  var gizmoInfo = infoData.gizmo || infoData;
                  projName = (gizmoInfo.display && gizmoInfo.display.name) || gizmoInfo.name || gizmoInfo.title || "Project";
                  log("Resolved project name: " + projName);
                }
              } catch (nameErr) {
                // keep default name
              }
            }

            log("Fetching project: " + projName + " (" + projId + ")");
            var statusEl = document.getElementById("g2c-scan-status");
            if (statusEl) statusEl.innerHTML = '<span class="g2c-scan-dots"><span></span><span></span><span></span></span> Scanning project: ' + projName + '\u2026';

            var cursor = 0;
            var projConvoCount = 0;
            var projTaggedCount = 0;
            while (true) {
              var projConvoResp = await fetch(
                "https://chatgpt.com/backend-api/gizmos/" + projId + "/conversations?cursor=" + cursor,
                {credentials: "include", headers: headers}
              );
              if (projConvoResp.status !== 200) {
                log("Project " + projName + ": HTTP " + projConvoResp.status, "error");
                break;
              }
              var projConvoData = await projConvoResp.json();
              var projItems = projConvoData.items || [];
              for (var pj = 0; pj < projItems.length; pj++) {
                projItems[pj]._project = projName;
                projItems[pj]._project_id = projId;
                // Only add if not already in main scan (deduplicate)
                if (existingIdx[projItems[pj].id] === undefined) {
                  scannedConvos.push(projItems[pj]);
                  existingIdx[projItems[pj].id] = scannedConvos.length - 1;
                  projConvoCount++;
                } else {
                  // Tag the existing entry as belonging to this project
                  var dupIdx = existingIdx[projItems[pj].id];
                  scannedConvos[dupIdx]._project = projName;
                  scannedConvos[dupIdx]._project_id = projId;
                  projTaggedCount++;
                }
              }
              var countEl = document.getElementById("g2c-scan-count");
              if (countEl) countEl.textContent = scannedConvos.length.toLocaleString();

              // Cursor-based pagination: null cursor means no more pages
              if (projConvoData.cursor === null || projConvoData.cursor === undefined || projItems.length === 0) break;
              cursor = projConvoData.cursor;
              await new Promise(function(r) { setTimeout(r, 500); });
            }
            log("Project " + projName + ": " + projConvoCount + " new, " + projTaggedCount + " tagged");
          }
          log("Total with projects: " + scannedConvos.length);
        } else {
          log("No projects found");
        }
      } catch (projErr) {
        log("Projects check failed: " + projErr.message + " (continuing without)");
      }

      // Discover shared conversations
      try {
        log("Checking shared conversations...");
        var statusEl = document.getElementById("g2c-scan-status");
        if (statusEl) statusEl.innerHTML = '<span class="g2c-scan-dots"><span></span><span></span><span></span></span> Checking shared conversations\u2026';

        var sharedResp = await fetch(
          "https://chatgpt.com/backend-api/shared_conversations?order=updated&limit=100&offset=0",
          {credentials: "include", headers: headers}
        );

        if (sharedResp.status === 200) {
          var sharedData = await sharedResp.json();
          var sharedItems = sharedData.items || [];
          var totalShared = sharedItems.length;

          // Paginate if more
          var sharedOffset = sharedItems.length;
          while (sharedItems.length >= 100) {
            var moreResp = await fetch(
              "https://chatgpt.com/backend-api/shared_conversations?order=updated&limit=100&offset=" + sharedOffset,
              {credentials: "include", headers: headers}
            );
            if (moreResp.status !== 200) break;
            var moreData = await moreResp.json();
            var moreItems = moreData.items || [];
            if (moreItems.length === 0) break;
            for (var mi = 0; mi < moreItems.length; mi++) sharedItems.push(moreItems[mi]);
            sharedOffset += moreItems.length;
            totalShared = sharedItems.length;
            await new Promise(function(r) { setTimeout(r, 500); });
          }

          // Build index of existing conversation IDs for deduplication
          var existingIds = {};
          for (var ei = 0; ei < scannedConvos.length; ei++) {
            existingIds[scannedConvos[ei].id] = true;
          }

          var newShared = 0;
          for (var si = 0; si < sharedItems.length; si++) {
            var shared = sharedItems[si];
            // Shared items might have conversation_id linking to a regular conversation
            var sharedConvoId = shared.conversation_id || shared.id;
            if (existingIds[sharedConvoId]) {
              // Already in main list — tag it as shared but don't duplicate
              for (var ti = 0; ti < scannedConvos.length; ti++) {
                if (scannedConvos[ti].id === sharedConvoId) {
                  scannedConvos[ti]._also_shared = true;
                  scannedConvos[ti]._share_id = shared.share_id || shared.id;
                  break;
                }
              }
            } else {
              // New shared conversation — add to scan list
              shared._shared = true;
              shared._share_id = shared.share_id || shared.id;
              if (!shared.title) shared.title = shared.title || "Shared conversation";
              scannedConvos.push(shared);
              newShared++;
            }
          }

          if (totalShared > 0) {
            log("Shared conversations: " + totalShared + " found (" + newShared + " unique)");
          } else {
            log("No shared conversations");
          }

          var countEl = document.getElementById("g2c-scan-count");
          if (countEl) countEl.textContent = scannedConvos.length.toLocaleString();
        } else if (sharedResp.status !== 404) {
          log("Shared conversations: HTTP " + sharedResp.status + " (skipped)");
        } else {
          log("No shared conversations");
        }
      } catch (sharedErr) {
        log("Shared conversations check: " + sharedErr.message + " (continuing without)");
      }

      // Show filter panel
      setButtonState(btn, "done", scannedConvos.length + " conversations found");

      // Clean up scan hero display
      var scanHeroEl = document.getElementById("g2c-scan-hero");
      if (scanHeroEl) scanHeroEl.parentNode.removeChild(scanHeroEl);
      var fillEl = document.getElementById("g2c-progress-fill");
      fillEl.classList.remove("indeterminate");
      fillEl.style.width = "0%";
      document.getElementById("g2c-progress").style.display = "none";

      showFilterPanel();

    } catch (err) {
      log("Scan failed: " + err.message, "error");
      setButtonState(btn, "error", err.message);
    }
  }

  // ========== FILTER PANEL (State 3) ==========
  function showFilterPanel() {
    var models = {};
    var oldest = Infinity;
    var newest = 0;
    var sources = {}; // Track main vs project conversations
    for (var i = 0; i < scannedConvos.length; i++) {
      var c = scannedConvos[i];
      var m = getConvoModel(c);
      models[m] = (models[m] || 0) + 1;
      var t = getConvoTime(c);
      if (t > 0 && t < oldest) oldest = t;
      if (t > 0 && t > newest) newest = t;
      // Track source
      var src = c._shared ? "Shared conversations" : (c._project || "Main conversations");
      sources[src] = (sources[src] || 0) + 1;
    }
    var modelKeys = Object.keys(models).sort(function(a, b) { return models[b] - models[a]; });

    function tsToDate(ts) {
      if (!ts || ts === Infinity) return "";
      if (typeof ts === "string") {
        // ISO string — just extract the date part
        var d = new Date(ts);
        if (isNaN(d.getTime())) return "";
        return d.toISOString().slice(0, 10);
      }
      var d = new Date(ts > 1e12 ? ts : ts * 1000);
      if (isNaN(d.getTime())) return "";
      return d.toISOString().slice(0, 10);
    }

    var modelCheckboxes = "";
    for (var i = 0; i < modelKeys.length; i++) {
      var mk = modelKeys[i];
      modelCheckboxes += '<label class="g2c-model-row"><input type="checkbox" checked data-model="' + mk + '"> ' + mk + '<span class="cnt">' + models[mk] + '</span></label>';
    }

    // Build source/project checkboxes
    var sourceKeys = Object.keys(sources).sort(function(a, b) {
      if (a === "Main conversations") return -1;
      if (b === "Main conversations") return 1;
      return sources[b] - sources[a];
    });
    var sourceCheckboxes = "";
    var hasProjects = sourceKeys.length > 1;
    for (var si = 0; si < sourceKeys.length; si++) {
      var sk = sourceKeys[si];
      var icon = sk === "Main conversations" ? "\uD83D\uDCAC" : (sk === "Shared conversations" ? "\uD83D\uDD17" : "\uD83D\uDCC1");
      sourceCheckboxes += '<label class="g2c-model-row"><input type="checkbox" checked data-source="' + sk + '"> ' + icon + ' ' + sk + '<span class="cnt">' + sources[sk] + '</span></label>';
    }

    // Scan summary — show project breakdown if applicable
    var projCount = sourceKeys.length - 1;
    var projConvoCount = scannedConvos.filter(function(c) { return c._project; }).length;
    var mainCount = scannedConvos.length - projConvoCount;
    var scanSummaryText = scannedConvos.length.toLocaleString() + '</span>' +
      '<span style="font-size:12px;color:#888;"> conversations scanned</span>';
    if (projCount > 0) {
      scanSummaryText += '<div style="font-size:11px;color:#7eb8a0;margin-top:4px;">' +
        mainCount.toLocaleString() + ' main + ' + projConvoCount + ' from ' + projCount + ' project' + (projCount > 1 ? 's' : '') + '</div>';
    }
    var scanSummary = '<div style="text-align:center;margin-bottom:14px;">' +
      '<span style="font-size:28px;font-weight:800;color:#7eb8a0;">' + scanSummaryText +
      '</div>';

    // Determine if model filter is useful (not just "unknown")
    var hasRealModels = modelKeys.length > 1 || (modelKeys.length === 1 && modelKeys[0] !== "unknown");

    var modelSection = '';
    if (hasRealModels) {
      modelSection = '\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Models</div>\
          <div class="g2c-filter-models" id="g2c-filter-models">' + modelCheckboxes + '</div>\
          <div class="g2c-select-btns"><button id="g2c-sel-all">Select all</button> \u00B7 <button id="g2c-sel-none">Select none</button></div>\
        </div>';
    }

    var filterHtml = '\
      <div class="g2c-filter-panel" id="g2c-filter-panel">\
        ' + scanSummary + '\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Search conversations</div>\
          <input type="text" class="g2c-filter-input" id="g2c-search" placeholder="Filter by title\u2026" style="width:100%;">\
          <div style="font-size:10px;color:#555;margin-top:3px;">Filters by conversation title. Leave empty = all.</div>\
        </div>\
        ' + (hasProjects ? '\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Source</div>\
          <div class="g2c-filter-models" id="g2c-filter-sources">' + sourceCheckboxes + '</div>\
        </div>' : '') + '\
        ' + modelSection + '\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Date range</div>\
          <div class="g2c-filter-row">\
            <input type="date" class="g2c-filter-input" id="g2c-date-from" value="' + tsToDate(oldest) + '">\
            <span style="color:#555;">\u2192</span>\
            <input type="date" class="g2c-filter-input" id="g2c-date-to" value="' + tsToDate(newest) + '">\
          </div>\
          <div class="g2c-select-btns" id="g2c-era-btns" style="flex-wrap:wrap;margin-top:4px;">\
            <button data-era="all">All</button> \u00B7\
            <button data-era="gpt35">GPT-3.5</button> \u00B7\
            <button data-era="gpt4">GPT-4</button> \u00B7\
            <button data-era="gpt4o">GPT-4o</button> \u00B7\
            <button data-era="gpt5">GPT-5+</button>\
          </div>\
        </div>\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Max conversations (0 = all)</div>\
          <input type="number" class="g2c-filter-input" id="g2c-limit" value="0" min="0" style="width:100%;">\
        </div>\
        <div class="g2c-filter-section">\
          <div class="g2c-filter-label">Incremental export (skip already exported)</div>\
          <div class="g2c-filter-drop" id="g2c-prev-drop">Drop or click to load previous export</div>\
          <input type="file" id="g2c-prev-file" accept=".json" style="display:none;">\
        </div>\
        <div class="g2c-filter-summary" id="g2c-filter-summary">' + scannedConvos.length + ' conversations selected</div>\
        <button class="g2c-btn" id="g2c-btn-download" style="border-color:#d4a574;margin-bottom:0;">\
          <div class="g2c-btn-icon">\uD83D\uDCE5</div>\
          <div class="g2c-btn-text"><span style="color:#d4a574;">Download ' + scannedConvos.length + ' conversations</span>\
            <div class="g2c-btn-sub">~' + estimateTime(scannedConvos.length) + '</div>\
          </div>\
        </button>\
      </div>';

    // Insert filter panel — with fallback for SPA DOM issues
    var bodyEl = panel.querySelector(".g2c-body");
    if (!bodyEl) {
      log("Warning: panel body not found", "error");
      return;
    }
    var progressEl = document.getElementById("g2c-progress");
    var filterDiv = document.createElement("div");
    filterDiv.innerHTML = filterHtml;
    var filterPanel = filterDiv.firstElementChild || filterDiv.firstChild;
    if (progressEl && progressEl.parentNode) {
      progressEl.parentNode.insertBefore(filterPanel, progressEl);
    } else {
      bodyEl.appendChild(filterPanel);
    }

    // Hide the main buttons — with null guards
    var hideIds = ["g2c-btn-memory", "g2c-btn-convos", "g2c-btn-instructions", "g2c-btn-all", "g2c-camera-divider", "g2c-camera-row", "g2c-camera-note"];
    for (var hi = 0; hi < hideIds.length; hi++) {
      var hideEl = document.getElementById(hideIds[hi]);
      if (hideEl) hideEl.style.display = "none";
    }

    // Wire up events using safeAddEvent (BUG FIX)
    if (hasRealModels) {
      safeAddEvent("g2c-sel-all", "click", function() {
        var boxes = document.querySelectorAll("#g2c-filter-models input");
        for (var i = 0; i < boxes.length; i++) boxes[i].checked = true;
        updateFilterSummary();
      });
      safeAddEvent("g2c-sel-none", "click", function() {
        var boxes = document.querySelectorAll("#g2c-filter-models input");
        for (var i = 0; i < boxes.length; i++) boxes[i].checked = false;
        updateFilterSummary();
      });
    }

    safeAddEvent("g2c-prev-drop", "click", function() {
      var fileInput = document.getElementById("g2c-prev-file");
      if (fileInput) fileInput.click();
    });

    var filterInputs = document.querySelectorAll("#g2c-filter-models input, #g2c-filter-sources input, #g2c-date-from, #g2c-date-to, #g2c-limit");
    for (var fi = 0; fi < filterInputs.length; fi++) {
      filterInputs[fi].addEventListener("change", updateFilterSummary);
    }
    // Search box — live filtering as you type
    var searchInput = document.getElementById("g2c-search");
    if (searchInput) searchInput.addEventListener("input", updateFilterSummary);

    // Era preset buttons
    var eraRanges = {
      "all": [tsToDate(oldest), tsToDate(newest)],
      "gpt35": ["2022-11-30", "2023-03-13"],
      "gpt4": ["2023-03-14", "2024-05-12"],
      "gpt4o": ["2024-05-13", "2025-08-06"],
      "gpt5": ["2025-08-07", tsToDate(newest)]
    };
    var eraBtns = document.querySelectorAll("#g2c-era-btns button");
    for (var ei = 0; ei < eraBtns.length; ei++) {
      eraBtns[ei].addEventListener("click", function() {
        var era = this.getAttribute("data-era");
        var range = eraRanges[era];
        if (range) {
          var fromEl = document.getElementById("g2c-date-from");
          var toEl = document.getElementById("g2c-date-to");
          if (fromEl) fromEl.value = range[0];
          if (toEl) toEl.value = range[1];
          // Highlight active era button
          var siblings = document.querySelectorAll("#g2c-era-btns button");
          for (var si = 0; si < siblings.length; si++) siblings[si].style.color = "";
          this.style.color = "#d4a574";
          updateFilterSummary();
        }
      });
    }

    safeAddEvent("g2c-prev-file", "change", function() {
      if (this.files.length) loadPreviousExport(this.files[0]);
    });
    var dropEl = document.getElementById("g2c-prev-drop");
    if (dropEl) {
      dropEl.addEventListener("dragover", function(e) { e.preventDefault(); this.style.borderColor = "#d4a574"; });
      dropEl.addEventListener("dragleave", function() { this.style.borderColor = ""; });
      dropEl.addEventListener("drop", function(e) {
        e.preventDefault();
        this.style.borderColor = "";
        if (e.dataTransfer.files.length) loadPreviousExport(e.dataTransfer.files[0]);
      });
    }

    safeAddEvent("g2c-btn-download", "click", startFilteredDownload);

    // Ensure all model and source checkboxes are programmatically checked (defensive)
    var allBoxes = document.querySelectorAll("#g2c-filter-models input, #g2c-filter-sources input");
    for (var bi = 0; bi < allBoxes.length; bi++) allBoxes[bi].checked = true;

    // Force-recalculate summary after DOM is fully wired
    updateFilterSummary();
  }

  function estimateTime(count) {
    // Real-world calibration: 3361 convos = 29m34s = ~5.3s per batch of 10
    // Using 5s per batch as conservative estimate
    var secs = Math.ceil(count / BATCH_SIZE) * 5;
    if (secs < 60) return "~" + Math.max(Math.round(secs), 1) + " seconds";
    var mins = Math.round(secs / 60);
    if (mins < 60) return "~" + mins + " minutes";
    var hrs = (secs / 3600).toFixed(1);
    return "~" + hrs + " hours";
  }

  function getFilteredConvos() {
    try {
      var selectedModels = {};
      var boxes = document.querySelectorAll("#g2c-filter-models input");
      for (var i = 0; i < boxes.length; i++) {
        if (boxes[i].checked) selectedModels[boxes[i].getAttribute("data-model")] = true;
      }

      // Source/project filter
      var selectedSources = {};
      var sourceBoxes = document.querySelectorAll("#g2c-filter-sources input");
      for (var si = 0; si < sourceBoxes.length; si++) {
        if (sourceBoxes[si].checked) selectedSources[sourceBoxes[si].getAttribute("data-source")] = true;
      }
      var hasSourceFilter = sourceBoxes.length > 0 && Object.keys(selectedSources).length > 0;

      // If no models selected, return all (fail-open)
      var hasModelFilter = Object.keys(selectedModels).length > 0;

      var fromEl = document.getElementById("g2c-date-from");
      var toEl = document.getElementById("g2c-date-to");
      var limitEl = document.getElementById("g2c-limit");

      var fromStr = fromEl ? fromEl.value : "";
      var toStr = toEl ? toEl.value : "";
      var fromTs = fromStr ? new Date(fromStr + "T00:00:00").getTime() / 1000 : 0;
      var toTs = toStr ? new Date(toStr + "T23:59:59").getTime() / 1000 : Infinity;

      var limit = limitEl ? (parseInt(limitEl.value) || 0) : 0;

      // Search filter — client-side title matching
      var searchEl = document.getElementById("g2c-search");
      var searchText = searchEl ? searchEl.value.trim().toLowerCase() : "";

      var filtered = [];
      var mainCount = 0;
      for (var i = 0; i < scannedConvos.length; i++) {
        var c = scannedConvos[i];

        // Search filter — match against title
        if (searchText) {
          var title = (c.title || "").toLowerCase();
          if (title.indexOf(searchText) === -1) continue;
        }

        // Source filter
        if (hasSourceFilter) {
          var src = c._shared ? "Shared conversations" : (c._project || "Main conversations");
          if (!selectedSources[src]) continue;
        }

        var model = getConvoModel(c);
        if (hasModelFilter && !selectedModels[model]) continue;

        var ts = getConvoTime(c);
        if (ts > 0 && (ts < fromTs || ts > toTs)) continue;

        if (previousExportIds[c.id]) continue;

        // Limit only applies to main conversations — project convos always included
        if (!c._project) {
          if (limit > 0 && mainCount >= limit) continue;
          mainCount++;
        }

        filtered.push(c);
      }
      return filtered;
    } catch (err) {
      log("Filter error: " + err.message, "error");
      return scannedConvos; // fail-open: return all
    }
  }

  function updateFilterSummary() {
    var filtered = getFilteredConvos();
    var summary = document.getElementById("g2c-filter-summary");
    var dlBtn = document.getElementById("g2c-btn-download");
    var skipped = Object.keys(previousExportIds).length;
    var text = filtered.length + " conversations selected";
    if (skipped > 0) text += " (" + skipped + " skipped from previous export)";
    if (summary) summary.textContent = text;
    if (dlBtn) {
      var spanEl = dlBtn.querySelector(".g2c-btn-text span");
      if (spanEl) spanEl.textContent = "Download " + filtered.length + " conversations";
      var subEl = dlBtn.querySelector(".g2c-btn-sub");
      if (subEl) subEl.textContent = estimateTime(filtered.length);
    }
  }

  function loadPreviousExport(file) {
    var dropEl = document.getElementById("g2c-prev-drop");
    if (dropEl) dropEl.textContent = "Loading " + file.name + "...";
    var reader = new FileReader();
    reader.onload = function(e) {
      try {
        var data = JSON.parse(e.target.result);
        var convos = data.conversations || data || [];
        if (Array.isArray(convos)) {
          previousExportIds = {};
          for (var i = 0; i < convos.length; i++) {
            if (convos[i].id) previousExportIds[convos[i].id] = true;
          }
          if (dropEl) {
            dropEl.textContent = "\u2705 " + Object.keys(previousExportIds).length + " conversations from previous export";
            dropEl.className = "g2c-filter-drop active";
          }
          log("Loaded previous export: " + Object.keys(previousExportIds).length + " conversation IDs");
          updateFilterSummary();
        }
      } catch (err) {
        if (dropEl) dropEl.textContent = "\u274C Could not parse file";
        log("Previous export error: " + err.message, "error");
      }
    };
    reader.readAsText(file);
  }

  // ========== CONVERSATION PROCESSING HELPERS ==========
  function extractNodeText(node) {
    if (!node || !node.message || !node.message.content) return "";
    var content = node.message.content;

    // Handle special content types at the top level
    var ct = content.content_type;
    if (ct === "model_editable_context") return ""; // system memory, skip
    if (ct === "thoughts") {
      // Reasoning model thinking block — OpenAI hides actual CoT
      return "[thinking]";
    }
    if (ct === "reasoning_recap") {
      // "Thought for a few seconds" etc
      return "[" + (content.content || "Thinking...") + "]";
    }
    if (ct === "code" || ct === "execution_output") {
      var lang = content.language || "";
      var codeText = content.text || "";
      if (lang === "unknown" && codeText.indexOf("search(") === 0) {
        return "[\uD83D\uDD0D " + codeText + "]";
      }
      return "```" + lang + "\n" + codeText + "\n```";
    }

    var parts = content.parts;
    if (!Array.isArray(parts)) return JSON.stringify(content);
    var textParts = [];
    for (var p = 0; p < parts.length; p++) {
      if (typeof parts[p] === "string") {
        textParts.push(parts[p]);
      } else if (parts[p] && typeof parts[p] === "object") {
        if (parts[p].content_type === "image_asset_pointer" || parts[p].asset_pointer) {
          var imgName = (parts[p].metadata && parts[p].metadata.dalle && parts[p].metadata.dalle.prompt)
            ? "DALL-E: " + parts[p].metadata.dalle.prompt : "image";
          textParts.push("[\uD83D\uDDBC " + imgName + "]");
        }
      }
    }
    return textParts.join("\n")
      .replace(/\uE200cite(\uE202turn\dsearch\d+)+\uE201/g, "")
      .replace(/\uE200image_group\uE202\{[^}]*\}\uE201/g, "[🖼 images]")
      .replace(/\uE200[\s\S]*?\uE201/g, "");
  }

  function extractNodeRole(node) {
    return (node.message && node.message.author && node.message.author.role) || "unknown";
  }

  function extractNodeModel(node) {
    return (node.message && node.message.metadata && node.message.metadata.model_slug) || null;
  }

  function extractNodeTime(node) {
    return (node.message && node.message.create_time) || null;
  }

  function processConversationDetail(detail, listItem) {
    var messages = [];
    var hasBranches = false;

    if (detail.mapping) {
      var mapKeys = Object.keys(detail.mapping);
      var rootId = null;
      for (var mk = 0; mk < mapKeys.length; mk++) {
        if (!detail.mapping[mapKeys[mk]].parent) {
          rootId = mapKeys[mk];
          break;
        }
      }
      if (!rootId) rootId = mapKeys[0];

      var current = rootId;
      var visited = {};
      var safety = 0;

      while (current && safety < 50000) {
        safety++;
        if (visited[current]) break;
        visited[current] = true;
        var node = detail.mapping[current];
        if (!node) break;

        if (node.message && node.message.content) {
          var text = extractNodeText(node);
          if (text.trim() !== "") {
            var msgObj = {
              role: extractNodeRole(node),
              content: text,
              timestamp: extractNodeTime(node),
              model: extractNodeModel(node)
            };

            if (node.parent && detail.mapping[node.parent]) {
              var parentNode = detail.mapping[node.parent];
              if (parentNode.children && parentNode.children.length > 1) {
                var alts = [];
                for (var ci = 0; ci < parentNode.children.length; ci++) {
                  var sibId = parentNode.children[ci];
                  if (sibId === current) continue;
                  var sib = detail.mapping[sibId];
                  if (sib && sib.message && sib.message.content) {
                    var sibText = extractNodeText(sib);
                    if (sibText.trim()) {
                      alts.push({
                        content: sibText,
                        role: extractNodeRole(sib),
                        timestamp: extractNodeTime(sib),
                        model: extractNodeModel(sib)
                      });
                    }
                  }
                }
                if (alts.length > 0) {
                  msgObj.alternatives = alts;
                  hasBranches = true;
                }
              }
            }

            messages.push(msgObj);
          }
        }

        if (node.children && node.children.length > 0) {
          current = node.children[node.children.length - 1];
        } else {
          break;
        }
      }
    }

    // Extract model from mapping metadata (since list API no longer provides it)
    var model = detail.default_model_slug || null;
    if (!model && detail.mapping) {
      var mKeys = Object.keys(detail.mapping);
      for (var mi = 0; mi < mKeys.length; mi++) {
        var mNode = detail.mapping[mKeys[mi]];
        if (mNode && mNode.message && mNode.message.metadata && mNode.message.metadata.model_slug) {
          model = mNode.message.metadata.model_slug;
          break;
        }
      }
    }

    return {
      id: detail.conversation_id || (listItem && listItem.id) || detail.id,
      title: detail.title || (listItem && listItem.title) || "Untitled",
      create_time: detail.create_time || (listItem && listItem.create_time) || null,
      update_time: detail.update_time || (listItem && listItem.update_time) || null,
      model: model,
      project: (listItem && listItem._project) || null,
      project_id: (listItem && listItem._project_id) || null,
      memory_scope: (listItem && listItem.memory_scope) || null,
      is_do_not_remember: (listItem && listItem.is_do_not_remember) || false,
      has_branches: hasBranches,
      message_count: messages.length,
      messages: messages
    };
  }

  // ========== FILTERED DOWNLOAD (States 4 & 5) ==========

  function updateDlUI(completed, total, title, startTime) {
    var pct = Math.round((completed / total) * 100);
    var remaining = total - completed;

    var dlCount = document.getElementById("g2c-dl-count");
    var dlTitle = document.getElementById("g2c-dl-title");
    var dlFill = document.getElementById("g2c-dl-fill");
    var dlPct = document.getElementById("g2c-dl-pct");
    var dlRemaining = document.getElementById("g2c-dl-remaining");
    var dlMode = document.getElementById("g2c-dl-mode");

    if (dlCount) dlCount.textContent = completed;
    if (dlTitle) dlTitle.textContent = title;
    if (dlFill) dlFill.style.width = pct + "%";
    if (dlPct) dlPct.textContent = pct + "%";

    if (dlRemaining && completed > 0) {
      var elapsed = (Date.now() - startTime) / 1000;
      var perItem = elapsed / completed;
      var secsLeft = Math.round(perItem * remaining);
      if (secsLeft < 60) {
        dlRemaining.textContent = "~" + secsLeft + " seconds remaining";
      } else {
        dlRemaining.textContent = "~" + Math.round(secsLeft / 60) + " minutes remaining";
      }
    }
  }

  async function downloadBatch(ids, token) {
    var resp = await fetch("https://chatgpt.com/backend-api/conversations/batch", {
      method: "POST",
      credentials: "include",
      headers: {"Authorization": "Bearer " + token, "Content-Type": "application/json"},
      body: JSON.stringify({conversation_ids: ids})
    });
    return resp;
  }

  async function downloadSingle(id, token) {
    var resp = await fetch("https://chatgpt.com/backend-api/conversation/" + id, {
      credentials: "include",
      headers: {"Authorization": "Bearer " + token}
    });
    return resp;
  }

  async function downloadShared(shareId, token) {
    var resp = await fetch("https://chatgpt.com/backend-api/share/" + shareId, {
      credentials: "include",
      headers: {"Authorization": "Bearer " + token}
    });
    return resp;
  }

  async function startFilteredDownload() {
    var filtered = getFilteredConvos();
    if (filtered.length === 0) {
      alert("No conversations selected. Adjust your filters.");
      return;
    }

    // Separate shared conversations (can't use batch endpoint)
    var regularConvos = [];
    var sharedConvos = [];
    for (var fi = 0; fi < filtered.length; fi++) {
      if (filtered[fi]._shared) {
        sharedConvos.push(filtered[fi]);
      } else {
        regularConvos.push(filtered[fi]);
      }
    }

    // Replace filter panel with download hero UI (State 4)
    var filterPanel = document.getElementById("g2c-filter-panel");
    if (filterPanel) {
      filterPanel.innerHTML = '\
        <div class="g2c-dl-hero" id="g2c-dl-hero">\
          <span class="g2c-dl-count" id="g2c-dl-count">0</span>\
          <span class="g2c-dl-of" id="g2c-dl-of"> / ' + filtered.length + '</span>\
          <div class="g2c-dl-title" id="g2c-dl-title">Starting download\u2026</div>\
        </div>\
        <div style="margin:10px 0;">\
          <div class="g2c-progress-bar"><div class="g2c-progress-fill" id="g2c-dl-fill" style="width:0%;"></div></div>\
          <div class="g2c-dl-pct" id="g2c-dl-pct">0%</div>\
        </div>\
        <div class="g2c-dl-remaining" id="g2c-dl-remaining"></div>\
        <div class="g2c-dl-mode" id="g2c-dl-mode" style="text-align:center;font-size:10px;color:#666;margin-top:4px;"></div>';
    }

    var startTime = Date.now();

    try {
      var token = await getToken();

      var fullExport = {
        export_date: new Date().toISOString(),
        tool: "GPT2Claude Migration Kit v2.4",
        format_version: 4,
        account: cachedAccountInfo || null,
        total_conversations: filtered.length,
        conversations: []
      };

      var successCount = 0;
      var errorCount = 0;
      var useBatch = true;

      // Build ID-to-listItem lookup
      var listLookup = {};
      for (var li = 0; li < filtered.length; li++) {
        listLookup[filtered[li].id] = filtered[li];
      }

      // ---- TRY BATCH MODE FIRST (regular conversations only) ----
      if (regularConvos.length > 0) {
      log("Using batch download (10 at a time)\u2026");
      var dlMode = document.getElementById("g2c-dl-mode");
      if (dlMode) dlMode.textContent = "\u26A1 Batch mode \u2014 10x faster";

      var batchIndex = 0;
      var consecutiveGroupFails = 0;
      var MAX_CONSECUTIVE_FAILS = 3;

      // Helper: download a list of IDs individually, return results
      async function downloadIndividually(items, tkn) {
        var results = [];
        for (var ii = 0; ii < items.length; ii++) {
          try {
            var resp = await downloadSingle(items[ii].id, tkn);
            if (resp.status === 429) {
              log("Rate limited, waiting 30s\u2026", "error");
              await new Promise(function(r) { setTimeout(r, 30000); });
              ii--; continue;
            }
            if (resp.status !== 200) {
              results.push({error: "HTTP " + resp.status, item: items[ii]});
              continue;
            }
            var det = await resp.json();
            results.push({detail: det, item: items[ii]});
          } catch (e) {
            results.push({error: e.message, item: items[ii]});
          }
          await new Promise(function(r) { setTimeout(r, 500); });
        }
        return results;
      }

      // Helper: try a batch, return {ok, data, status}
      async function tryBatch(ids, tkn) {
        try {
          var resp = await downloadBatch(ids, tkn);
          if (resp.status === 200) {
            var d = await resp.json();
            return {ok: true, data: d, status: 200};
          }
          return {ok: false, data: null, status: resp.status};
        } catch (e) {
          return {ok: false, data: null, status: 0, error: e.message};
        }
      }

      while (batchIndex < regularConvos.length && useBatch) {
        var batchItems = regularConvos.slice(batchIndex, batchIndex + BATCH_SIZE);
        var batchIds = [];
        for (var bi = 0; bi < batchItems.length; bi++) batchIds.push(batchItems[bi].id);

        // --- Attempt 1: full batch ---
        var result = await tryBatch(batchIds, token);

        if (result.status === 429) {
          log("Rate limited, waiting 30s\u2026", "error");
          var dlTitle = document.getElementById("g2c-dl-title");
          var dlRemaining = document.getElementById("g2c-dl-remaining");
          if (dlTitle) dlTitle.textContent = "Rate limited \u2014 waiting 30s\u2026";
          if (dlRemaining) dlRemaining.textContent = "Will resume automatically";
          await new Promise(function(r) { setTimeout(r, 30000); });
          continue; // retry same batch
        }

        if (result.status === 422 || result.status === 405 || result.status === 404) {
          log("Batch endpoint unavailable (HTTP " + result.status + "), falling back to individual downloads\u2026", "error");
          useBatch = false;
          break;
        }

        if (result.ok) {
          // Success — process batch
          consecutiveGroupFails = 0;
          var batchData = result.data;
          var batchArr = Array.isArray(batchData) ? batchData : Object.values(batchData);

          for (var bj = 0; bj < batchArr.length; bj++) {
            try {
              var detail = batchArr[bj];
              var detailId = detail.conversation_id || detail.id;
              var listItem = listLookup[detailId] || batchItems[bj];
              var processed = processConversationDetail(detail, listItem);
              fullExport.conversations.push(processed);
              successCount++;
            } catch (procErr) {
              var errTitle = (batchItems[bj] && batchItems[bj].title) || "Unknown";
              log("Error processing: " + errTitle + " \u2014 " + procErr.message, "error");
              errorCount++;
              fullExport.conversations.push({
                id: batchIds[bj],
                title: errTitle,
                error: procErr.message
              });
            }
          }

          batchIndex += BATCH_SIZE;
          await new Promise(function(r) { setTimeout(r, 500); });

        } else {
          // --- Batch failed (likely 500) — graduated retry ---
          log("Batch error (HTTP " + (result.status || result.error) + "), retrying in 3s\u2026", "error");
          if (dlMode) dlMode.textContent = "\u26A1 Retrying batch\u2026";
          await new Promise(function(r) { setTimeout(r, 3000); });

          // --- Attempt 2: retry same batch ---
          var retry = await tryBatch(batchIds, token);

          if (retry.ok) {
            consecutiveGroupFails = 0;
            var retryArr = Array.isArray(retry.data) ? retry.data : Object.values(retry.data);
            for (var rj = 0; rj < retryArr.length; rj++) {
              try {
                var det = retryArr[rj];
                var detId = det.conversation_id || det.id;
                var li = listLookup[detId] || batchItems[rj];
                fullExport.conversations.push(processConversationDetail(det, li));
                successCount++;
              } catch (e) {
                errorCount++;
                fullExport.conversations.push({id: batchIds[rj], title: (batchItems[rj] && batchItems[rj].title) || "Unknown", error: e.message});
              }
            }
            batchIndex += BATCH_SIZE;
            await new Promise(function(r) { setTimeout(r, 500); });

          } else if (batchIds.length > 1) {
            // --- Attempt 3: split batch in half ---
            log("Retry failed, splitting batch\u2026", "error");
            if (dlMode) dlMode.textContent = "\u26A1 Splitting batch\u2026";
            var mid = Math.ceil(batchIds.length / 2);
            var halfA = batchIds.slice(0, mid);
            var halfB = batchIds.slice(mid);
            var itemsA = batchItems.slice(0, mid);
            var itemsB = batchItems.slice(mid);

            var anyHalfFailed = false;
            var halves = [{ids: halfA, items: itemsA}, {ids: halfB, items: itemsB}];

            for (var hi = 0; hi < halves.length; hi++) {
              var halfResult = await tryBatch(halves[hi].ids, token);
              if (halfResult.ok) {
                var halfArr = Array.isArray(halfResult.data) ? halfResult.data : Object.values(halfResult.data);
                for (var hj = 0; hj < halfArr.length; hj++) {
                  try {
                    var hDet = halfArr[hj];
                    var hId = hDet.conversation_id || hDet.id;
                    var hLi = listLookup[hId] || halves[hi].items[hj];
                    fullExport.conversations.push(processConversationDetail(hDet, hLi));
                    successCount++;
                  } catch (e) {
                    errorCount++;
                    fullExport.conversations.push({id: halves[hi].ids[hj], title: (halves[hi].items[hj] && halves[hi].items[hj].title) || "Unknown", error: e.message});
                  }
                }
              } else {
                // Half batch also failed — download individually
                anyHalfFailed = true;
                log("Half-batch failed, downloading " + halves[hi].ids.length + " individually\u2026", "error");
                var indResults = await downloadIndividually(halves[hi].items, token);
                for (var ir = 0; ir < indResults.length; ir++) {
                  if (indResults[ir].detail) {
                    try {
                      fullExport.conversations.push(processConversationDetail(indResults[ir].detail, indResults[ir].item));
                      successCount++;
                    } catch (e) {
                      errorCount++;
                      fullExport.conversations.push({id: indResults[ir].item.id, title: indResults[ir].item.title || "Unknown", error: e.message});
                    }
                  } else {
                    errorCount++;
                    fullExport.conversations.push({id: indResults[ir].item.id, title: indResults[ir].item.title || "Unknown", error: indResults[ir].error});
                  }
                }
              }
              await new Promise(function(r) { setTimeout(r, 500); });
            }

            if (anyHalfFailed) {
              consecutiveGroupFails++;
              log("Batch group recovered individually, resuming batch mode (" + consecutiveGroupFails + "/" + MAX_CONSECUTIVE_FAILS + " fails)", "error");
            } else {
              consecutiveGroupFails = 0;
            }

            batchIndex += BATCH_SIZE;

          } else {
            // Single item batch failed — download individually
            var singleResults = await downloadIndividually(batchItems, token);
            for (var sr = 0; sr < singleResults.length; sr++) {
              if (singleResults[sr].detail) {
                try {
                  fullExport.conversations.push(processConversationDetail(singleResults[sr].detail, singleResults[sr].item));
                  successCount++;
                } catch (e) {
                  errorCount++;
                  fullExport.conversations.push({id: singleResults[sr].item.id, title: singleResults[sr].item.title || "Unknown", error: e.message});
                }
              } else {
                errorCount++;
                fullExport.conversations.push({id: singleResults[sr].item.id, title: singleResults[sr].item.title || "Unknown", error: singleResults[sr].error});
              }
            }
            consecutiveGroupFails++;
            batchIndex += BATCH_SIZE;
          }

          // Check if we should permanently give up on batch mode
          if (consecutiveGroupFails >= MAX_CONSECUTIVE_FAILS) {
            log("Too many consecutive batch failures (" + MAX_CONSECUTIVE_FAILS + "), switching to individual mode", "error");
            useBatch = false;
          } else if (consecutiveGroupFails > 0) {
            if (dlMode) dlMode.textContent = "\u26A1 Batch mode \u2014 resumed";
          }
        }

        // Update UI after each group
        var completed = successCount + errorCount;
        var lastTitle = batchItems[batchItems.length - 1].title || "Untitled";
        updateDlUI(completed, filtered.length, lastTitle, startTime);

        if (completed % 100 === 0 || completed === filtered.length) {
          log("Progress: " + completed + "/" + filtered.length);
        }
      }

      // ---- FALLBACK: INDIVIDUAL DOWNLOADS ----
      if (!useBatch) {
        if (dlMode) dlMode.textContent = "\uD83D\uDC22 Individual mode";
        log("Switching to individual downloads\u2026");

        // Start from where batch left off
        var startFrom = successCount + errorCount;
        for (var i = startFrom; i < regularConvos.length; i++) {
          var c = regularConvos[i];
          var title = c.title || "Untitled";

          updateDlUI(i + 1, filtered.length, title, startTime);

          try {
            var convoResp = await downloadSingle(c.id, token);

            if (convoResp.status === 429) {
              log("Rate limited, waiting 30s\u2026", "error");
              var dlTitle = document.getElementById("g2c-dl-title");
              var dlRemaining = document.getElementById("g2c-dl-remaining");
              if (dlTitle) dlTitle.textContent = "Rate limited \u2014 waiting 30s\u2026";
              if (dlRemaining) dlRemaining.textContent = "Will resume automatically";
              await new Promise(function(r) { setTimeout(r, 30000); });
              i--;
              continue;
            }

            if (convoResp.status !== 200) {
              log("Skipped: " + title + " (HTTP " + convoResp.status + ")", "error");
              errorCount++;
              fullExport.conversations.push({id: c.id, title: title, error: "HTTP " + convoResp.status});
              continue;
            }

            var detail = await convoResp.json();
            var processed = processConversationDetail(detail, c);
            fullExport.conversations.push(processed);
            successCount++;

            if (i % 25 === 0 && i > 0) {
              log("Progress: " + (i + 1) + "/" + filtered.length);
            }

          } catch (err) {
            log("Error: " + title + " \u2014 " + err.message, "error");
            errorCount++;
            fullExport.conversations.push({id: c.id, title: title, error: err.message});
          }

          await new Promise(function(r) { setTimeout(r, 1000); });
        }
      }
      } // end if (regularConvos.length > 0)

      // ---- DOWNLOAD SHARED CONVERSATIONS ----
      if (sharedConvos.length > 0) {
        log("Downloading " + sharedConvos.length + " shared conversation(s)\u2026");
        var dlMode = document.getElementById("g2c-dl-mode");
        if (dlMode) dlMode.textContent = "\uD83D\uDD17 Shared conversations";

        for (var si = 0; si < sharedConvos.length; si++) {
          var sc = sharedConvos[si];
          var shareId = sc._share_id;
          var scTitle = sc.title || "Shared conversation";

          var completed = successCount + errorCount;
          updateDlUI(completed + 1, filtered.length, scTitle, startTime);

          try {
            var sharedResp = await downloadShared(shareId, token);

            if (sharedResp.status === 429) {
              log("Rate limited, waiting 30s\u2026", "error");
              await new Promise(function(r) { setTimeout(r, 30000); });
              si--; continue;
            }

            if (sharedResp.status !== 200) {
              log("Skipped shared: " + scTitle + " (HTTP " + sharedResp.status + ")", "error");
              errorCount++;
              fullExport.conversations.push({id: sc.id, title: scTitle, shared: true, error: "HTTP " + sharedResp.status});
              continue;
            }

            var sharedDetail = await sharedResp.json();
            var processed = processConversationDetail(sharedDetail, sc);
            processed.shared = true;
            processed.share_id = shareId;
            fullExport.conversations.push(processed);
            successCount++;

          } catch (sharedErr) {
            log("Error shared: " + scTitle + " \u2014 " + sharedErr.message, "error");
            errorCount++;
            fullExport.conversations.push({id: sc.id, title: scTitle, shared: true, error: sharedErr.message});
          }

          await new Promise(function(r) { setTimeout(r, 1000); });
        }
      }

      var json = JSON.stringify(fullExport, null, 2);
      var sizeBytes = json.length;
      var sizeStr = sizeBytes < 1024 * 1024
        ? (sizeBytes / 1024).toFixed(0) + " KB"
        : (sizeBytes / 1024 / 1024).toFixed(1) + " MB";

      // Smart filename based on what was exported
      var exportFilename = "chatgpt_all_conversations.json";
      var projectNames = {};
      var hasMain = false;
      var hasShared = false;
      for (var fi = 0; fi < fullExport.conversations.length; fi++) {
        if (fullExport.conversations[fi].shared) {
          hasShared = true;
        } else if (fullExport.conversations[fi].project) {
          projectNames[fullExport.conversations[fi].project] = true;
        } else {
          hasMain = true;
        }
      }
      var projNameList = Object.keys(projectNames);
      if (!hasMain && !hasShared && projNameList.length === 1) {
        // Only one project exported
        exportFilename = "chatgpt_project_" + projNameList[0].toLowerCase().replace(/[^a-z0-9]+/g, "_") + ".json";
      } else if (!hasMain && !hasShared && projNameList.length > 1) {
        exportFilename = "chatgpt_projects.json";
      } else if (!hasMain && hasShared && projNameList.length === 0) {
        exportFilename = "chatgpt_shared_conversations.json";
      }
      downloadFile(json, exportFilename, "application/json");
      log("DONE! " + successCount + " conversations, " + errorCount + " errors, ~" + sizeStr, "success");

      // Collect model breakdown from export
      var modelBreakdown = {};
      for (var mi = 0; mi < fullExport.conversations.length; mi++) {
        var cm = fullExport.conversations[mi].model || "unknown";
        modelBreakdown[cm] = (modelBreakdown[cm] || 0) + 1;
      }
      var sortedModels = Object.keys(modelBreakdown).sort(function(a, b) {
        return modelBreakdown[b] - modelBreakdown[a];
      });

      // Build model tags HTML — top 5 visible, rest collapsed
      var TOP_N = 5;
      var modelTagsHtml = '<div class="g2c-complete-models-wrap">';
      for (var ti = 0; ti < Math.min(TOP_N, sortedModels.length); ti++) {
        var mk = sortedModels[ti];
        modelTagsHtml += '<span class="g2c-scan-tag">' + mk + ' <span style="opacity:0.6;">' + modelBreakdown[mk] + '</span></span>';
      }
      if (sortedModels.length > TOP_N) {
        var moreCount = sortedModels.length - TOP_N;
        modelTagsHtml += '<button class="g2c-models-toggle" id="g2c-models-toggle">+' + moreCount + ' more</button>';
        modelTagsHtml += '<div class="g2c-models-extra" id="g2c-models-extra" style="display:none;">';
        for (var ti = TOP_N; ti < sortedModels.length; ti++) {
          var mk = sortedModels[ti];
          modelTagsHtml += '<span class="g2c-scan-tag">' + mk + ' <span style="opacity:0.6;">' + modelBreakdown[mk] + '</span></span>';
        }
        modelTagsHtml += '</div>';
      }
      modelTagsHtml += '</div>';

      // Show completion screen (State 5)
      var filterPanel = document.getElementById("g2c-filter-panel");
      if (filterPanel) {
        var elapsed = Math.round((Date.now() - startTime) / 1000);
        var elapsedStr = elapsed < 60 ? elapsed + "s" : Math.round(elapsed / 60) + "m " + (elapsed % 60) + "s";

        filterPanel.innerHTML = '\
          <div class="g2c-complete">\
            <div class="g2c-complete-icon">\u2705</div>\
            <div class="g2c-complete-title">Export Complete!</div>\
            <div class="g2c-complete-sub">' + successCount + ' conversations \u00B7 ' + sizeStr + ' \u00B7 ' + elapsedStr + '</div>\
            ' + modelTagsHtml + '\
          </div>\
          <div class="g2c-whatsnext">\
            <div class="g2c-whatsnext-title">What\u2019s next?</div>\
            <div class="g2c-whatsnext-item">\
              <span style="color:#a0a0e0;">\uD83D\uDC40 Browse your data</span><br>\
              <span style="color:#999;">Open the <a href="https://siamsnus.github.io/GPT2Claude-Migration-Kit/viewer.html" target="_blank">Conversation Viewer</a> to explore your chats. You can <a href="https://siamsnus.github.io/GPT2Claude-Migration-Kit/viewer.html" download target="_blank">download it</a> for fully offline use.</span>\
            </div>\
            <div class="g2c-whatsnext-item">\
              <span style="color:#7eb8a0;">\uD83D\uDE80 Import to Claude</span> <span class="g2c-whatsnext-badge">recommended</span><br>\
              <span style="color:#999;">Follow the <a href="https://siamsnus.github.io/GPT2Claude-Migration-Kit/#importing" target="_blank">import guide</a> to bring your history into Claude.</span>\
            </div>\
          </div>';

        // Wire up "show more models" toggle
        var modelsToggle = document.getElementById("g2c-models-toggle");
        if (modelsToggle) {
          modelsToggle.addEventListener("click", function() {
            var extra = document.getElementById("g2c-models-extra");
            if (extra) {
              var showing = extra.style.display !== "none";
              extra.style.display = showing ? "none" : "flex";
              this.textContent = showing ? "+" + (sortedModels.length - TOP_N) + " more" : "show less";
            }
          });
        }
      }

    } catch (err) {
      log("Download failed: " + err.message, "error");
      var dlTitle = document.getElementById("g2c-dl-title");
      if (dlTitle) dlTitle.textContent = "Error: " + err.message;
    }
  }

  // ========== EXPORT: INSTRUCTIONS ==========
  async function exportInstructions() {
    var btn = document.getElementById("g2c-btn-instructions");
    setButtonState(btn, "running", "Exporting...");

    try {
      var token = await getToken();
      var headers = {"Authorization": "Bearer " + token};

      var endpoints = [
        {name: "custom_instructions", url: "https://chatgpt.com/backend-api/user_system_messages"},
        {name: "settings", url: "https://chatgpt.com/backend-api/settings"},
        {name: "beta_features", url: "https://chatgpt.com/backend-api/settings/beta_features"},
        {name: "models", url: "https://chatgpt.com/backend-api/models"},
        {name: "account", url: "https://chatgpt.com/backend-api/accounts/check/v4-2023-04-27"},
        {name: "codex_usage", url: "https://chatgpt.com/backend-api/codex/usage"},
        {name: "compliance", url: "https://chatgpt.com/backend-api/compliance"}
      ];

      var result = {
        export_date: new Date().toISOString(),
        tool: "GPT2Claude Migration Kit v2.4",
        data: {}
      };

      for (var i = 0; i < endpoints.length; i++) {
        var ep = endpoints[i];
        log("Fetching " + ep.name + "...");
        try {
          var resp = await fetch(ep.url, {credentials: "include", headers: headers});
          if (resp.status === 200) {
            result.data[ep.name] = await resp.json();
            log("Got: " + ep.name);
          } else if (resp.status === 404) {
            result.data[ep.name] = {note: "Not available on this account"};
            log(ep.name + ": not available (skipped)");
          } else {
            result.data[ep.name] = {error: "HTTP " + resp.status};
            log(ep.name + ": HTTP " + resp.status, "error");
          }
        } catch (e) {
          result.data[ep.name] = {error: e.message};
          log(ep.name + " error: " + e.message, "error");
        }
      }

      downloadFile(JSON.stringify(result, null, 2), "chatgpt_instructions.json", "application/json");
      setButtonState(btn, "done", "Instructions exported");

    } catch (err) {
      log("Instructions export failed: " + err.message, "error");
      setButtonState(btn, "error", err.message);
    }
  }

  // ========== EVENT LISTENERS ==========
  document.getElementById("g2c-close").addEventListener("click", function() {
    panel.style.animation = "g2c-fadein 0.2s ease-out reverse";
    setTimeout(function() { panel.remove(); style.remove(); }, 200);
  });

  document.getElementById("g2c-btn-memory").addEventListener("click", exportMemories);
  document.getElementById("g2c-btn-convos").addEventListener("click", exportConversations);
  document.getElementById("g2c-btn-instructions").addEventListener("click", exportInstructions);

  document.getElementById("g2c-btn-all").addEventListener("click", async function() {
    var btn = document.getElementById("g2c-btn-all");
    setButtonState(btn, "running", "Exporting everything...");
    log("--- EXPORT ALL started ---");
    await exportMemories();
    await exportInstructions();
    log("Memories & instructions done. Scanning conversations...");
    await exportConversations();
    log("Memories & instructions exported. Configure conversation filters and click Download.", "success");
  });

  document.getElementById("g2c-toggle-log").addEventListener("click", function() {
    var logVisible = logEl.classList.contains("visible");
    logEl.classList.toggle("visible");
    this.textContent = logVisible ? "Show log \u25BC" : "Hide log \u25B2";
  });

  // Copy log button
  document.getElementById("g2c-copy-log").addEventListener("click", function() {
    var copyBtn = this;
    var entries = document.querySelectorAll(".g2c-log-entry");
    var text = "";
    for (var i = 0; i < entries.length; i++) {
      text += entries[i].textContent + "\n";
    }
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function() {
        copyBtn.textContent = "\u2705 Copied!";
        setTimeout(function() { copyBtn.textContent = "Copy log"; }, 2000);
      }).catch(function() {
        fallbackCopy(text, copyBtn);
      });
    } else {
      fallbackCopy(text, copyBtn);
    }
  });

  function fallbackCopy(text, btn) {
    var ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position = "fixed";
    ta.style.left = "-9999px";
    document.body.appendChild(ta);
    ta.select();
    try {
      document.execCommand("copy");
      btn.textContent = "\u2705 Copied!";
      setTimeout(function() { btn.textContent = "Copy log"; }, 2000);
    } catch (e) {
      btn.textContent = "Copy failed";
      setTimeout(function() { btn.textContent = "Copy log"; }, 2000);
    }
    document.body.removeChild(ta);
  }

  log("Ready. Click a button to start exporting.");

  // ========== CAMERA TOGGLE ==========
  var cameraState = null; // null=unknown, true=on, false=off
  async function toggleCamera() {
    var btn = document.getElementById("g2c-camera-btn");
    var note = document.getElementById("g2c-camera-note");
    if (!btn) return;

    btn.className = "g2c-tool-toggle checking";
    btn.textContent = "\u2026";

    try {
      var token = await getToken();
      var headers = {"Authorization": "Bearer " + token, "Content-Type": "application/json"};

      // If we don't know current state, check first
      if (cameraState === null) {
        var checkResp = await fetch("https://chatgpt.com/backend-api/settings/beta_features", {
          credentials: "include", headers: headers
        });
        if (checkResp.status === 200) {
          var features = await checkResp.json();
          cameraState = !!(features.video_screen_sharing);
          log("Camera currently: " + (cameraState ? "ON" : "OFF"));
        } else {
          cameraState = false;
          log("Beta features: HTTP " + checkResp.status + " (assuming off)");
        }
      }

      // Toggle to opposite state
      var newState = !cameraState;
      var toggleResp = await fetch(
        "https://chatgpt.com/backend-api/settings/beta_features?feature=video_screen_sharing&value=" + newState,
        {method: "POST", credentials: "include", headers: headers}
      );

      if (toggleResp.status === 200) {
        cameraState = newState;
        btn.className = "g2c-tool-toggle" + (newState ? " on" : "");
        btn.textContent = newState ? "ON" : "OFF";
        log("Camera " + (newState ? "enabled" : "disabled"), "success");

        if (note) {
          note.style.display = "block";
          note.textContent = newState
            ? "\u2705 Enabled! Refresh the page (F5) to see the camera icon"
            : "Disabled. Refresh the page to remove the camera icon";
          setTimeout(function() {
            if (note) note.style.display = "none";
          }, 8000);
        }
      } else {
        throw new Error("HTTP " + toggleResp.status);
      }
    } catch (err) {
      btn.className = "g2c-tool-toggle";
      btn.textContent = "Error";
      log("Camera toggle failed: " + err.message, "error");
      setTimeout(function() {
        if (btn) btn.textContent = "Retry";
      }, 2000);
    }
  }

  // Auto-check camera state on load
  (async function() {
    try {
      var btn = document.getElementById("g2c-camera-btn");
      if (!btn) return;
      var token = await getToken();
      var headers = {"Authorization": "Bearer " + token};
      var resp = await fetch("https://chatgpt.com/backend-api/settings/beta_features", {
        credentials: "include", headers: headers
      });
      if (resp.status === 200) {
        var features = await resp.json();
        cameraState = !!(features.video_screen_sharing);
        btn.className = "g2c-tool-toggle" + (cameraState ? " on" : "");
        btn.textContent = cameraState ? "ON" : "OFF";
      }
    } catch (e) {
      // silent — user can click to check manually
    }
  })();

  safeAddEvent("g2c-camera-btn", "click", toggleCamera);
})();

</script>

<script>
// Browser detection
(function() {
  var detect = document.getElementById("browser-detect");
  var isFirefox = navigator.userAgent.indexOf("Firefox") > -1;
  var isChrome = navigator.userAgent.indexOf("Chrome") > -1 && navigator.userAgent.indexOf("Edg") === -1;
  var isEdge = navigator.userAgent.indexOf("Edg") > -1;
  var isBrave = navigator.brave !== undefined;

  if (isFirefox) {
    detect.textContent = "🦊 Firefox detected — use the Firefox tab below";
    showTab("firefox");
  } else if (isBrave) {
    detect.textContent = "🦁 Brave detected — drag the button below";
    showTab("chrome");
  } else if (isEdge) {
    detect.textContent = "🌐 Edge detected — drag the button below";
    showTab("chrome");
  } else if (isChrome) {
    detect.textContent = "✨ Chrome detected — drag the button below";
    showTab("chrome");
  }
})();

// Tab switching
function showTab(name) {
  var tabs = document.querySelectorAll(".tab-content");
  var btns = document.querySelectorAll(".tab-btn");
  for (var i = 0; i < tabs.length; i++) { tabs[i].classList.remove("active"); }
  for (var i = 0; i < btns.length; i++) { btns[i].classList.remove("active"); }
  document.getElementById("tab-" + name).classList.add("active");
  var labels = {"chrome": 0, "firefox": 1, "paste": 2};
  if (labels[name] !== undefined) btns[labels[name]].classList.add("active");
}

// Copy script for Firefox (same as console paste)
var copyUrlBtn = document.getElementById("copy-firefox-script");
if (copyUrlBtn) {
  copyUrlBtn.addEventListener("click", function() {
    var code = document.getElementById("migrate-source").textContent.trim();
    navigator.clipboard.writeText(code).then(function() {
      document.getElementById("copy-firefox-confirm").style.display = "block";
      copyUrlBtn.innerHTML = "✅ Copied!";
      setTimeout(function() {
        copyUrlBtn.innerHTML = "📋 Copy export script";
        document.getElementById("copy-firefox-confirm").style.display = "none";
      }, 4000);
    });
  });
}

// Copy full script (for console paste)
var copyScriptBtn = document.getElementById("copy-full-script");
if (copyScriptBtn) {
  copyScriptBtn.addEventListener("click", function() {
    var code = document.getElementById("migrate-source").textContent.trim();
    navigator.clipboard.writeText(code).then(function() {
      document.getElementById("copy-script-confirm").style.display = "block";
      copyScriptBtn.innerHTML = "✅ Copied!";
      setTimeout(function() {
        copyScriptBtn.innerHTML = "📋 Copy export script";
        document.getElementById("copy-script-confirm").style.display = "none";
      }, 4000);
    });
  });
}
</script>
</body>
</html>